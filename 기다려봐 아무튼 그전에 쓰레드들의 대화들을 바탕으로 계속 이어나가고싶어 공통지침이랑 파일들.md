<img src="https://r2cdn.perplexity.ai/pplx-full-logo-primary-dark%402x.png" style="height:64px;margin-right:32px"/>

# ê¸°ë‹¤ë ¤ë´ ì•„ë¬´íŠ¼ ê·¸ì „ì— ì“°ë ˆë“œë“¤ì˜ ëŒ€í™”ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ê³„ì† ì´ì–´ë‚˜ê°€ê³ ì‹¶ì–´ ê³µí†µì§€ì¹¨ì´ë‘ íŒŒì¼ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì´ì–´ì„œ ì§ˆë¬¸í•˜ë©´ ëŒ€ë‹µí•´ì£¼ì—ˆìœ¼ë©´ ì¢‹ê² ì–´

ì•Œê² ì–´ìš”! ì´ì „ ì“°ë ˆë“œì˜ ëŒ€í™” ë‚´ìš©ë“¤ì„ ëª¨ë‘ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

í˜„ì¬ **Healthcare AI Chatbot Service** ê°œë°œ ì§„í–‰ ìƒí™©ì„ íŒŒì•…í–ˆì–´ìš”:

## ğŸ“Œ í˜„ì¬ê¹Œì§€ êµ¬í˜„ëœ ë‚´ìš© (ì´ì „ ì“°ë ˆë“œ ê¸°ë°˜)

### âœ… ì™„ë£Œëœ ì‚¬í•­

1. **AWS Bedrock Claude 3.5 Haiku/Sonnet ì—°ë™**
    - BedrockProperties, ClaudeClient, ClaudeService êµ¬í˜„
    - ChatController (ì¼ë°˜ ì±„íŒ… API)
    - PersonaChatService (í˜ë¥´ì†Œë‚˜ ì±„íŒ… API)
    - Postman í…ŒìŠ¤íŠ¸ ì™„ë£Œ
2. **í”„ë¡œì íŠ¸ ê¸°ë³¸ êµ¬ì¡°**
    - Spring Boot 3.4.1 ê¸°ë°˜ MSA êµ¬ì¡°
    - Rich Domain Model íŒ¨í„´ ì ìš©
    - Git Flow ì „ëµ ìˆ˜ë¦½
3. **DB ë§ˆì´ê·¸ë ˆì´ì…˜**
    - Flyway ì„¤ì • ì™„ë£Œ

### ğŸ”„ ì§„í–‰ ì¤‘/ì˜ˆì • ì‚¬í•­https://github.com/SunTera/Petom

- **Sprint 1.2**: ê¸°ë³¸ Claude ì—°ë™ í…ŒìŠ¤íŠ¸ ë‹¨ê³„
- **í–¥í›„ Sprint**: RAG + Milvus Vector DB í†µí•©, Kafka ì´ë²¤íŠ¸ ê¸°ë°˜ Diary Service ì—°ë™


## ğŸ’¡ ì´ì œ ì–´ë–¤ ì‘ì—…ì„ ì´ì–´ê°€ê³  ì‹¶ìœ¼ì‹ ê°€ìš”?

í˜„ì¬ ìƒíƒœì—ì„œ ë‹¤ìŒ ì¤‘ ì–´ë–¤ ë¶€ë¶„ì„ ì§„í–‰í•˜ë©´ ì¢‹ì„ê¹Œìš”?

1. **RAG + Milvus Vector DB í†µí•©** (í˜ë¥´ì†Œë‚˜ ì±„íŒ… ê°•í™”)
2. **Kafka ì—°ë™** (Diary Service â†’ Healthcare Service ë°ì´í„° ìŠ¤íŠ¸ë¦¬ë°)
3. **í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™** (Chat Heads UI + API í†µí•©)
4. **í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±** (Unit/Integration Test)
5. **ê¸°ì¡´ ì½”ë“œ ë¦¬íŒ©í† ë§** (DDD íŒ¨í„´ ê°•í™”, ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ )
6. **ë‹¤ë¥¸ ì‘ì—…** (êµ¬ì²´ì ìœ¼ë¡œ ë§ì”€í•´ì£¼ì„¸ìš”)

ì–´ë–¤ ë¶€ë¶„ë¶€í„° ì´ì–´ì„œ ì§„í–‰í• ê¹Œìš”? ğŸš€
<span style="display:none">[^1_1][^1_2][^1_3][^1_4][^1_5][^1_6][^1_7]</span>

<div align="center">â‚</div>

[^1_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^1_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^1_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^1_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^1_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^1_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^1_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md


---

# ì¼ë‹¨ êµ¬í˜„ ì´ì•¼ê¸°ëŠ” ì•„ë‹Œë° ì¶”ê°€ë¡œ ë§í•´ì£¼ê³  ì‹¶ì€ êµ¬í˜„ê³„íšì´ìˆëŠ”ë° [https://github.com/SunTera/Petom](https://github.com/SunTera/Petom) ì´ ì˜¤í”ˆì†ŒìŠ¤ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ìš°ë¦¬ í—¬ìŠ¤ì¼€ì–´ íƒ­ì— ì¶”ê°€í•˜ê³  ì‹¶ì–´ ê°€ê¹Œìš´ ë™ë¬¼ë³‘ì› ë³´ì—¬ì£¼ê¸°ì™€ í”¼ë¶€ì§ˆí™˜ ì¦ìƒíƒì§€ë¥¼.[https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=561](https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=561)

[https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=71520](https://aihub.or.kr/aihubdata/data/view.do?dataSetSn=71520)
ë“±ë“± ì´ëŸ°ê²ƒì„ í—¬ìŠ¤ì¼€ì–´ íƒ­ì—ì„œ ì‚¬ìš©ë˜ëŠ” AIë¥¼ êµ¬í˜„í•˜ê³  ì‹¶ì–´

ì™„ë²½í•˜ê²Œ ì´í•´í–ˆì–´ìš”! ğŸ¯

í˜„ì¬ê¹Œì§€ì˜ **Healthcare AI Chatbot Service** ê°œë°œ ìƒí™©ì„ ëª¨ë‘ í™•ì¸í–ˆê³ , ì´ì œ **ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ê³„íš**ì„ ëª…í™•íˆ ì´í•´í–ˆìŠµë‹ˆë‹¤.

## ğŸ“‹ ìƒˆë¡œìš´ ê¸°ëŠ¥ ì¶”ê°€ ê³„íš ì •ë¦¬

### ğŸ¯ êµ¬í˜„í•˜ê³  ì‹¶ì€ í•µì‹¬ ê¸°ëŠ¥

Healthcare íƒ­ì— ë‹¤ìŒ 2ê°€ì§€ AI ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ë ¤ëŠ” ê³„íšì´êµ°ìš”:

1. **ë°˜ë ¤ë™ë¬¼ í”¼ë¶€ì§ˆí™˜ íƒì§€ (AI Vision ê¸°ë°˜)**
    - [SunTera/Petom](https://github.com/SunTera/Petom) ì˜¤í”ˆì†ŒìŠ¤ ì°¸ê³ [^2_1]
    - YOLOv5 ê¸°ë°˜ í”¼ë¶€ì§ˆí™˜ íƒì§€ (ë¯¸ë€, ê²°ì ˆ ë“±)
    - AI Hub ë°˜ë ¤ë™ë¬¼ í”¼ë¶€ì§ˆí™˜ ë°ì´í„°ì…‹ í™œìš©[^2_2]
2. **ê°€ê¹Œìš´ ë™ë¬¼ë³‘ì› ì°¾ê¸° (ì§€ë„ ì‹œê°í™”)**
    - ê³µê³µë°ì´í„°í¬í„¸ ì „êµ­ ë™ë¬¼ë³‘ì› ë°ì´í„° í™œìš©
    - ì§€ë„ ê¸°ë°˜ ë³‘ì› ì •ë³´ ì œê³µ (ì£¼ì†Œ, ì „í™”ë²ˆí˜¸)

### ğŸ”— ì°¸ê³ í•˜ë ¤ëŠ” ë ˆí¼ëŸ°ìŠ¤ ì‚¬ì´íŠ¸

- [lifet.co.kr](https://lifet.co.kr/) - ë°˜ë ¤ë™ë¬¼ ê±´ê°•ê´€ë¦¬ UI/UX
- [vdoc.kr](https://ai.vdoc.kr/) - AI ê¸°ë°˜ ë™ë¬¼ë³‘ì› ì„œë¹„ìŠ¤

***

## ğŸ’¡ í˜„ì§ ì¤‘ì‹¬ MSA ì•„í‚¤í…ì²˜ í”¼ë“œë°±

### ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê²°ì • (ADR)

#### **ADR \#1: Healthcare Serviceì— Vision AI í†µí•© vs ë³„ë„ Service ë¶„ë¦¬**

**WHY ë³„ë„ Serviceê°€ ì•„ë‹Œ Healthcare Service í†µí•©ì„ ì¶”ì²œí•˜ëŠ”ê°€?**

**í˜„ì¬ MSA êµ¬ì¡°:**

- User Service (8080): íšŒì›/ë°˜ë ¤ë™ë¬¼ ê´€ë¦¬
- Social Service (8083): ì»¤ë®¤ë‹ˆí‹°
- Diary Service (8087): AI ì¼ê¸° ìƒì„±
- **Healthcare Service (8085)**: ê±´ê°• ê´€ë¦¬ + AI ì±—ë´‡

**ê²°ì •: Healthcare Service ë‚´ Featureë¡œ í†µí•© âœ…**

**ì´ìœ  (WHY):**

1. **ë„ë©”ì¸ ì‘ì§‘ë„ (Domain Cohesion)**
    - í”¼ë¶€ì§ˆí™˜ íƒì§€ = ë°˜ë ¤ë™ë¬¼ ê±´ê°• ê´€ë¦¬ ë„ë©”ì¸
    - ë™ë¬¼ë³‘ì› ì°¾ê¸° = ì¹˜ë£Œ ì—°ê³„ ë„ë©”ì¸
    - ë‘˜ ë‹¤ Healthcareì˜ ì±…ì„ ë²”ìœ„ ë‚´
2. **MSA ê³¼ë„í•œ ë¶„í•  ë°©ì§€ (Anti-Pattern íšŒí”¼)**
    - 6ëª… íŒ€ì—ì„œ Serviceë¥¼ ë„ˆë¬´ ì˜ê²Œ ìª¼ê°œë©´ ê´€ë¦¬ ë³µì¡ë„ ì¦ê°€
    - ë„¤íŠ¸ì›Œí¬ í˜¸ì¶œ ì¦ê°€ â†’ ë ˆì´í„´ì‹œ ì¦ê°€
    - ë°°í¬ íŒŒì´í”„ë¼ì¸ ì¤‘ë³µ
3. **í˜„ì§ Best Practice: Bounded Context ìš°ì„ **
    - "Health \& Disease Management" ë‹¨ì¼ Bounded Context
    - Feature ë‹¨ìœ„ë¡œ Package ë¶„ë¦¬ (DDD Layered Architecture)

**êµ¬ì¡°:**

```
com.petlog.healthcare
â”œâ”€â”€ api
â”‚   â””â”€â”€ controller
â”‚       â”œâ”€â”€ ChatbotController (ê¸°ì¡´ ì±—ë´‡)
â”‚       â”œâ”€â”€ SkinDiseaseController (NEW: í”¼ë¶€ì§ˆí™˜ íƒì§€)
â”‚       â””â”€â”€ HospitalController (NEW: ë³‘ì› ì°¾ê¸°)
â”œâ”€â”€ domain
â”‚   â”œâ”€â”€ chatbot (ê¸°ì¡´)
â”‚   â”œâ”€â”€ skindisease (NEW: í”¼ë¶€ì§ˆí™˜ ë„ë©”ì¸)
â”‚   â”‚   â”œâ”€â”€ entity
â”‚   â”‚   â”‚   â”œâ”€â”€ SkinDiseaseDetection
â”‚   â”‚   â”‚   â””â”€â”€ DetectionHistory
â”‚   â”‚   â”œâ”€â”€ service
â”‚   â”‚   â”‚   â””â”€â”€ SkinDiseaseService
â”‚   â”‚   â””â”€â”€ repository
â”‚   â””â”€â”€ hospital (NEW: ë³‘ì› ë„ë©”ì¸)
â”‚       â”œâ”€â”€ entity
â”‚       â”‚   â””â”€â”€ AnimalHospital
â”‚       â”œâ”€â”€ service
â”‚       â”‚   â””â”€â”€ HospitalService
â”‚       â””â”€â”€ repository
â””â”€â”€ infrastructure
    â”œâ”€â”€ bedrock (ê¸°ì¡´ Claude)
    â”œâ”€â”€ yolo (NEW: YOLOv5 ì¶”ë¡  í´ë¼ì´ì–¸íŠ¸)
    â””â”€â”€ publicdata (NEW: ê³µê³µë°ì´í„° API í´ë¼ì´ì–¸íŠ¸)
```


***

#### **ADR \#2: YOLOv5 ëª¨ë¸ ì„œë¹™ ë°©ì‹**

**ì˜µì…˜ ë¹„êµ:**


| ì˜µì…˜ | ì¥ì  | ë‹¨ì  | í˜„ì§ ì±„íƒë„ |
| :-- | :-- | :-- | :-- |
| **A. Flask ë³„ë„ ì„œë²„** (Petom ë°©ì‹) | Python ML ìƒíƒœê³„ í™œìš© | ë³„ë„ ë°°í¬/ê´€ë¦¬, ì–¸ì–´ ì´ì§ˆê° | â­â­â­ |
| **B. AWS SageMaker Endpoint** | ê´€ë¦¬í˜•, Auto-scaling | ë¹„ìš©, Vendor Lock-in | â­â­â­â­â­ (í˜„ì§ ëŒ€ì„¸) |
| **C. TorchServe** | Java í†µí•© ê°€ëŠ¥ | í•™ìŠµ ê³¡ì„  | â­â­â­ |

**ê²°ì •: B. AWS SageMaker Endpoint ì¶”ì²œ âœ…**

**WHY?**

1. **í˜„ì§ MSA í‘œì¤€ íŒ¨í„´**
    - Spring Boot (ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§) + SageMaker (ML ì¶”ë¡ ) ë¶„ë¦¬
    - ì¿ íŒ¡, ì¹´ì¹´ì˜¤, í† ìŠ¤ ë“± ëŒ€ë¶€ë¶„ ì´ êµ¬ì¡° ì‚¬ìš©
2. **íŒ€ ì—­ëŸ‰ í™œìš©**
    - ë°°í¬ ë‹´ë‹¹ìê°€ AWS CI/CD ì „ë‹´ â†’ SageMaker ë°°í¬ë„ ë™ì¼ íŒŒì´í”„ë¼ì¸
    - DevOps ë¶€ë‹´ ìµœì†Œí™”
3. **ë¹„ìš© ìµœì í™”**
    - í•™ìƒ í”„ë¡œì íŠ¸: SageMaker Serverless Inference (ìš”ì²­ ì‹œì—ë§Œ ê³¼ê¸ˆ)
    - í”„ë¦¬í‹°ì–´ ì ìš© ê°€ëŠ¥

**ëŒ€ì•ˆ: ë¹„ìš© ì ˆê° ì›í•˜ë©´ Flask + ECS Fargate Spot ì¸ìŠ¤í„´ìŠ¤**

- Petom ì½”ë“œ ê±°ì˜ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥
- í•˜ì§€ë§Œ ë°°í¬ ë³µì¡ë„ ì¦ê°€

***

#### **ADR \#3: ë™ë¬¼ë³‘ì› ë°ì´í„° ì €ì¥ vs API ì‹¤ì‹œê°„ ì¡°íšŒ**

**ê²°ì •: PostgreSQL ì €ì¥ + ë°°ì¹˜ ì—…ë°ì´íŠ¸ âœ…**

**WHY?**

1. **ê³µê³µë°ì´í„° API í•œê³„**
    - Rate Limit ì œì•½
    - ì‘ë‹µ ì†ë„ ëŠë¦¼ (1~3ì´ˆ)
    - ì‚¬ìš©ì ê²½í—˜ ì €í•˜
2. **í˜„ì§ Best Practice**
    - ê³µê³µë°ì´í„°ëŠ” ë§¤ì¼ ë°°ì¹˜ë¡œ ë™ê¸°í™”
    - ì„œë¹„ìŠ¤ëŠ” ìì²´ DBì—ì„œ ì¡°íšŒ
    - ì˜ˆì‹œ: ì¹´ì¹´ì˜¤ë§µ, ë„¤ì´ë²„ì§€ë„ ëª¨ë‘ ì´ ë°©ì‹
3. **êµ¬í˜„ ê³„íš**

```java
@Scheduled(cron = "0 0 3 * * *") // ë§¤ì¼ ìƒˆë²½ 3ì‹œ
public void syncHospitalData() {
    // ê³µê³µë°ì´í„° API í˜¸ì¶œ â†’ PostgreSQL ì €ì¥
}
```


***

## ğŸš€ êµ¬í˜„ ë¡œë“œë§µ (Sprint ê¸°ë°˜)

### **Sprint 1.5: í”¼ë¶€ì§ˆí™˜ íƒì§€ MVP (3ì¼)**

#### **Day 1: YOLOv5 ëª¨ë¸ ì¤€ë¹„ + AWS SageMaker ë°°í¬**

**ğŸ“Œ Jira Issue: Feat\#5 - YOLOv5 í”¼ë¶€ì§ˆí™˜ íƒì§€ ëª¨ë¸ SageMaker ë°°í¬**

**ì‘ì—… ë‚´ìš©:**

1. AI Hub ë°ì´í„°ì…‹ ë‹¤ìš´ë¡œë“œ ë° ì „ì²˜ë¦¬
    - Petomì˜ ì „ì²˜ë¦¬ ì½”ë“œ ì°¸ê³ [^2_1]
    - ë¯¸ë€, ê²°ì ˆ 2ê°œ í´ë˜ìŠ¤ë¡œ ë‹¨ìˆœí™” (MVP)
2. YOLOv5 í•™ìŠµ (Google Colab)

```python
# Colabì—ì„œ ì‹¤í–‰
!git clone https://github.com/ultralytics/yolov5
!python train.py --data pet_skin.yaml --weights yolov5s.pt --epochs 50
```

3. ëª¨ë¸ì„ `.pt` â†’ TorchScript ë³€í™˜

```python
model = torch.jit.script(model)
torch.jit.save(model, 'skin_disease_model.pt')
```

4. SageMaker ë°°í¬ (ë°°í¬ ë‹´ë‹¹ìì™€ í˜‘ì—…)
    - S3ì— ëª¨ë¸ ì—…ë¡œë“œ
    - SageMaker Endpoint ìƒì„±
    - Endpoint URL ë°›ê¸° (ì˜ˆ: `https://runtime.sagemaker.ap-northeast-2.amazonaws.com/endpoints/pet-skin-disease/invocations`)

**ì»¤ë°‹ ë©”ì‹œì§€:**

```
[Feat#5]: YOLOv5 í”¼ë¶€ì§ˆí™˜ íƒì§€ ëª¨ë¸ SageMaker ë°°í¬
- AI Hub ë°ì´í„°ì…‹ ì „ì²˜ë¦¬ (ë¯¸ë€, ê²°ì ˆ 2ê°œ í´ë˜ìŠ¤)
- YOLOv5s ëª¨ë¸ í•™ìŠµ (Colab, 50 epochs)
- TorchScript ë³€í™˜ í›„ S3 ì—…ë¡œë“œ
- SageMaker Serverless Endpoint ìƒì„±
  - Endpoint: pet-skin-disease-endpoint
  - Region: ap-northeast-2
- WHY: Flask ë³„ë„ ì„œë²„ ëŒ€ì‹  SageMakerë¡œ ML ì¸í”„ë¼ ê´€ë¦¬ ìœ„ì„
```


***

#### **Day 2: Backend API êµ¬í˜„ (Spring Boot)**

**ğŸ“Œ Jira Issue: Feat\#6 - í”¼ë¶€ì§ˆí™˜ íƒì§€ API êµ¬í˜„**

**1. Entity ì¶”ê°€**

`SkinDiseaseDetection.java`:

```java
package com.petlog.healthcare.domain.skindisease.entity;

import jakarta.persistence.*;
import lombok.*;
import java.time.LocalDateTime;

/**
 * í”¼ë¶€ì§ˆí™˜ íƒì§€ ê¸°ë¡ Entity
 * - YOLOv5 ì¶”ë¡  ê²°ê³¼ ì €ì¥
 * - ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ URL ë° íƒì§€ ê²°ê³¼ ê´€ë¦¬
 */
@Entity
@Table(name = "skin_disease_detections")
@Getter @Setter
@NoArgsConstructor @AllArgsConstructor
@Builder
public class SkinDiseaseDetection {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private Long userId;
    
    @Column(nullable = false)
    private Long petId;
    
    /** S3ì— ì—…ë¡œë“œëœ ì›ë³¸ ì´ë¯¸ì§€ URL */
    @Column(nullable = false)
    private String originalImageUrl;
    
    /** YOLOv5 íƒì§€ ê²°ê³¼ ì´ë¯¸ì§€ URL (ë°•ìŠ¤ ê·¸ë ¤ì§„ ì´ë¯¸ì§€) */
    private String detectedImageUrl;
    
    /** íƒì§€ëœ ì§ˆí™˜ ì¢…ë¥˜ (JSON ë°°ì—´: ["ë¯¸ë€", "ê²°ì ˆ"]) */
    @Column(columnDefinition = "TEXT")
    private String detectedDiseases;
    
    /** ì‹ ë¢°ë„ (0.0 ~ 1.0) */
    private Double confidence;
    
    /** íƒì§€ ìˆ˜í–‰ ì‹œê° */
    @Column(nullable = false)
    private LocalDateTime detectedAt;
    
    /** ì‚¬ìš©ì ë©”ëª¨ (ì„ íƒ) */
    @Column(columnDefinition = "TEXT")
    private String userNote;
}
```

**2. Repository**

```java
package com.petlog.healthcare.domain.skindisease.repository;

import com.petlog.healthcare.domain.skindisease.entity.SkinDiseaseDetection;
import org.springframework.data.jpa.repository.JpaRepository;
import java.time.LocalDateTime;
import java.util.List;

public interface SkinDiseaseDetectionRepository extends JpaRepository<SkinDiseaseDetection, Long> {
    
    /** íŠ¹ì • ë°˜ë ¤ë™ë¬¼ì˜ íƒì§€ ê¸°ë¡ ì¡°íšŒ */
    List<SkinDiseaseDetection> findByUserIdAndPetIdOrderByDetectedAtDesc(Long userId, Long petId);
    
    /** ìµœê·¼ Nì¼ ì´ë‚´ íƒì§€ ê¸°ë¡ */
    List<SkinDiseaseDetection> findByPetIdAndDetectedAtAfter(Long petId, LocalDateTime after);
}
```

**3. SageMaker Client (Infrastructure Layer)**

`SageMakerYoloClient.java`:

```java
package com.petlog.healthcare.infrastructure.yolo;

import com.fasterxml.jackson.databind.JsonNode;
import com.fasterxml.jackson.databind.ObjectMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;
import software.amazon.awssdk.auth.credentials.DefaultCredentialsProvider;
import software.amazon.awssdk.core.SdkBytes;
import software.amazon.awssdk.regions.Region;
import software.amazon.awssdk.services.sagemakerruntime.SageMakerRuntimeClient;
import software.amazon.awssdk.services.sagemakerruntime.model.InvokeEndpointRequest;
import software.amazon.awssdk.services.sagemakerruntime.model.InvokeEndpointResponse;

import java.util.*;

/**
 * AWS SageMaker YOLOv5 ì¶”ë¡  í´ë¼ì´ì–¸íŠ¸
 * - SageMaker Endpoint í˜¸ì¶œí•˜ì—¬ í”¼ë¶€ì§ˆí™˜ íƒì§€ ìˆ˜í–‰
 * - ì…ë ¥: ì´ë¯¸ì§€ Base64
 * - ì¶œë ¥: íƒì§€ëœ ì§ˆí™˜ ë¦¬ìŠ¤íŠ¸ + Confidence
 */
@Slf4j
@Component
@RequiredArgsConstructor
public class SageMakerYoloClient {
    
    private final ObjectMapper objectMapper;
    private final SageMakerRuntimeClient sageMakerClient;
    
    @Value("${aws.sagemaker.endpoint-name}")
    private String endpointName; // pet-skin-disease-endpoint
    
    /**
     * í”¼ë¶€ì§ˆí™˜ íƒì§€ ìˆ˜í–‰
     * @param imageBase64 ì´ë¯¸ì§€ Base64 ì¸ì½”ë”© ë¬¸ìì—´
     * @return íƒì§€ ê²°ê³¼ (ì§ˆí™˜ ë¦¬ìŠ¤íŠ¸, confidence)
     */
    public YoloDetectionResult detectSkinDisease(String imageBase64) {
        log.info("SageMaker YOLOv5 ì¶”ë¡  ìš”ì²­ - Endpoint: {}", endpointName);
        
        try {
            // 1. Request Body êµ¬ì„± (SageMakerëŠ” JSON í˜•ì‹)
            Map<String, Object> requestBody = new HashMap<>();
            requestBody.put("image", imageBase64);
            String jsonPayload = objectMapper.writeValueAsString(requestBody);
            
            // 2. SageMaker Endpoint í˜¸ì¶œ
            InvokeEndpointRequest request = InvokeEndpointRequest.builder()
                    .endpointName(endpointName)
                    .contentType("application/json")
                    .body(SdkBytes.fromUtf8String(jsonPayload))
                    .build();
            
            InvokeEndpointResponse response = sageMakerClient.invokeEndpoint(request);
            String responseBody = response.body().asUtf8String();
            
            // 3. ì‘ë‹µ íŒŒì‹±
            return parseYoloResponse(responseBody);
            
        } catch (Exception e) {
            log.error("SageMaker ì¶”ë¡  ì‹¤íŒ¨", e);
            throw new RuntimeException("YOLOv5 ì¶”ë¡  ì‹¤íŒ¨: " + e.getMessage(), e);
        }
    }
    
    /**
     * YOLOv5 ì‘ë‹µ íŒŒì‹±
     * ì˜ˆìƒ ì‘ë‹µ í˜•ì‹:
     * {
     *   "detections": [
     *     {"class": "ë¯¸ë€", "confidence": 0.87, "bbox": [x1, y1, x2, y2]},
     *     {"class": "ê²°ì ˆ", "confidence": 0.92, "bbox": [x1, y1, x2, y2]}
     *   ]
     * }
     */
    private YoloDetectionResult parseYoloResponse(String responseBody) {
        try {
            JsonNode root = objectMapper.readTree(responseBody);
            JsonNode detectionsNode = root.get("detections");
            
            List<String> diseases = new ArrayList<>();
            double maxConfidence = 0.0;
            
            if (detectionsNode != null && detectionsNode.isArray()) {
                for (JsonNode detection : detectionsNode) {
                    String disease = detection.get("class").asText();
                    double confidence = detection.get("confidence").asDouble();
                    
                    diseases.add(disease);
                    maxConfidence = Math.max(maxConfidence, confidence);
                }
            }
            
            return YoloDetectionResult.builder()
                    .diseases(diseases)
                    .confidence(maxConfidence)
                    .build();
            
        } catch (Exception e) {
            log.error("YOLOv5 ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨", e);
            throw new RuntimeException("ì‘ë‹µ íŒŒì‹± ì‹¤íŒ¨", e);
        }
    }
}

@Data
@Builder
class YoloDetectionResult {
    private List<String> diseases; // ["ë¯¸ë€", "ê²°ì ˆ"]
    private double confidence; // ìµœëŒ€ ì‹ ë¢°ë„
}
```

**4. Service Layer**

`SkinDiseaseService.java`:

```java
package com.petlog.healthcare.domain.skindisease.service;

import com.petlog.healthcare.domain.skindisease.entity.SkinDiseaseDetection;
import com.petlog.healthcare.domain.skindisease.repository.SkinDiseaseDetectionRepository;
import com.petlog.healthcare.infrastructure.yolo.SageMakerYoloClient;
import com.petlog.healthcare.infrastructure.s3.S3Service; // ê¸°ì¡´ S3 ì—…ë¡œë“œ ì„œë¹„ìŠ¤ ì¬ì‚¬ìš©
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import java.time.LocalDateTime;
import java.util.Base64;

/**
 * í”¼ë¶€ì§ˆí™˜ íƒì§€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
 * - ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ YOLOv5 ì¶”ë¡  â†’ ê²°ê³¼ ì €ì¥
 */
@Slf4j
@Service
@RequiredArgsConstructor
public class SkinDiseaseService {
    
    private final SkinDiseaseDetectionRepository detectionRepository;
    private final SageMakerYoloClient yoloClient;
    private final S3Service s3Service; // Diary Serviceì˜ S3 ì—…ë¡œë“œ ë¡œì§ ì°¸ê³ 
    
    /**
     * í”¼ë¶€ì§ˆí™˜ íƒì§€ ìˆ˜í–‰
     * @param userId ì‚¬ìš©ì ID
     * @param petId ë°˜ë ¤ë™ë¬¼ ID
     * @param image ì—…ë¡œë“œëœ ì´ë¯¸ì§€ íŒŒì¼
     * @return íƒì§€ ê²°ê³¼ (ì €ì¥ëœ Entity)
     */
    @Transactional
    public SkinDiseaseDetection detectDisease(Long userId, Long petId, MultipartFile image) {
        log.info("í”¼ë¶€ì§ˆí™˜ íƒì§€ ì‹œì‘ - userId: {}, petId: {}", userId, petId);
        
        try {
            // 1. S3ì— ì›ë³¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ
            String originalImageUrl = s3Service.uploadImage(image, "skin-disease");
            log.info("S3 ì—…ë¡œë“œ ì™„ë£Œ: {}", originalImageUrl);
            
            // 2. ì´ë¯¸ì§€ â†’ Base64 ë³€í™˜
            byte[] imageBytes = image.getBytes();
            String imageBase64 = Base64.getEncoder().encodeToString(imageBytes);
            
            // 3. YOLOv5 ì¶”ë¡  (SageMaker)
            var yoloResult = yoloClient.detectSkinDisease(imageBase64);
            log.info("íƒì§€ ì™„ë£Œ - ì§ˆí™˜: {}, ì‹ ë¢°ë„: {}", yoloResult.getDiseases(), yoloResult.getConfidence());
            
            // 4. DB ì €ì¥
            SkinDiseaseDetection detection = SkinDiseaseDetection.builder()
                    .userId(userId)
                    .petId(petId)
                    .originalImageUrl(originalImageUrl)
                    .detectedDiseases(String.join(",", yoloResult.getDiseases())) // "ë¯¸ë€,ê²°ì ˆ"
                    .confidence(yoloResult.getConfidence())
                    .detectedAt(LocalDateTime.now())
                    .build();
            
            return detectionRepository.save(detection);
            
        } catch (Exception e) {
            log.error("í”¼ë¶€ì§ˆí™˜ íƒì§€ ì‹¤íŒ¨", e);
            throw new RuntimeException("íƒì§€ ì‹¤íŒ¨: " + e.getMessage(), e);
        }
    }
    
    /**
     * íŠ¹ì • ë°˜ë ¤ë™ë¬¼ì˜ íƒì§€ ê¸°ë¡ ì¡°íšŒ
     */
    public List<SkinDiseaseDetection> getDetectionHistory(Long userId, Long petId) {
        return detectionRepository.findByUserIdAndPetIdOrderByDetectedAtDesc(userId, petId);
    }
}
```

**5. Controller**

`SkinDiseaseController.java`:

```java
package com.petlog.healthcare.api.controller;

import com.petlog.healthcare.domain.skindisease.entity.SkinDiseaseDetection;
import com.petlog.healthcare.domain.skindisease.service.SkinDiseaseService;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;
import org.springframework.web.multipart.MultipartFile;

import java.util.*;

/**
 * í”¼ë¶€ì§ˆí™˜ íƒì§€ API
 * - POST /api/skin-disease/detect: ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° íƒì§€
 * - GET /api/skin-disease/history: íƒì§€ ê¸°ë¡ ì¡°íšŒ
 */
@Slf4j
@RestController
@RequestMapping("/api/skin-disease")
@RequiredArgsConstructor
public class SkinDiseaseController {
    
    private final SkinDiseaseService skinDiseaseService;
    
    /**
     * í”¼ë¶€ì§ˆí™˜ íƒì§€ ìˆ˜í–‰
     * 
     * @param userId ì‚¬ìš©ì ID
     * @param petId ë°˜ë ¤ë™ë¬¼ ID
     * @param image ì—…ë¡œë“œëœ ì´ë¯¸ì§€ íŒŒì¼ (multipart/form-data)
     * @return íƒì§€ ê²°ê³¼
     * 
     * ì˜ˆì œ ìš”ì²­ (Postman):
     * POST http://localhost:8085/api/skin-disease/detect
     * Form-data:
     *   - userId: 123
     *   - petId: 456
     *   - image: [íŒŒì¼ ì„ íƒ]
     */
    @PostMapping("/detect")
    public ResponseEntity<Map<String, Object>> detectSkinDisease(
            @RequestParam Long userId,
            @RequestParam Long petId,
            @RequestParam("image") MultipartFile image) {
        
        log.info("í”¼ë¶€ì§ˆí™˜ íƒì§€ ìš”ì²­ - userId: {}, petId: {}", userId, petId);
        
        try {
            // 1. íŒŒì¼ ê²€ì¦
            if (image.isEmpty()) {
                return ResponseEntity.badRequest()
                        .body(Map.of("error", "ì´ë¯¸ì§€ íŒŒì¼ì´ í•„ìš”í•©ë‹ˆë‹¤."));
            }
            
            // 2. íƒì§€ ìˆ˜í–‰
            SkinDiseaseDetection result = skinDiseaseService.detectDisease(userId, petId, image);
            
            // 3. ì‘ë‹µ ìƒì„±
            Map<String, Object> response = new HashMap<>();
            response.put("status", "success");
            response.put("detectionId", result.getId());
            response.put("diseases", Arrays.asList(result.getDetectedDiseases().split(",")));
            response.put("confidence", result.getConfidence());
            response.put("imageUrl", result.getOriginalImageUrl());
            response.put("detectedAt", result.getDetectedAt());
            
            return ResponseEntity.ok(response);
            
        } catch (Exception e) {
            log.error("íƒì§€ API ì˜¤ë¥˜", e);
            return ResponseEntity.internalServerError()
                    .body(Map.of("error", e.getMessage()));
        }
    }
    
    /**
     * íƒì§€ ê¸°ë¡ ì¡°íšŒ
     * 
     * GET /api/skin-disease/history?userId=123&petId=456
     */
    @GetMapping("/history")
    public ResponseEntity<List<SkinDiseaseDetection>> getHistory(
            @RequestParam Long userId,
            @RequestParam Long petId) {
        
        List<SkinDiseaseDetection> history = skinDiseaseService.getDetectionHistory(userId, petId);
        return ResponseEntity.ok(history);
    }
}
```

**6. application-dev.yml ì„¤ì • ì¶”ê°€**

```yaml
# AWS SageMaker ì„¤ì •
aws:
  sagemaker:
    endpoint-name: ${SAGEMAKER_ENDPOINT_NAME:pet-skin-disease-endpoint}
    region: ${AWS_REGION:ap-northeast-2}
```

**ì»¤ë°‹ ë©”ì‹œì§€:**

```
[Feat#6]: í”¼ë¶€ì§ˆí™˜ íƒì§€ Backend API êµ¬í˜„
- Entity: SkinDiseaseDetection (íƒì§€ ê¸°ë¡ ì €ì¥)
- Infrastructure: SageMakerYoloClient (SageMaker Endpoint í˜¸ì¶œ)
- Service: SkinDiseaseService (ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ ì¶”ë¡  â†’ ì €ì¥)
- Controller: POST /api/skin-disease/detect, GET /api/skin-disease/history
- S3Service ì¬ì‚¬ìš©í•˜ì—¬ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì²˜ë¦¬
- WHY: MSA ì›ì¹™ì— ë”°ë¼ Healthcare Service ë‚´ Featureë¡œ í†µí•©
  (ë³„ë„ Service ë¶„ë¦¬ ì‹œ ë„¤íŠ¸ì›Œí¬ ì˜¤ë²„í—¤ë“œ ë°œìƒ)

Issue: Closes #6
```


***

#### **Day 3: ë™ë¬¼ë³‘ì› ì°¾ê¸° API**

**ğŸ“Œ Jira Issue: Feat\#7 - ë™ë¬¼ë³‘ì› ì°¾ê¸° API êµ¬í˜„**

**1. Entity**

`AnimalHospital.java`:

```java
package com.petlog.healthcare.domain.hospital.entity;

import jakarta.persistence.*;
import lombok.*;

/**
 * ì „êµ­ ë™ë¬¼ë³‘ì› ì •ë³´ Entity
 * - ê³µê³µë°ì´í„°í¬í„¸ ë°ì´í„° ê¸°ë°˜
 */
@Entity
@Table(name = "animal_hospitals")
@Getter @Setter
@NoArgsConstructor @AllArgsConstructor
@Builder
public class AnimalHospital {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    /** ë³‘ì›ëª… */
    @Column(nullable = false)
    private String name;
    
    /** ì£¼ì†Œ */
    @Column(nullable = false)
    private String address;
    
    /** ì „í™”ë²ˆí˜¸ */
    private String phone;
    
    /** ìœ„ë„ */
    private Double latitude;
    
    /** ê²½ë„ */
    private Double longitude;
    
    /** ì§„ë£Œ ì‹œê°„ (JSON í˜•ì‹) */
    @Column(columnDefinition = "TEXT")
    private String operatingHours;
}
```

**2. Repository + Service**

```java
// Repository
public interface AnimalHospitalRepository extends JpaRepository<AnimalHospital, Long> {
    
    /** ì£¼ì†Œ ê¸°ë°˜ ê²€ìƒ‰ (ì‹œ/êµ¬/ë™) */
    List<AnimalHospital> findByAddressContaining(String keyword);
    
    /** ë°˜ê²½ ë‚´ ë³‘ì› ê²€ìƒ‰ (Haversine ê³µì‹ ì‚¬ìš©) */
    @Query(value = """
        SELECT *, 
               (6371 * acos(cos(radians(:lat)) * cos(radians(latitude)) 
               * cos(radians(longitude) - radians(:lng)) 
               + sin(radians(:lat)) * sin(radians(latitude)))) AS distance
        FROM animal_hospitals
        HAVING distance < :radiusKm
        ORDER BY distance
        LIMIT :limit
        """, nativeQuery = true)
    List<AnimalHospital> findByProximity(
            @Param("lat") Double latitude,
            @Param("lng") Double longitude,
            @Param("radiusKm") Double radiusKm,
            @Param("limit") int limit);
}

// Service
@Service
@RequiredArgsConstructor
public class HospitalService {
    
    private final AnimalHospitalRepository hospitalRepository;
    
    /**
     * ì‚¬ìš©ì ìœ„ì¹˜ ê¸°ì¤€ ë°˜ê²½ N km ë‚´ ë³‘ì› ê²€ìƒ‰
     */
    public List<AnimalHospital> findNearbyHospitals(Double latitude, Double longitude, Double radiusKm) {
        return hospitalRepository.findByProximity(latitude, longitude, radiusKm, 20);
    }
}
```

**3. Controller**

```java
@RestController
@RequestMapping("/api/hospitals")
@RequiredArgsConstructor
public class HospitalController {
    
    private final HospitalService hospitalService;
    
    /**
     * ê°€ê¹Œìš´ ë™ë¬¼ë³‘ì› ì°¾ê¸°
     * GET /api/hospitals/nearby?lat=37.5665&lng=126.9780&radius=5
     */
    @GetMapping("/nearby")
    public ResponseEntity<List<AnimalHospital>> findNearby(
            @RequestParam Double lat,
            @RequestParam Double lng,
            @RequestParam(defaultValue = "5.0") Double radius) {
        
        List<AnimalHospital> hospitals = hospitalService.findNearbyHospitals(lat, lng, radius);
        return ResponseEntity.ok(hospitals);
    }
}
```

**4. ë°°ì¹˜ ì‘ì—… (ê³µê³µë°ì´í„° ë™ê¸°í™”)**

```java
@Component
@RequiredArgsConstructor
@Slf4j
public class HospitalDataSyncScheduler {
    
    private final AnimalHospitalRepository hospitalRepository;
    
    /**
     * ë§¤ì¼ ìƒˆë²½ 3ì‹œ ê³µê³µë°ì´í„° ë™ê¸°í™”
     */
    @Scheduled(cron = "0 0 3 * * *")
    public void syncHospitalData() {
        log.info("ë™ë¬¼ë³‘ì› ë°ì´í„° ë™ê¸°í™” ì‹œì‘");
        
        // TODO: ê³µê³µë°ì´í„°í¬í„¸ API í˜¸ì¶œ â†’ DB ì €ì¥
        // 1íšŒ êµ¬í˜„ í›„ ë°°ì¹˜ë¡œ ìë™í™”
    }
}
```

**ì»¤ë°‹ ë©”ì‹œì§€:**

```
[Feat#7]: ê°€ê¹Œìš´ ë™ë¬¼ë³‘ì› ì°¾ê¸° API êµ¬í˜„
- Entity: AnimalHospital (ë³‘ì› ì •ë³´)
- Repository: Haversine ê³µì‹ ê¸°ë°˜ ë°˜ê²½ ê²€ìƒ‰ Native Query
- Service: findNearbyHospitals (ìœ„ë„/ê²½ë„ ê¸°ë°˜)
- Controller: GET /api/hospitals/nearby
- Scheduler: ë§¤ì¼ ìƒˆë²½ 3ì‹œ ê³µê³µë°ì´í„° ë™ê¸°í™” (ë°°ì¹˜)
- WHY: ê³µê³µë°ì´í„° API ì§ì ‘ í˜¸ì¶œ ëŒ€ì‹  ìì²´ DB ìºì‹±ìœ¼ë¡œ ì‘ë‹µ ì†ë„ ê°œì„ 

Issue: Closes #7
```


***

## ğŸ“ API Gateway ë¼ìš°íŒ… ì¶”ê°€

**`api_gateway/application.yml` ìˆ˜ì •:**

```yaml
spring:
  cloud:
    gateway:
      routes:
        # ê¸°ì¡´ healthcare ë¼ìš°íŒ…
        - id: healthcare-chatbot
          uri: http://localhost:8085
          predicates:
            - Path=/api/chat/**
        
        # í”¼ë¶€ì§ˆí™˜ íƒì§€ (NEW)
        - id: healthcare-skin-disease
          uri: http://localhost:8085
          predicates:
            - Path=/api/skin-disease/**
        
        # ë™ë¬¼ë³‘ì› ì°¾ê¸° (NEW)
        - id: healthcare-hospitals
          uri: http://localhost:8085
          predicates:
            - Path=/api/hospitals/**
```

**ë°°í¬ ë‹´ë‹¹ìì—ê²Œ ìš”ì²­ì‚¬í•­:**
> Gateway ì„¤ì • íŒŒì¼ì— ìœ„ 2ê°œ ë¼ìš°íŒ… ì¶”ê°€í•´ì£¼ì„¸ìš”. Healthcare Service 8085 í¬íŠ¸ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.

***

## ğŸ¨ Frontend ì—°ë™ ê°€ì´ë“œ (íŒ€ì›ì—ê²Œ ì „ë‹¬ìš©)

### **í”¼ë¶€ì§ˆí™˜ íƒì§€ í™”ë©´**

**API ëª…ì„¸:**

```javascript
// 1. ì´ë¯¸ì§€ ì—…ë¡œë“œ ë° íƒì§€
POST https://d3uvkb1qxxcp2y.cloudfront.net/api/skin-disease/detect
Content-Type: multipart/form-data

{
  userId: 123,
  petId: 456,
  image: [File]
}

// ì‘ë‹µ
{
  "status": "success",
  "detectionId": 1,
  "diseases": ["ë¯¸ë€", "ê²°ì ˆ"],
  "confidence": 0.92,
  "imageUrl": "https://s3.amazonaws.com/...",
  "detectedAt": "2026-01-03T12:00:00"
}

// 2. íƒì§€ ê¸°ë¡ ì¡°íšŒ
GET https://d3uvkb1qxxcp2y.cloudfront.net/api/skin-disease/history?userId=123&petId=456
```


### **ë™ë¬¼ë³‘ì› ì°¾ê¸° í™”ë©´**

**API ëª…ì„¸:**

```javascript
GET https://d3uvkb1qxxcp2y.cloudfront.net/api/hospitals/nearby?lat=37.5665&lng=126.9780&radius=5

// ì‘ë‹µ
[
  {
    "id": 1,
    "name": "ì„œìš¸ë™ë¬¼ë³‘ì›",
    "address": "ì„œìš¸ì‹œ ì¤‘êµ¬ ëª…ë™ê¸¸ 123",
    "phone": "02-1234-5678",
    "latitude": 37.5665,
    "longitude": 126.9780,
    "operatingHours": "{\"mon\":\"09:00-18:00\"}"
  }
]
```

**UI/UX ì°¸ê³ :**

- [lifet.co.kr](https://lifet.co.kr/) - ê±´ê°• ì²´í¬ í”Œë¡œìš°
- [vdoc.kr](https://ai.vdoc.kr/) - AI ë¶„ì„ ê²°ê³¼ í‘œì‹œ ë°©ì‹

***

## âœ… ì²´í¬ë¦¬ìŠ¤íŠ¸

### **Sprint 1.5 ì™„ë£Œ ê¸°ì¤€ (Definition of Done)**

- [ ] YOLOv5 ëª¨ë¸ SageMaker ë°°í¬ ì™„ë£Œ (Endpoint URL í™•ë³´)
- [ ] `POST /api/skin-disease/detect` API êµ¬í˜„ ë° Postman í…ŒìŠ¤íŠ¸ í†µê³¼
- [ ] `GET /api/skin-disease/history` API êµ¬í˜„
- [ ] `GET /api/hospitals/nearby` API êµ¬í˜„
- [ ] Gateway ë¼ìš°íŒ… ì¶”ê°€ (ë°°í¬ ë‹´ë‹¹ì í™•ì¸)
- [ ] Swagger ë¬¸ì„œ ì—…ë°ì´íŠ¸
- [ ] Git Commit Convention ì¤€ìˆ˜
- [ ] Jira Issue \#5, \#6, \#7 Close

***

## ğŸ¤ í˜‘ì—… ìš”ì²­ì‚¬í•­

### **ë°°í¬ ë‹´ë‹¹ìì—ê²Œ:**

1. SageMaker Endpoint ìƒì„± ì§€ì›
2. API Gateway ë¼ìš°íŒ… ì¶”ê°€
3. S3 Bucket ê¶Œí•œ ì„¤ì • (skin-disease í´ë”)

### **Frontend íŒ€ì›ì—ê²Œ:**

1. Healthcare íƒ­ì— 2ê°œ í•˜ìœ„ ë©”ë‰´ ì¶”ê°€
    - "í”¼ë¶€ì§ˆí™˜ ì²´í¬"
    - "ê°€ê¹Œìš´ ë³‘ì› ì°¾ê¸°"
2. ì´ë¯¸ì§€ ì—…ë¡œë“œ UI (react-dropzone ê¶Œì¥)
3. ì§€ë„ ë¼ì´ë¸ŒëŸ¬ë¦¬ (Kakao Map API ë˜ëŠ” Naver Map API)

***

ì´ì œ êµ¬í˜„ ì‹œì‘í• ê¹Œìš”? ì–´ë–¤ ë¶€ë¶„ë¶€í„° ì§„í–‰í•˜ë©´ ì¢‹ì„ì§€ ë§ì”€í•´ì£¼ì„¸ìš”! ğŸš€
<span style="display:none">[^2_3][^2_4][^2_5][^2_6][^2_7]</span>

<div align="center">â‚</div>

[^2_1]: helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^2_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^2_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^2_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^2_5]: naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gij.pdf

[^2_6]: ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^2_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md


---

## TRELLIS.2 ë¶„ì„ ë° í˜ë¥´ì†Œë‚˜ ì±—ë´‡ êµ¬í˜„ ë°©ì•ˆ

TRELLIS.2ë¥¼ ê²€í† í•œ ê²°ê³¼, **healthcare AI ì±—ë´‡ì˜ í˜ë¥´ì†Œë‚˜ ê¸°ëŠ¥ì—ëŠ” ì í•©í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤**. ëŒ€ì‹  **ë” íš¨ìœ¨ì ì´ê³  ì‹¤í˜„ ê°€ëŠ¥í•œ ëŒ€ì•ˆ**ì„ ì œì‹œí•˜ê² ìŠµë‹ˆë‹¤.

### TRELLIS.2ê°€ ë¶€ì í•©í•œ ì´ìœ 

TRELLIS.2ëŠ” ê³ í’ˆì§ˆ 3D ì—ì…‹ ìƒì„±ì— ìµœì í™”ëœ ë„êµ¬ì§€ë§Œ, ì‹¤ì‹œê°„ ì±—ë´‡ í˜ë¥´ì†Œë‚˜ë¡œëŠ” ë‹¤ìŒê³¼ ê°™ì€ í•œê³„ê°€ ìˆìŠµë‹ˆë‹¤:

- **í•˜ë“œì›¨ì–´ ìš”êµ¬ì‚¬í•­**: ìµœì†Œ 24GB VRAM (NVIDIA A100/H100 ìˆ˜ì¤€) í•„ìš” - í”„ë¡œë•ì…˜ í™˜ê²½ì— ë¶€ë‹´
- **ìƒì„± ì†ë„**: 512Â³ í•´ìƒë„ ê¸°ì¤€ ~3ì´ˆ, 1024Â³ëŠ” ~17ì´ˆ ì†Œìš” - ì‹¤ì‹œê°„ ìƒí˜¸ì‘ìš© ë¶ˆê°€ëŠ¥
- **ìš©ë„ ë¯¸ìŠ¤ë§¤ì¹˜**: ì •ì  3D ëª¨ë¸ ìƒì„±ìš©ì´ì§€ ì‹¤ì‹œê°„ ì• ë‹ˆë©”ì´ì…˜/ëŒ€í™”í˜• ì•„ë°”íƒ€ìš©ì´ ì•„ë‹˜
- **ì¸í”„ë¼ ë³µì¡ë„**: Linux ì „ìš©, CUDA Toolkit 12.4, ë³µì¡í•œ ì˜ì¡´ì„± ê´€ë¦¬ í•„ìš”


### ì¶”ì²œ ì†”ë£¨ì…˜: Meshy.ai API + Ready Player Me

healthcare ì±—ë´‡ í˜ë¥´ì†Œë‚˜ì— ìµœì í™”ëœ **3ë‹¨ê³„ ê²½ëŸ‰ ì•„í‚¤í…ì²˜**ë¥¼ ì œì•ˆí•©ë‹ˆë‹¤:

#### 1ë‹¨ê³„: í« 3D ëª¨ë¸ ìƒì„± (ìµœì´ˆ 1íšŒ)

**Meshy.ai Image-to-3D API í™œìš©**

```yaml
# WHY: API ê¸°ë°˜ìœ¼ë¡œ ì¸í”„ë¼ ë¶€ë‹´ ì—†ì´ ê³ í’ˆì§ˆ 3D ëª¨ë¸ ìƒì„± ê°€ëŠ¥
ì—”ë“œí¬ì¸íŠ¸: POST /openapi/v1/image-to-3d
ì²˜ë¦¬ì‹œê°„: ~2ë¶„ (ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…)
ì¶œë ¥í˜•ì‹: GLB, FBX, OBJ (WebGL í˜¸í™˜)
ê°€ê²©: ë¬´ë£Œ í”Œëœ ì œê³µ, ìœ ë£Œ ì‹œ ê±´ë‹¹ $0.1-0.5
```

**êµ¬í˜„ íë¦„**:

```javascript
// ì‚¬ìš©ìê°€ í« ì‚¬ì§„ ë“±ë¡ ì‹œ (user_serviceì—ì„œ í˜¸ì¶œ)
async function generate3DPetAvatar(petImageUrl, userId) {
  const response = await fetch('https://api.meshy.ai/openapi/v1/image-to-3d', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${MESHY_API_KEY}`,
      'Content-Type': 'application/json'
    },
    body: JSON.stringify({
      image_url: petImageUrl,
      enable_pbr: true,  // í…ìŠ¤ì²˜ í’ˆì§ˆ í–¥ìƒ
      topology: 'quad'    // ì• ë‹ˆë©”ì´ì…˜ í˜¸í™˜ì„±
    })
  });
  
  const taskId = await response.json();
  // S3ì— taskId ì €ì¥ í›„ webhookìœ¼ë¡œ ì™„ë£Œ ì²˜ë¦¬
  return taskId;
}
```


#### 2ë‹¨ê³„: ê²½ëŸ‰ ì›¹ ë Œë”ë§

**Three.js + Ready Player Me ì• ë‹ˆë©”ì´ì…˜ ì‹œìŠ¤í…œ**

```javascript
// Frontend: healthcareAIchatbot ì»´í¬ë„ŒíŠ¸
import * as THREE from 'three';
import { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader';

class PetAvatarRenderer {
  constructor(containerId) {
    this.scene = new THREE.Scene();
    this.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    this.renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
    // WHY: WebGLì€ ëª¨ë“  ë¸Œë¼ìš°ì € ì§€ì›, ë³„ë„ í”ŒëŸ¬ê·¸ì¸ ë¶ˆí•„ìš”
    
    this.initIdleAnimation(); // ê¸°ë³¸ idle ì• ë‹ˆë©”ì´ì…˜ (í˜¸í¡, ê¼¬ë¦¬ í”ë“¤ê¸°)
  }
  
  async loadPetModel(glbUrl) {
    const loader = new GLTFLoader();
    const gltf = await loader.loadAsync(glbUrl);
    this.pet = gltf.scene;
    this.mixer = new THREE.AnimationMixer(this.pet);
    
    // ì‚¬ì „ ì •ì˜ëœ ì• ë‹ˆë©”ì´ì…˜ (ì•‰ê¸°, ì„œê¸°, ê³ ê°œ ë„ë•ì´ê¸°)
    this.animations = {
      idle: this.mixer.clipAction(gltf.animations[^3_0]),
      nod: this.mixer.clipAction(this.createNodAnimation()),
      happy: this.mixer.clipAction(this.createHappyAnimation())
    };
  }
  
  // ì±—ë´‡ ì‘ë‹µì— ë”°ë¼ ì• ë‹ˆë©”ì´ì…˜ íŠ¸ë¦¬ê±°
  reactToMessage(sentiment) {
    // WHY: AI ê°ì • ë¶„ì„ ê²°ê³¼ì— ë”°ë¼ ë™ì  ë°˜ì‘ ì œê³µ
    if (sentiment === 'positive') this.animations.happy.play();
    else if (sentiment === 'question') this.animations.nod.play();
  }
}
```


#### 3ë‹¨ê³„: í—¬ìŠ¤ì¼€ì–´ ì±—ë´‡ í†µí•©

**Backend: healthcare_AIchatbot_service**

```python
# healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/PersonaChatService.java

@Service
public class PersonaChatService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @Autowired
    private S3Service s3Service;
    
    // ì‚¬ìš©ìì˜ í« 3D ëª¨ë¸ URL ì¡°íšŒ
    public String getPet3DModelUrl(Long userId) {
        // user_service API í˜¸ì¶œë¡œ í« ì •ë³´ ê°€ì ¸ì˜¤ê¸°
        String userServiceUrl = "http://user-service:8080/api/users/" + userId + "/pet";
        PetProfileResponse pet = restTemplate.getForObject(userServiceUrl, PetProfileResponse.class);
        
        // S3ì—ì„œ 3D ëª¨ë¸ URL ë°˜í™˜ (ì´ë¯¸ ìƒì„±ëœ ê²½ìš°)
        if (pet.getModel3dUrl() != null) {
            return s3Service.getPresignedUrl(pet.getModel3dUrl());
        }
        
        // WHY: ìµœì´ˆ ìš”ì²­ ì‹œì—ë§Œ ìƒì„±, ì´í›„ì—” ìºì‹±ëœ ëª¨ë¸ ì¬ì‚¬ìš©
        return generateAndCache3DModel(pet.getPhotoUrl(), userId);
    }
    
    // AI ì±—ë´‡ ì‘ë‹µ ìƒì„± (ê¸°ì¡´ ë¡œì§ + ì• ë‹ˆë©”ì´ì…˜ íŒíŠ¸ ì¶”ê°€)
    public ChatResponse generateResponse(String userMessage, Long userId) {
        // ê¸°ì¡´ AI ëª¨ë¸ í˜¸ì¶œ
        String aiResponse = callOpenAI(userMessage);
        
        // ê°ì • ë¶„ì„ (ê°„ë‹¨í•œ í‚¤ì›Œë“œ ê¸°ë°˜ ë˜ëŠ” ë³„ë„ API)
        String animationHint = analyzeSentiment(aiResponse);
        
        return ChatResponse.builder()
            .message(aiResponse)
            .animationHint(animationHint)  // "happy", "nod", "idle"
            .pet3dModelUrl(getPet3DModelUrl(userId))
            .build();
    }
}
```


### ëŒ€ì•ˆ ì†”ë£¨ì…˜ ë¹„êµí‘œ

| í•­ëª© | TRELLIS.2 | **Meshy.ai + Three.js (ì¶”ì²œ)** | DogRecon |
| :-- | :-- | :-- | :-- |
| **ì´ˆê¸° ì„¤ì •** | ë§¤ìš° ë³µì¡ (ì „ìš© ì„œë²„ í•„ìš”) | ê°„ë‹¨ (API í‚¤ë§Œ í•„ìš”) | ì—°êµ¬ìš© ì½”ë“œ (í”„ë¡œë•ì…˜ ë¶€ì í•©) |
| **ìƒì„± ì‹œê°„** | 3-60ì´ˆ (í•´ìƒë„ë³„) | ~2ë¶„ (ë°±ê·¸ë¼ìš´ë“œ) | ë¶ˆëª…í™• |
| **ë¸Œë¼ìš°ì € ë Œë”ë§** | ì§€ì› ì•ˆ í•¨ | âœ… WebGL ë„¤ì´í‹°ë¸Œ | ì§€ì› ì•ˆ í•¨ |
| **ì• ë‹ˆë©”ì´ì…˜** | ì •ì  ëª¨ë¸ë§Œ | âœ… Three.js ì• ë‹ˆë©”ì´ì…˜ | âœ… ê°€ëŠ¥ (ë³µì¡í•¨) |
| **ë¹„ìš©** | ì¸í”„ë¼ ë¹„ìš© ë†’ìŒ | \$0 (ë¬´ë£Œ í”Œëœ) ~ \$20/ì›” | ë¬´ë£Œ (êµ¬í˜„ ë¹„ìš© ë†’ìŒ) |
| **ì‹œì—° ì í•©ì„±** | âŒ ì„¤ì • ë³µì¡ | âœ… 10íšŒ ì´í•˜ ì¶©ë¶„ | â–³ í•™ìˆ  ëª©ì  |

### ì¶”ì²œ êµ¬í˜„ ë‹¨ê³„

#### Phase 1: ìµœì†Œ ê¸°ëŠ¥ êµ¬í˜„ (1-2ì¼)

1. **Meshy.ai API í†µí•©** (healthcare_AIchatbot_service)
    - API í‚¤ ë°œê¸‰ ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    - ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ 3D ëª¨ë¸ ìƒì„± ì—”ë“œí¬ì¸íŠ¸ êµ¬í˜„
    - S3 ë²„í‚·ì— GLB íŒŒì¼ ì €ì¥
```bash
# .env (healthcare_AIchatbot_service)
MESHY_API_KEY=your_api_key_here
MESHY_WEBHOOK_URL=https://your-domain.com/webhook/meshy
```

2. **Frontend Three.js ë·°ì–´** (Frontend repo)
    - `/src/components/HealthcareChat/PetAvatar3D.jsx` ìƒì„±
    - GLB íŒŒì¼ ë¡œë“œ ë° ê¸°ë³¸ íšŒì „ ì• ë‹ˆë©”ì´ì…˜
```jsx
// Frontend/src/components/HealthcareChat/PetAvatar3D.jsx
import { Canvas } from '@react-three-fiber';
import { useGLTF } from '@react-three-drei';

export function PetAvatar3D({ modelUrl }) {
  const { scene } = useGLTF(modelUrl);
  
  return (
    <Canvas camera={{ position: [0, 0, 5] }}>
      <ambientLight intensity={0.5} />
      <primitive object={scene} />
    </Canvas>
  );
}
```


#### Phase 2: ì¸í„°ë™ì…˜ ì¶”ê°€ (2-3ì¼)

3. **ê°ì • ê¸°ë°˜ ì• ë‹ˆë©”ì´ì…˜**
    - AI ì‘ë‹µ ê°ì • ë¶„ì„ (positive/neutral/question)
    - ì‚¬ì „ ì œì‘ëœ ì• ë‹ˆë©”ì´ì…˜ í´ë¦½ ì ìš©
4. **ìŒì„± ë¦½ì‹±í¬** (ì„ íƒì‚¬í•­)
    - Web Speech API ë˜ëŠ” Deepgram APIë¡œ ìŒì„± ìƒì„±
    - ê°„ë‹¨í•œ jaw bone ì• ë‹ˆë©”ì´ì…˜ ë™ê¸°í™”

#### Phase 3: ìµœì í™” (1ì¼)

5. **ë¡œë”© ìµœì í™”**
    - GLB íŒŒì¼ Draco ì••ì¶•
    - Progressive loading with placeholder

### Git ì‘ì—… í”Œë¡œìš°

```bash
# 1. Feature ë¸Œëœì¹˜ ìƒì„±
git checkout -b feat/persona-3d-avatar

# 2. ì´ìŠˆ ìƒì„± (GitHub)
# ì œëª©: Feat#XX: í« í˜ë¥´ì†Œë‚˜ 3D ì•„ë°”íƒ€ êµ¬í˜„
# ë¼ë²¨: enhancement, healthcare-service

# 3. ì»¤ë°‹ ë‹¨ìœ„
[Feat] : Meshy.ai API í†µí•© ë° 3D ëª¨ë¸ ìƒì„± ì—”ë“œí¬ì¸íŠ¸
- Meshy.ai REST API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
- ì´ë¯¸ì§€ â†’ 3D ë³€í™˜ ë¹„ë™ê¸° ì²˜ë¦¬ ë¡œì§
- S3 ì—…ë¡œë“œ ë° URL ë°˜í™˜

Issue: #XX

[Feat] : Three.js ê¸°ë°˜ 3D í« ë·°ì–´ ì»´í¬ë„ŒíŠ¸ êµ¬í˜„
- PetAvatar3D.jsx ì»´í¬ë„ŒíŠ¸ ì¶”ê°€
- GLB íŒŒì¼ ë¡œë“œ ë° ë Œë”ë§
- ê¸°ë³¸ idle ì• ë‹ˆë©”ì´ì…˜ ì ìš©

Issue: #XX

# 4. PR ìƒì„±
[Feat] Healthcare Service í« í˜ë¥´ì†Œë‚˜ 3D ì•„ë°”íƒ€ í†µí•©

## ê´€ë ¨ ì´ìŠˆ
Closes #XX

## ì‘ì—… ë‚´ìš©
- Meshy.ai API ì—°ë™ìœ¼ë¡œ ì‚¬ìš©ì í« ì‚¬ì§„ â†’ 3D ëª¨ë¸ ìë™ ìƒì„±
- Three.js ê¸°ë°˜ WebGL ë Œë”ëŸ¬ êµ¬í˜„
- AI ì±—ë´‡ ì‘ë‹µì— ë”°ë¥¸ ë™ì  ì• ë‹ˆë©”ì´ì…˜ ì‹œìŠ¤í…œ

## í…ŒìŠ¤íŠ¸ ê²°ê³¼
- [x] Postman: POST /api/healthcare/avatar/generate
- [x] Frontend: 3D ëª¨ë¸ ë¡œë”© ë° ë Œë”ë§ í™•ì¸
- [x] 10íšŒ ì‹œì—° í…ŒìŠ¤íŠ¸ ì™„ë£Œ

## ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·
(3D í« ì•„ë°”íƒ€ ë Œë”ë§ ìº¡ì²˜)
```


### ë°°í¬ ë‹´ë‹¹ì ì „ë‹¬ ì‚¬í•­

```yaml
# í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€ ìš”ì²­ (ArgoCD manifest)
healthcare-service:
  env:
    - name: MESHY_API_KEY
      valueFrom:
        secretKeyRef:
          name: healthcare-secrets
          key: meshy-api-key
    - name: MESHY_WEBHOOK_URL
      value: "https://api.yourproject.com/webhook/meshy"

# CORS ì„¤ì • (API Gateway)
- path: /api/healthcare/avatar/*
  cors:
    allowOrigins: ["https://d3uvkb1qxxcp2y.cloudfront.net"]
    allowMethods: ["GET", "POST"]
```


### ì¶”ê°€ ê³ ë ¤ì‚¬í•­

1. **ë°±ì—… í”Œëœ**: Meshy API ì¥ì•  ì‹œ ì •ì  2D ì´ë¯¸ì§€ + CSS ì• ë‹ˆë©”ì´ì…˜ìœ¼ë¡œ í´ë°±
2. **ë¹„ìš© ê´€ë¦¬**: ë¬´ë£Œ í”Œëœ í•œë„ (ì›” 100íšŒ) ì´ˆê³¼ ì‹œ ê²½ê³  ì•Œë¦¼ ì„¤ì •
3. **ì„±ëŠ¥**: GLB íŒŒì¼ í¬ê¸° 5MB ì´í•˜ë¡œ ì œí•œ, CDN ìºì‹± í™œìš©
4. **ëŒ€ì•ˆ API**: Tripo3D.ai (ë” ë¹ ë¥¸ ìƒì„± ì†ë„, ìœ ì‚¬í•œ ê°€ê²©)

TRELLIS.2ëŠ” **ê²Œì„/ì˜í™” ì œì‘ìš© ê³ í’ˆì§ˆ ì—ì…‹ ìƒì„±**ì—ëŠ” ìš°ìˆ˜í•˜ì§€ë§Œ, **ì‹¤ì‹œê°„ ì›¹ ì±—ë´‡ í˜ë¥´ì†Œë‚˜**ì—ëŠ” Meshy.ai + Three.js ì¡°í•©ì´ í˜„ì‹¤ì ì´ê³  íš¨ìœ¨ì ì…ë‹ˆë‹¤.
<span style="display:none">[^3_1][^3_10][^3_11][^3_12][^3_13][^3_14][^3_15][^3_16][^3_17][^3_18][^3_19][^3_2][^3_20][^3_21][^3_22][^3_23][^3_24][^3_25][^3_26][^3_27][^3_28][^3_29][^3_3][^3_30][^3_31][^3_32][^3_33][^3_34][^3_35][^3_36][^3_37][^3_38][^3_39][^3_4][^3_40][^3_41][^3_42][^3_43][^3_44][^3_45][^3_46][^3_47][^3_5][^3_6][^3_7][^3_8][^3_9]</span>

<div align="center">â‚</div>

[^3_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^3_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^3_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^3_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^3_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^3_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^3_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^3_8]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ìˆ˜ì •ì²´ íƒˆêµ¬ì— ëŒ€í•´

[^3_9]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ë°©ê´‘ì—¼ A to Z

[^3_10]: https://lifet.co.kr/Contents/Detail/ê³ ì–‘ì´ ë‹¹ë‡¨ì— ëŒ€í•´ì„œ

[^3_11]: https://lifet.co.kr/Store/Brand/Rankings

[^3_12]: https://lifet.co.kr/Store/Product/Brand?brand=ìŠ¤í˜ì‹œí”½

[^3_13]: https://lifet.co.kr

[^3_14]: https://lifet.co.kr/Contents/Detail/í‚¤í† ì‚° A to Z

[^3_15]: https://lifet.co.kr/Contents/Detail/ì•ŒíŒŒ-ì¹´ì†Œì œí•€ A to Z

[^3_16]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ í•­ë¬¸ë‚­ ì§ˆí™˜ì— ëŒ€í•´

[^3_17]: https://lifet.co.kr/Chat/List/24/236E68B21FCB4A109344B4CD7B900DA8

[^3_18]: https://lifet.co.kr/Store/Product/Detail?productCode=P00208

[^3_19]: https://lifet.co.kr/Contents/Detail/ë¹„ë³€ì„± ì œ2í˜• ì½œë¼ê²(UC-II) A to Z

[^3_20]: https://lifet.co.kr/Store/Product/Detail?productCode=P00203

[^3_21]: https://lifet.co.kr/Store/Product/Detail?productCode=P00211

[^3_22]: https://www.lifet.co.kr/Contents/Detail/í…Œì•„ë‹Œ A to Z

[^3_23]: https://lifet.co.kr/Contents/Detail/ì½”ë°œë¼ë¯¼ A to Z

[^3_24]: https://lifet.co.kr/Contents/Detail/íƒ€íˆë³´ A to Z

[^3_25]: https://lifet.co.kr/Store/Product/Detail?productCode=P00445

[^3_26]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ì‹­ìì¸ëŒ€ íŒŒì—´ì— ëŒ€í•´

[^3_27]: https://lifet.co.kr/Contents/Detail/ë¹„íƒ€ë¯¼D A to Z

[^3_28]: https://www.meshy.ai/features/image-to-3d

[^3_29]: https://www.tripo3d.ai

[^3_30]: https://docs.meshy.ai/en/api/image-to-3d

[^3_31]: https://www.alpha3d.io

[^3_32]: https://www.youtube.com/watch?v=gm0yUeS0z5Y

[^3_33]: https://biz.chosun.com/en/en-science/2025/07/24/5O5ZWNG2TRCMJKVDNYULV7OWD4/

[^3_34]: https://iconscout.com/lottie-animations/chatbot-healthcare-use

[^3_35]: https://www.immersity.ai

[^3_36]: https://www.biorxiv.org/content/10.1101/2021.12.31.474634.full

[^3_37]: https://herothemes.com/blog/healthcare-chatbots/

[^3_38]: https://www.3dlogolab.io

[^3_39]: https://ai.meta.com/research/publications/animal-avatars-reconstructing-animatable-3d-animals-from-casual-videos/

[^3_40]: https://wawasensei.dev/ja/chatbot-kit/docs/customization/avatars-and-animations

[^3_41]: https://www.3daistudio.com

[^3_42]: https://ravatar.com

[^3_43]: https://www.freepik.com/free-photos-vectors/chatbot-animation-healthcare

[^3_44]: https://www.youtube.com/watch?v=RREjPFzPUlA

[^3_45]: https://www.heygen.com/interactive-avatar

[^3_46]: https://www.shutterstock.com/search/healthcare-bot

[^3_47]: https://www.dzine.ai/tools/2d-to-3d-image-converter/


---

# ê·¼ë° ì´ë°©ì‹ìœ¼ë¡œ í•˜ë©´ ì‚¬ìš©ìì˜ ê°•ì•„ì§€ ì‚¬ì§„ì„ ë°”íƒ•ìœ¼ë¡œ ëœë”ë§í•˜ëŠ” ì‹ìœ¼ë¡œ í•  ìˆ˜ ìˆëŠ”ê±°ì•¼?

ë„¤, **ì •í™•íˆ ê·¸ë ‡ê²Œ êµ¬í˜„ ê°€ëŠ¥í•©ë‹ˆë‹¤**! ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ì„ ê¸°ë°˜ìœ¼ë¡œ 3D ëª¨ë¸ì„ ìƒì„±í•˜ê³  ë Œë”ë§í•˜ëŠ” ì „ì²´ í”Œë¡œìš°ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤.

## ì „ì²´ ì•„í‚¤í…ì²˜ í”Œë¡œìš°

```mermaid
ì‚¬ìš©ì í« ë“±ë¡ (user_service)
    â†“
í« ì‚¬ì§„ S3 ì—…ë¡œë“œ
    â†“
Meshy.ai API í˜¸ì¶œ (ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ ì „ì†¡)
    â†“ (~2ë¶„)
ì‚¬ìš©ì ê°•ì•„ì§€ ëª¨ìŠµì˜ 3D ëª¨ë¸ ìƒì„± (GLB)
    â†“
S3ì— 3D ëª¨ë¸ ì €ì¥
    â†“
Frontendì—ì„œ Three.jsë¡œ ë Œë”ë§
    â†“
ì±—ë´‡ê³¼ ëŒ€í™” ì‹œ ì‹¤ì œ ê°•ì•„ì§€ 3D ì•„ë°”íƒ€ê°€ ë°˜ì‘
```


## êµ¬í˜„ ìƒì„¸ ì„¤ëª…

### 1ë‹¨ê³„: ì‚¬ìš©ì í« ë“±ë¡ ì‹œ 3D ëª¨ë¸ ìƒì„±

**user_serviceì—ì„œ í« ë“±ë¡ API í˜¸ì¶œ ì‹œ**

```java
// user_service_backend/src/main/java/com/user/controller/PetController.java

@RestController
@RequestMapping("/api/users/{userId}/pets")
public class PetController {
    
    @Autowired
    private PetService petService;
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * í« ë“±ë¡ API
     * WHY: ì‚¬ìš©ìê°€ ê°•ì•„ì§€ ì‚¬ì§„ ì—…ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ 3D ëª¨ë¸ ìƒì„± íŠ¸ë¦¬ê±°
     */
    @PostMapping(consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public ResponseEntity<PetRegistrationResponse> registerPet(
            @PathVariable Long userId,
            @RequestPart("petImage") MultipartFile petImage,  // ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„
            @RequestPart("petInfo") PetInfoRequest petInfo) {
        
        // 1. í« ê¸°ë³¸ ì •ë³´ ì €ì¥
        Pet pet = petService.savePet(userId, petInfo);
        
        // 2. í« ì‚¬ì§„ S3 ì—…ë¡œë“œ
        String petImageUrl = s3Service.uploadFile(petImage, "pets/" + pet.getId());
        pet.setPhotoUrl(petImageUrl);
        
        // 3. healthcare_AIchatbot_serviceì— 3D ëª¨ë¸ ìƒì„± ìš”ì²­
        String healthcareServiceUrl = "http://healthcare-aichatbot-service:8085/api/healthcare/avatar/generate";
        
        Avatar3DGenerationRequest request = Avatar3DGenerationRequest.builder()
            .petId(pet.getId())
            .petImageUrl(petImageUrl)  // ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ URL ì „ë‹¬
            .userId(userId)
            .build();
        
        // ë¹„ë™ê¸° í˜¸ì¶œ (ì‘ë‹µ ëŒ€ê¸° ì•ˆ í•¨)
        // WHY: 2ë¶„ ì†Œìš”ë˜ë¯€ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬
        CompletableFuture.runAsync(() -> {
            restTemplate.postForObject(healthcareServiceUrl, request, Void.class);
        });
        
        return ResponseEntity.ok(PetRegistrationResponse.from(pet));
    }
}
```


### 2ë‹¨ê³„: Healthcare Serviceì—ì„œ Meshy.ai API í˜¸ì¶œ

**healthcare_AIchatbot_serviceì—ì„œ ì‹¤ì œ 3D ë³€í™˜ ìˆ˜í–‰**

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/Avatar3DGenerationService.java

@Service
public class Avatar3DGenerationService {
    
    @Value("${meshy.api.key}")
    private String meshyApiKey;
    
    @Value("${meshy.api.url}")
    private String meshyApiUrl; // https://api.meshy.ai/openapi/v1
    
    @Autowired
    private S3Service s3Service;
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * ì‚¬ìš©ìì˜ ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ìœ¼ë¡œ 3D ëª¨ë¸ ìƒì„±
     * WHY: Meshy.aiëŠ” ë‹¨ì¼ ì´ë¯¸ì§€ì—ì„œ ê°•ì•„ì§€ì˜ í˜•íƒœ, ìƒ‰ìƒ, íŒ¨í„´ì„ í•™ìŠµí•˜ì—¬ 3D ë³µì›
     */
    public void generate3DAvatar(Avatar3DGenerationRequest request) {
        log.info("Starting 3D avatar generation for petId: {}, imageUrl: {}", 
                 request.getPetId(), request.getPetImageUrl());
        
        // 1. Meshy.ai API í˜¸ì¶œ (ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ ì „ì†¡)
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.setBearerAuth(meshyApiKey);
        
        Map<String, Object> requestBody = new HashMap<>();
        requestBody.put("image_url", request.getPetImageUrl());  // ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ URL
        requestBody.put("enable_pbr", true);  // í…ìŠ¤ì²˜ í’ˆì§ˆ í–¥ìƒ (ê°•ì•„ì§€ í„¸ ì§ˆê° ë°˜ì˜)
        requestBody.put("ai_model", "meshy-4");  // ìµœì‹  ëª¨ë¸ ì‚¬ìš©
        requestBody.put("topology", "quad");  // ì• ë‹ˆë©”ì´ì…˜ í˜¸í™˜ì„±
        
        // WHY: Meshy.aiê°€ ê°•ì•„ì§€ ì‚¬ì§„ì„ ë¶„ì„í•˜ì—¬ 3D í˜•ìƒìœ¼ë¡œ ë³µì›
        // - ê°•ì•„ì§€ì˜ í’ˆì¢… íŠ¹ì§• (ê·€ ëª¨ì–‘, ê¼¬ë¦¬ ê¸¸ì´ ë“±) ìë™ ì¸ì‹
        // - í„¸ ìƒ‰ìƒ ë° íŒ¨í„´ (ì ë°•ì´, ì¤„ë¬´ëŠ¬ ë“±) í…ìŠ¤ì²˜ë¡œ ë³€í™˜
        // - ì–¼êµ´ íŠ¹ì§• (ëˆˆ, ì½”, ì…) ì •í™•íˆ ì¬í˜„
        
        HttpEntity<Map<String, Object>> entity = new HttpEntity<>(requestBody, headers);
        
        ResponseEntity<MeshyTaskResponse> response = restTemplate.postForEntity(
            meshyApiUrl + "/image-to-3d",
            entity,
            MeshyTaskResponse.class
        );
        
        String taskId = response.getBody().getResult();
        
        // 2. Task ì •ë³´ DB ì €ì¥ (í´ë§ ë˜ëŠ” ì›¹í›…ìœ¼ë¡œ ì™„ë£Œ ì²´í¬)
        Avatar3DTask task = Avatar3DTask.builder()
            .petId(request.getPetId())
            .userId(request.getUserId())
            .taskId(taskId)
            .status("PROCESSING")
            .createdAt(LocalDateTime.now())
            .build();
        
        avatar3DTaskRepository.save(task);
        
        // 3. ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì™„ë£Œ ëŒ€ê¸° (í´ë§ ë°©ì‹)
        CompletableFuture.runAsync(() -> pollTaskCompletion(task));
    }
    
    /**
     * Meshy.ai ì‘ì—… ì™„ë£Œ ì²´í¬ (30ì´ˆë§ˆë‹¤ í´ë§)
     */
    private void pollTaskCompletion(Avatar3DTask task) {
        while (true) {
            try {
                Thread.sleep(30000); // 30ì´ˆ ëŒ€ê¸°
                
                // ì‘ì—… ìƒíƒœ ì¡°íšŒ
                String statusUrl = meshyApiUrl + "/image-to-3d/" + task.getTaskId();
                ResponseEntity<MeshyTaskStatusResponse> statusResponse = 
                    restTemplate.getForEntity(statusUrl, MeshyTaskStatusResponse.class);
                
                String status = statusResponse.getBody().getStatus();
                
                if ("SUCCEEDED".equals(status)) {
                    // 3D ëª¨ë¸ ë‹¤ìš´ë¡œë“œ URL íšë“
                    String glbDownloadUrl = statusResponse.getBody().getModelUrls().getGlb();
                    
                    // S3ì— ì—…ë¡œë“œ (ìš°ë¦¬ ì¸í”„ë¼ë¡œ ë³µì‚¬)
                    // WHY: Meshy.ai URLì€ ì„ì‹œì´ë¯€ë¡œ ì˜êµ¬ ì €ì¥ í•„ìš”
                    byte[] glbData = downloadFile(glbDownloadUrl);
                    String s3Url = s3Service.uploadFile(
                        glbData, 
                        "pet-avatars/" + task.getPetId() + ".glb"
                    );
                    
                    // Task ìƒíƒœ ì—…ë°ì´íŠ¸
                    task.setStatus("COMPLETED");
                    task.setModel3dUrl(s3Url);
                    task.setCompletedAt(LocalDateTime.now());
                    avatar3DTaskRepository.save(task);
                    
                    // user_serviceì— 3D ëª¨ë¸ URL ì—…ë°ì´íŠ¸ ìš”ì²­
                    updatePet3DModelUrl(task.getPetId(), s3Url);
                    
                    log.info("3D avatar generation completed for petId: {}, modelUrl: {}", 
                             task.getPetId(), s3Url);
                    break;
                    
                } else if ("FAILED".equals(status)) {
                    task.setStatus("FAILED");
                    avatar3DTaskRepository.save(task);
                    log.error("3D avatar generation failed for petId: {}", task.getPetId());
                    break;
                }
                
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                break;
            }
        }
    }
    
    /**
     * user_serviceì— 3D ëª¨ë¸ URL ì—…ë°ì´íŠ¸
     */
    private void updatePet3DModelUrl(Long petId, String model3dUrl) {
        String userServiceUrl = "http://user-service:8080/api/pets/" + petId + "/3d-model";
        
        Map<String, String> updateRequest = new HashMap<>();
        updateRequest.put("model3dUrl", model3dUrl);
        
        restTemplate.put(userServiceUrl, updateRequest);
    }
}
```


### 3ë‹¨ê³„: Frontendì—ì„œ ì‹¤ì œ ê°•ì•„ì§€ 3D ëª¨ë¸ ë Œë”ë§

**Frontend/src/components/HealthcareChat/PetAvatar3D.jsx**

```jsx
import React, { useEffect, useState, useRef } from 'react';
import { Canvas, useFrame } from '@react-three-fiber';
import { useGLTF, PerspectiveCamera, Environment } from '@react-three-drei';
import * as THREE from 'three';

/**
 * ì‚¬ìš©ìì˜ ì‹¤ì œ ê°•ì•„ì§€ë¥¼ 3Dë¡œ ë Œë”ë§í•˜ëŠ” ì»´í¬ë„ŒíŠ¸
 * WHY: Meshy.aië¡œ ìƒì„±ëœ GLB íŒŒì¼ì€ ê°•ì•„ì§€ì˜ ì™¸í˜•ì„ ì •í™•íˆ ì¬í˜„
 */
function PetModel({ modelUrl, animationState }) {
  const { scene, animations } = useGLTF(modelUrl); // ì‚¬ìš©ì ê°•ì•„ì§€ 3D ëª¨ë¸ ë¡œë“œ
  const mixer = useRef();
  
  useEffect(() => {
    if (animations.length > 0) {
      mixer.current = new THREE.AnimationMixer(scene);
      
      // ê¸°ë³¸ idle ì• ë‹ˆë©”ì´ì…˜ (í˜¸í¡, ê¼¬ë¦¬ ì‚´ì§ í”ë“¤ê¸°)
      const idleClip = animations.find(clip => clip.name === 'idle') || animations[^4_0];
      const idleAction = mixer.current.clipAction(idleClip);
      idleAction.play();
    }
    
    // WHY: ì‹¤ì œ ê°•ì•„ì§€ì˜ í„¸ ìƒ‰ìƒê³¼ íŒ¨í„´ì´ í…ìŠ¤ì²˜ì— ë°˜ì˜ë˜ì–´ ìˆìŒ
    // ì˜ˆ: ì§„ë—ê°œ â†’ í°ìƒ‰/í™©ê°ˆìƒ‰ í„¸, ì‹œë°”ê²¬ â†’ ì ê°ˆìƒ‰ í„¸ ìë™ ì ìš©
    scene.traverse((child) => {
      if (child.isMesh) {
        child.castShadow = true;
        child.receiveShadow = true;
      }
    });
  }, [scene, animations]);
  
  useFrame((state, delta) => {
    if (mixer.current) mixer.current.update(delta);
    
    // ì±—ë´‡ ì‘ë‹µì— ë”°ë¼ ë¯¸ì„¸ ì• ë‹ˆë©”ì´ì…˜
    if (animationState === 'happy') {
      // ê¼¬ë¦¬ í”ë“¤ê¸° ê°•ë„ ì¦ê°€
      scene.rotation.y += Math.sin(state.clock.elapsedTime * 10) * 0.01;
    } else if (animationState === 'listening') {
      // ê³ ê°œ ì•½ê°„ ê¸°ìš¸ì´ê¸°
      scene.rotation.z = Math.sin(state.clock.elapsedTime * 2) * 0.05;
    }
  });
  
  return <primitive object={scene} scale={2} />;
}

export function PetAvatar3D({ userId, animationState }) {
  const [modelUrl, setModelUrl] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    // healthcare_AIchatbot_serviceì—ì„œ ì‚¬ìš©ìì˜ í« 3D ëª¨ë¸ URL ê°€ì ¸ì˜¤ê¸°
    fetch(`/api/healthcare/avatar/${userId}`)
      .then(res => res.json())
      .then(data => {
        setModelUrl(data.model3dUrl); // S3 URL (ì‚¬ìš©ì ê°•ì•„ì§€ GLB íŒŒì¼)
        setLoading(false);
      })
      .catch(err => {
        console.error('Failed to load pet 3D model:', err);
        setLoading(false);
      });
  }, [userId]);
  
  if (loading) {
    return (
      <div className="pet-avatar-loading">
        <p>ğŸ¶ ë‹¹ì‹ ì˜ ê°•ì•„ì§€ë¥¼ 3Dë¡œ ì¤€ë¹„í•˜ëŠ” ì¤‘...</p>
      </div>
    );
  }
  
  if (!modelUrl) {
    return (
      <div className="pet-avatar-error">
        <p>ê°•ì•„ì§€ ì‚¬ì§„ì„ ë“±ë¡í•˜ë©´ 3D í˜ë¥´ì†Œë‚˜ì™€ ëŒ€í™”í•  ìˆ˜ ìˆì–´ìš”!</p>
      </div>
    );
  }
  
  return (
    <div className="pet-avatar-container" style={{ width: '400px', height: '400px' }}>
      <Canvas shadows>
        <PerspectiveCamera makeDefault position={[0, 1, 3]} />
        
        {/* ì¡°ëª… ì„¤ì • (ê°•ì•„ì§€ í„¸ ì§ˆê° ê°•ì¡°) */}
        <ambientLight intensity={0.5} />
        <directionalLight 
          position={[10, 10, 5]} 
          intensity={1}
          castShadow
        />
        
        {/* í™˜ê²½ ë§µ (ì‹¤ë‚´ ëŠë‚Œ) */}
        <Environment preset="apartment" />
        
        {/* ì‹¤ì œ ì‚¬ìš©ì ê°•ì•„ì§€ 3D ëª¨ë¸ ë Œë”ë§ */}
        <PetModel modelUrl={modelUrl} animationState={animationState} />
        
        {/* ë°”ë‹¥ í‰ë©´ (ê·¸ë¦¼ììš©) */}
        <mesh rotation={[-Math.PI / 2, 0, 0]} position={[0, -1, 0]} receiveShadow>
          <planeGeometry args={[10, 10]} />
          <shadowMaterial opacity={0.3} />
        </mesh>
      </Canvas>
    </div>
  );
}
```


### 4ë‹¨ê³„: ì±—ë´‡ ëŒ€í™” í™”ë©´ í†µí•©

**Frontend/src/pages/HealthcareChat.jsx**

```jsx
import React, { useState } from 'react';
import { PetAvatar3D } from '../components/HealthcareChat/PetAvatar3D';
import { ChatInterface } from '../components/HealthcareChat/ChatInterface';

export function HealthcareChat() {
  const userId = getUserIdFromAuth(); // ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ID
  const [animationState, setAnimationState] = useState('idle');
  const [messages, setMessages] = useState([]);
  
  const handleSendMessage = async (userMessage) => {
    // ì‚¬ìš©ì ë©”ì‹œì§€ ì¶”ê°€
    setMessages(prev => [...prev, { role: 'user', content: userMessage }]);
    
    // ê°•ì•„ì§€ ì• ë‹ˆë©”ì´ì…˜: ë“£ê³  ìˆëŠ” ìƒíƒœ
    setAnimationState('listening');
    
    // healthcare_AIchatbot_service API í˜¸ì¶œ
    const response = await fetch('/api/healthcare/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId,
        message: userMessage
      })
    });
    
    const data = await response.json();
    
    // AI ì‘ë‹µ ì¶”ê°€
    setMessages(prev => [...prev, { 
      role: 'assistant', 
      content: data.message 
    }]);
    
    // ê°•ì•„ì§€ ì• ë‹ˆë©”ì´ì…˜: ì‘ë‹µì— ë”°ë¼ ë°˜ì‘
    // WHY: AIê°€ ê¸ì •ì  ë©”ì‹œì§€ë©´ ê¸°ë»í•˜ëŠ” ëª¨ìŠµ, ì§ˆë¬¸ì´ë©´ ê³ ê°œ ë„ë•ì´ê¸°
    setAnimationState(data.animationHint || 'idle');
    
    // 3ì´ˆ í›„ idle ìƒíƒœë¡œ ë³µê·€
    setTimeout(() => setAnimationState('idle'), 3000);
  };
  
  return (
    <div className="healthcare-chat-page">
      <div className="chat-layout">
        {/* ì™¼ìª½: ì‹¤ì œ ì‚¬ìš©ì ê°•ì•„ì§€ 3D ì•„ë°”íƒ€ */}
        <div className="avatar-section">
          <PetAvatar3D 
            userId={userId} 
            animationState={animationState}
          />
          <p className="avatar-name">ìš°ë¦¬ ë©ë©ì´ì™€ ëŒ€í™” ì¤‘...</p>
        </div>
        
        {/* ì˜¤ë¥¸ìª½: ì±„íŒ… ì¸í„°í˜ì´ìŠ¤ */}
        <div className="chat-section">
          <ChatInterface 
            messages={messages}
            onSendMessage={handleSendMessage}
          />
        </div>
      </div>
    </div>
  );
}
```


## ì‹¤ì œ ë™ì‘ ì˜ˆì‹œ

### ì‹œë‚˜ë¦¬ì˜¤: ì‚¬ìš©ì "ì² ìˆ˜"ê°€ ì‹œë°”ê²¬ "ë½€ì‚" ë“±ë¡

1. **í« ë“±ë¡ í™”ë©´**

```
[ì‚¬ì§„ ì—…ë¡œë“œ] â†’ ì‹¤ì œ ë½€ì‚ ì‚¬ì§„ (ê°ˆìƒ‰ í„¸, ê·€ê°€ ì«‘ê¸‹)
ì´ë¦„: ë½€ì‚
ë‚˜ì´: 3ì‚´
í’ˆì¢…: ì‹œë°”ê²¬
```

2. **Meshy.ai ì²˜ë¦¬** (ë°±ê·¸ë¼ìš´ë“œ ~2ë¶„)

```
ì…ë ¥: ë½€ì‚ ì‚¬ì§„ (2D)
ì¶œë ¥: ë½€ì‚ì˜ 3D ëª¨ë¸ (GLB)
â†’ ê°ˆìƒ‰ í„¸ í…ìŠ¤ì²˜ ìë™ ì ìš©
â†’ ì‹œë°”ê²¬ íŠ¹ìœ ì˜ ê·€/ê¼¬ë¦¬ í˜•íƒœ ì¬í˜„
â†’ ë½€ì‚ì˜ ì–¼êµ´ íŠ¹ì§• ë°˜ì˜
```

3. **ì±—ë´‡ ëŒ€í™” í™”ë©´**

```
[í™”ë©´ ì™¼ìª½]
â†’ ì‹¤ì œ ë½€ì‚ì™€ ë˜‘ê°™ì´ ìƒê¸´ 3D ëª¨ë¸ì´ íšŒì „í•˜ë©° í‘œì‹œ
â†’ ì‚¬ìš©ìê°€ "ë½€ì‚ ìš”ì¦˜ ì‚°ì±… ì‹«ì–´í•˜ëŠ”ë° ì´ìœ ê°€ ë­˜ê¹Œ?" ì…ë ¥

[í™”ë©´ ì˜¤ë¥¸ìª½]
â†’ AI: "ê´€ì ˆ í†µì¦ì´ë‚˜ ë‚ ì”¨ ë³€í™”ê°€ ì›ì¸ì¼ ìˆ˜ ìˆì–´ìš”..."
â†’ ë½€ì‚ 3D ëª¨ë¸ì´ ê³ ê°œë¥¼ ë„ë•ì´ë©° ë°˜ì‘
```


## í•µì‹¬ í¬ì¸íŠ¸ ì •ë¦¬

### âœ… ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ ê¸°ë°˜ 3D ìƒì„±

| ì…ë ¥ | ì²˜ë¦¬ | ì¶œë ¥ |
| :-- | :-- | :-- |
| ì‚¬ìš©ìê°€ ì—…ë¡œë“œí•œ í« ì‚¬ì§„ (JPEG/PNG) | Meshy.ai Image-to-3D AI | í•´ë‹¹ ê°•ì•„ì§€ì˜ 3D ëª¨ë¸ (GLB) |
| ì˜ˆ: í°ìƒ‰ ë§í‹°ì¦ˆ | AIê°€ í„¸ ìƒ‰ìƒ, í’ˆì¢… íŠ¹ì§• í•™ìŠµ | í°ìƒ‰ ë§í‹°ì¦ˆ 3D ëª¨ë¸ |
| ì˜ˆ: ì ë°•ì´ ë‹¬ë§ˆì‹œì•ˆ | AIê°€ ì ë¬´ëŠ¬ íŒ¨í„´ ì¸ì‹ | ì ë°•ì´ í…ìŠ¤ì²˜ ì ìš©ëœ 3D ëª¨ë¸ |

### ğŸ¯ ì™œ ì´ ë°©ì‹ì´ ì í•©í•œê°€?

1. **ê°œì¸í™”**: ê° ì‚¬ìš©ìì˜ ì‹¤ì œ ê°•ì•„ì§€ ì™¸í˜• ì¬í˜„
2. **íš¨ìœ¨ì„±**: API í˜¸ì¶œë§Œìœ¼ë¡œ ì „ë¬¸ 3D ëª¨ë¸ëŸ¬ ì‘ì—… ëŒ€ì²´
3. **ë¹„ìš©**: ë¬´ë£Œ í”Œëœìœ¼ë¡œ 10íšŒ ì‹œì—° ì¶©ë¶„ (\$0)
4. **ê¸°ìˆ  ìŠ¤íƒ í†µí•©**: ê¸°ì¡´ S3, REST API ì¸í”„ë¼ í™œìš©
5. **ì‹œì—° íš¨ê³¼**: íˆ¬ìì/ì‹¬ì‚¬ìœ„ì›ì—ê²Œ "ìš°ë¦¬ ê°•ì•„ì§€ì™€ ëŒ€í™”" ì„íŒ©íŠ¸

### ğŸ“‹ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

```bash
# 1. healthcare_AIchatbot_serviceì— Avatar3D ë„ë©”ì¸ ì¶”ê°€
mkdir -p src/main/java/com/healthcareai/domain/avatar3d
mkdir -p src/main/java/com/healthcareai/service/avatar3d
mkdir -p src/main/java/com/healthcareai/controller/avatar3d

# 2. Meshy.ai API Key ë°œê¸‰
# https://www.meshy.ai íšŒì›ê°€ì… â†’ API Keys ë©”ë‰´

# 3. application-dev.yml ì„¤ì •
meshy:
  api:
    key: ${MESHY_API_KEY}
    url: https://api.meshy.ai/openapi/v1

# 4. user_serviceì™€ í†µì‹  ì¸í„°í˜ì´ìŠ¤ ì •ì˜
# FeignClient ë˜ëŠ” RestTemplate ì„¤ì •
```

ì´ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•˜ë©´ **ì‚¬ìš©ìê°€ ë“±ë¡í•œ ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ì´ 3Dë¡œ ì‚´ì•„ë‚˜ì„œ** ì±—ë´‡ê³¼ ëŒ€í™”í•˜ëŠ” ë“¯í•œ ê²½í—˜ì„ ì œê³µí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ê¶ê¸ˆí•œ ì  ë” ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì„¸ìš”!
<span style="display:none">[^4_1][^4_2][^4_3][^4_4][^4_5][^4_6][^4_7]</span>

<div align="center">â‚</div>

[^4_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^4_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^4_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^4_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^4_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^4_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^4_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md


---

# í˜¹ì‹œ [https://www.meshy.ai/api](https://www.meshy.ai/api) ì—¬ê¸°ì´ê±°ëŠ” ìœ ë£Œì•„ë‹ˆì•¼? ì¼ì •ë¹„ìš©ì„ ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜?

Meshy.ai API ê°€ê²© ì •ì±…ì„ í™•ì¸í•œ ê²°ê³¼, **ì™„ì „ ë¬´ë£ŒëŠ” ì•„ë‹ˆì§€ë§Œ** ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì´ ìˆìŠµë‹ˆë‹¤:

## Meshy.ai API ë¹„ìš© êµ¬ì¡°

### í”Œëœë³„ ë¹„êµ

| í”Œëœ | API ì ‘ê·¼ | í¬ë ˆë”§ | ë¹„ìš© |
| :-- | :-- | :-- | :-- |
| **Free** | âŒ API ì‚¬ìš© ë¶ˆê°€ | - | \$0 |
| **Pro** | âœ… API ì‚¬ìš© ê°€ëŠ¥ | ì›” 200 í¬ë ˆë”§ í¬í•¨ | \$20/ì›” |
| **Studio** | âœ… API ì‚¬ìš© ê°€ëŠ¥ | ì›” 2,000 í¬ë ˆë”§ í¬í•¨ | \$150/ì›” |
| **Enterprise** | âœ… ìµœìš°ì„  ì²˜ë¦¬ | ì»¤ìŠ¤í…€ | í˜‘ì˜ |

### Image to 3D ë¹„ìš© (ìš°ë¦¬ê°€ ì‚¬ìš©í•  ê¸°ëŠ¥)

```yaml
# Image to 3D í•œ ë²ˆ í˜¸ì¶œ ì‹œ í¬ë ˆë”§ ì†Œë¹„
Meshy 6 ëª¨ë¸ (ìµœì‹ ):
  - í…ìŠ¤ì²˜ ì—†ì´: 20 í¬ë ˆë”§
  - í…ìŠ¤ì²˜ í¬í•¨: 30 í¬ë ˆë”§ âœ… (ìš°ë¦¬ê°€ ì‚¬ìš©í•  ì˜µì…˜)

êµ¬í˜• ëª¨ë¸:
  - í…ìŠ¤ì²˜ ì—†ì´: 5 í¬ë ˆë”§
  - í…ìŠ¤ì²˜ í¬í•¨: 15 í¬ë ˆë”§
```


### 10íšŒ ì‹œì—° ì‹œ ì˜ˆìƒ ë¹„ìš©

```
ì‹œì—° íšŸìˆ˜: 10íšŒ
í¬ë ˆë”§ ì†Œë¹„: 30 í¬ë ˆë”§ Ã— 10íšŒ = 300 í¬ë ˆë”§

Pro í”Œëœ (ì›” $20):
  - í¬í•¨ í¬ë ˆë”§: 200 í¬ë ˆë”§
  - ì¶”ê°€ êµ¬ë§¤ í•„ìš”: 100 í¬ë ˆë”§
  - ì´ ë¹„ìš©: $20 + ì¶”ê°€ í¬ë ˆë”§ êµ¬ë§¤ë¹„

Studio í”Œëœ (ì›” $150):
  - í¬í•¨ í¬ë ˆë”§: 2,000 í¬ë ˆë”§
  - ì¶”ê°€ êµ¬ë§¤ ë¶ˆí•„ìš”
  - ì´ ë¹„ìš©: $150 (ê³¼ë„í•¨)
```


## ğŸš¨ ë¬¸ì œ: ì™„ì „ ë¬´ë£Œ ì˜µì…˜ ì—†ìŒ

Meshy.aiëŠ” **API ì ‘ê·¼ ìì²´ê°€ Pro í”Œëœ ì´ìƒì—ì„œë§Œ ê°€ëŠ¥**í•©ë‹ˆë‹¤. í•˜ì§€ë§Œ ëŒ€ì•ˆì´ ìˆìŠµë‹ˆë‹¤!

***

## âœ… ì¶”ì²œ ëŒ€ì•ˆ: ì™„ì „ ë¬´ë£Œ ì†”ë£¨ì…˜

### ì˜µì…˜ 1: **Hugging Face TRELLIS (ë¬´ë£Œ)**

TRELLIS ì›ë³¸ì€ Hugging Face Spacesì—ì„œ **ë¬´ë£Œë¡œ ì›¹ API ì œê³µ**í•©ë‹ˆë‹¤.

```python
# healthcare_AIchatbot_serviceì—ì„œ Hugging Face API í˜¸ì¶œ

import requests

def generate_3d_from_image_free(pet_image_url):
    """
    Hugging Face Spaces API í™œìš© (ì™„ì „ ë¬´ë£Œ)
    WHY: TRELLIS Demo SpaceëŠ” ë¬´ë£Œ GPU í• ë‹¹ë°›ì•„ ëˆ„êµ¬ë‚˜ ì‚¬ìš© ê°€ëŠ¥
    """
    api_url = "https://microsoft-trellis.hf.space/api/predict"
    
    response = requests.post(api_url, json={
        "data": [pet_image_url]  # ê°•ì•„ì§€ ì‚¬ì§„ URL
    })
    
    result = response.json()
    glb_url = result["data"][^5_0]  # ìƒì„±ëœ 3D ëª¨ë¸ ë‹¤ìš´ë¡œë“œ URL
    
    return glb_url
```

**ì¥ì **:

- âœ… ì™„ì „ ë¬´ë£Œ (Hugging Face ì œê³µ)
- âœ… 10íšŒ ì´ìƒ ë¬´ì œí•œ ì‚¬ìš© ê°€ëŠ¥
- âœ… ê³ í’ˆì§ˆ (TRELLIS.2 4B ëª¨ë¸)

**ë‹¨ì **:

- â±ï¸ ëŒ€ê¸° ì‹œê°„ ê°€ëŠ¥ (ë‹¤ë¥¸ ì‚¬ìš©ìì™€ GPU ê³µìœ )
- ğŸŒ ì•½ê°„ ëŠë¦¼ (Meshy ëŒ€ë¹„ 2-3ë°°)


### ì˜µì…˜ 2: **Tripo3D.ai (ë¬´ë£Œ í¬ë ˆë”§ ì œê³µ)**

<span style="display:none">[^5_1][^5_2][^5_3][^5_4][^5_5][^5_6][^5_7]</span>

<div align="center">â‚</div>

[^5_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^5_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^5_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^5_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^5_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^5_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^5_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md


---

# Tripo3D.aië¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜?

ë„¤, **Tripo3D.ai ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤!** ê·¸ë¦¬ê³  Meshyë³´ë‹¤ ë” ì¢‹ì€ ì¡°ê±´ì„ ì œê³µí•©ë‹ˆë‹¤.

## Tripo3D.ai ê°€ê²© ì •ì±… (2026ë…„ 1ì›” ê¸°ì¤€)

### ë¬´ë£Œ í”Œëœ (Basic)

| í•­ëª© | ë‚´ìš© |
| :-- | :-- |
| **ì›” ë¬´ë£Œ í¬ë ˆë”§** | **300 í¬ë ˆë”§** |
| **API ì ‘ê·¼** | âœ… ê°€ëŠ¥ |
| **ë™ì‹œ ì‘ì—…** | 1ê°œ |
| **ëª¨ë¸ ì €ì¥** | 1ì¼ |
| **ë¼ì´ì„ ìŠ¤** | CC BY 4.0 (ê³µê°œ) |

### Image to 3D ë¹„ìš©

```yaml
# Tripo3D Image to 3D í¬ë ˆë”§ ì†Œë¹„
ì¼ë°˜ í’ˆì§ˆ:
  - í…ìŠ¤ì²˜ ì—†ì´: 5 í¬ë ˆë”§
  - í…ìŠ¤ì²˜ í¬í•¨: 15 í¬ë ˆë”§ âœ… (ì¶”ì²œ)

ê³ í•´ìƒë„ (HD):
  - í…ìŠ¤ì²˜ í¬í•¨: 20-30 í¬ë ˆë”§
```


### 10íšŒ ì‹œì—° ê³„ì‚°

```
ì‹œì—° íšŸìˆ˜: 10íšŒ
í¬ë ˆë”§ ì†Œë¹„: 15 í¬ë ˆë”§ Ã— 10íšŒ = 150 í¬ë ˆë”§

ë¬´ë£Œ í”Œëœ (ì›” 300 í¬ë ˆë”§):
  âœ… ì¶”ê°€ ë¹„ìš© ì—†ì´ 10íšŒ ì‹œì—° ê°€ëŠ¥!
  âœ… ì—¬ìœ ë¶„ 150 í¬ë ˆë”§ ë‚¨ìŒ (í…ŒìŠ¤íŠ¸/ì¬ìƒì„±ìš©)
```


## ğŸ‰ Tripo3Dê°€ Meshyë³´ë‹¤ ë‚˜ì€ ì´ìœ 

| ë¹„êµ í•­ëª© | Tripo3D | Meshy.ai |
| :-- | :-- | :-- |
| **ë¬´ë£Œ API ì ‘ê·¼** | âœ… ì›” 300 í¬ë ˆë”§ | âŒ Pro í•„ìˆ˜ (\$20) |
| **10íšŒ ì‹œì—° ë¹„ìš©** | **\$0** | \$20+ |
| **1íšŒ ìƒì„± ë¹„ìš©** | 15 í¬ë ˆë”§ | 30 í¬ë ˆë”§ |
| **ìƒì„± ì†ë„** | ~20ì´ˆ | ~2ë¶„ |
| **í•œêµ­ì–´ ì§€ì›** | âœ… | âŒ |
| **API ë¬¸ì„œ** | ëª…í™•í•¨ | ëª…í™•í•¨ |


***

## âœ… ìµœì¢… ì¶”ì²œ: Tripo3D.ai ì‚¬ìš©

### êµ¬í˜„ ê³„íš

#### 1. Tripo3D API ì—°ë™ (healthcare_AIchatbot_service)

**application-dev.yml ì„¤ì •**

```yaml
# healthcare_AIchatbot_service/src/main/resources/application-dev.yml

tripo:
  api:
    key: ${TRIPO_API_KEY}  # í™˜ê²½ ë³€ìˆ˜ë¡œ ê´€ë¦¬
    url: https://api.tripo3d.ai/v2/openapi
    webhook-url: ${TRIPO_WEBHOOK_URL:}
```

**Avatar3DGenerationService.java (ìˆ˜ì •)**

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/Avatar3DGenerationService.java

@Service
@Slf4j
public class Avatar3DGenerationService {
    
    @Value("${tripo.api.key}")
    private String tripoApiKey;
    
    @Value("${tripo.api.url}")
    private String tripoApiUrl;
    
    @Autowired
    private S3Service s3Service;
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * Tripo3D APIë¡œ ì‚¬ìš©ì ê°•ì•„ì§€ ì‚¬ì§„ â†’ 3D ëª¨ë¸ ìƒì„±
     * WHY: ë¬´ë£Œ í”Œëœìœ¼ë¡œ 10íšŒ ì´ìƒ ì‹œì—° ê°€ëŠ¥, ë¹ ë¥¸ ì†ë„ (~20ì´ˆ)
     */
    public String generate3DAvatar(String petImageUrl, Long petId, Long userId) {
        log.info("Starting 3D avatar generation with Tripo3D for petId: {}", petId);
        
        HttpHeaders headers = new HttpHeaders();
        headers.setContentType(MediaType.APPLICATION_JSON);
        headers.setBearerAuth(tripoApiKey);
        
        // Tripo3D Image to 3D API ìš”ì²­
        Map<String, Object> requestBody = new HashMap<>();
        requestBody.put("type", "image_to_model");  // ì´ë¯¸ì§€ â†’ 3D ë³€í™˜
        requestBody.put("file", Map.of(
            "type", "url",
            "file_url", petImageUrl  // ì‚¬ìš©ì ê°•ì•„ì§€ ì‚¬ì§„ URL
        ));
        
        // WHY: Tripo3DëŠ” ê°•ì•„ì§€ í’ˆì¢…, í„¸ íŒ¨í„´, ìƒ‰ìƒ ìë™ ì¸ì‹
        Map<String, Object> options = new HashMap<>();
        options.put("texture", true);          // í…ìŠ¤ì²˜ ìƒì„± (ê°•ì•„ì§€ í„¸ ì§ˆê°)
        options.put("quad", true);             // Quad í† í´ë¡œì§€ (ì• ë‹ˆë©”ì´ì…˜ìš©)
        options.put("face_limit", 50000);      // í´ë¦¬ê³¤ ìˆ˜ (ì›¹ ë Œë”ë§ ìµœì í™”)
        options.put("texture_resolution", 2048); // 2K í…ìŠ¤ì²˜ í•´ìƒë„
        requestBody.put("options", options);
        
        HttpEntity<Map<String, Object>> entity = new HttpEntity<>(requestBody, headers);
        
        // API í˜¸ì¶œ
        ResponseEntity<TripoTaskResponse> response = restTemplate.postForEntity(
            tripoApiUrl + "/task",
            entity,
            TripoTaskResponse.class
        );
        
        String taskId = response.getBody().getData().getTaskId();
        
        // Task ì •ë³´ DB ì €ì¥
        Avatar3DTask task = Avatar3DTask.builder()
            .petId(petId)
            .userId(userId)
            .taskId(taskId)
            .status("PROCESSING")
            .provider("TRIPO3D")  // ì¶”í›„ ë‹¤ë¥¸ ì œê³µì ì¶”ê°€ ëŒ€ë¹„
            .createdAt(LocalDateTime.now())
            .build();
        
        avatar3DTaskRepository.save(task);
        
        // ë¹„ë™ê¸° ì™„ë£Œ ëŒ€ê¸°
        CompletableFuture.runAsync(() -> pollTripoTaskCompletion(task));
        
        return taskId;
    }
    
    /**
     * Tripo3D ì‘ì—… ì™„ë£Œ í´ë§ (10ì´ˆë§ˆë‹¤ ì²´í¬)
     * WHY: í‰ê·  20ì´ˆ ì†Œìš”, ìµœëŒ€ 1ë¶„ ì´ë‚´ ì™„ë£Œ
     */
    private void pollTripoTaskCompletion(Avatar3DTask task) {
        int maxAttempts = 12;  // 2ë¶„ ìµœëŒ€ ëŒ€ê¸°
        int attempt = 0;
        
        while (attempt < maxAttempts) {
            try {
                Thread.sleep(10000);  // 10ì´ˆ ëŒ€ê¸°
                
                // ì‘ì—… ìƒíƒœ ì¡°íšŒ
                String statusUrl = tripoApiUrl + "/task/" + task.getTaskId();
                
                HttpHeaders headers = new HttpHeaders();
                headers.setBearerAuth(tripoApiKey);
                HttpEntity<?> entity = new HttpEntity<>(headers);
                
                ResponseEntity<TripoTaskStatusResponse> statusResponse = 
                    restTemplate.exchange(statusUrl, HttpMethod.GET, entity, TripoTaskStatusResponse.class);
                
                String status = statusResponse.getBody().getData().getStatus();
                
                if ("success".equals(status)) {
                    // 3D ëª¨ë¸ ë‹¤ìš´ë¡œë“œ URL íšë“
                    TripoTaskData data = statusResponse.getBody().getData();
                    String glbUrl = data.getResult().getRenderedImage();  // GLB ë‹¤ìš´ë¡œë“œ URL
                    
                    // S3ì— ì—…ë¡œë“œ (ì˜êµ¬ ì €ì¥)
                    byte[] glbData = downloadFile(glbUrl);
                    String s3Key = "pet-avatars/" + task.getPetId() + "_" + System.currentTimeMillis() + ".glb";
                    String s3Url = s3Service.uploadFile(glbData, s3Key);
                    
                    // Task ì™„ë£Œ ì²˜ë¦¬
                    task.setStatus("COMPLETED");
                    task.setModel3dUrl(s3Url);
                    task.setCompletedAt(LocalDateTime.now());
                    avatar3DTaskRepository.save(task);
                    
                    // user_serviceì— 3D ëª¨ë¸ URL ì—…ë°ì´íŠ¸
                    updatePetModel3DUrl(task.getPetId(), s3Url);
                    
                    log.info("âœ… 3D avatar generation completed! PetId: {}, URL: {}", 
                             task.getPetId(), s3Url);
                    break;
                    
                } else if ("failed".equals(status)) {
                    task.setStatus("FAILED");
                    task.setErrorMessage(statusResponse.getBody().getData().getMessage());
                    avatar3DTaskRepository.save(task);
                    log.error("âŒ 3D avatar generation failed for petId: {}", task.getPetId());
                    break;
                }
                
                attempt++;
                
            } catch (InterruptedException e) {
                Thread.currentThread().interrupt();
                break;
            } catch (Exception e) {
                log.error("Error polling Tripo3D task: {}", e.getMessage());
                attempt++;
            }
        }
        
        if (attempt >= maxAttempts) {
            task.setStatus("TIMEOUT");
            avatar3DTaskRepository.save(task);
            log.error("â±ï¸ 3D avatar generation timeout for petId: {}", task.getPetId());
        }
    }
    
    // íŒŒì¼ ë‹¤ìš´ë¡œë“œ í—¬í¼
    private byte[] downloadFile(String url) {
        return restTemplate.getForObject(url, byte[].class);
    }
    
    // user_service ì—…ë°ì´íŠ¸
    private void updatePetModel3DUrl(Long petId, String model3dUrl) {
        String userServiceUrl = "http://user-service:8080/api/pets/" + petId + "/3d-model";
        restTemplate.put(userServiceUrl, Map.of("model3dUrl", model3dUrl));
    }
}
```


#### 2. DTO í´ë˜ìŠ¤ ì¶”ê°€

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/dto/TripoTaskResponse.java

@Data
@NoArgsConstructor
@AllArgsConstructor
public class TripoTaskResponse {
    private Integer code;  // 0 = ì„±ê³µ
    private TripoTaskData data;
    
    @Data
    public static class TripoTaskData {
        private String taskId;
        private String status;  // "processing", "success", "failed"
        private String message;
        private TripoResult result;
    }
    
    @Data
    public static class TripoResult {
        private String renderedImage;  // GLB íŒŒì¼ ë‹¤ìš´ë¡œë“œ URL
        private String pbr_model;      // PBR í…ìŠ¤ì²˜ í¬í•¨ ëª¨ë¸
        private Integer faces;         // í´ë¦¬ê³¤ ìˆ˜
    }
}
```


#### 3. API Key ë°œê¸‰ ë°©ë²•

```bash
# 1. Tripo3D íšŒì›ê°€ì… (ë¬´ë£Œ)
https://platform.tripo3d.ai/signup

# 2. API Key ë°œê¸‰
https://platform.tripo3d.ai/dashboard/api-keys
â†’ "Create API Key" í´ë¦­
â†’ í‚¤ ë³µì‚¬

# 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
# healthcare_AIchatbot_service/.env
TRIPO_API_KEY=tripo_xxxxxxxxxxxxxxxxx
```


#### 4. ë°°í¬ ë‹´ë‹¹ì ì „ë‹¬ì‚¬í•­

```yaml
# manifest_repo/healthcare-service/deployment.yaml ìˆ˜ì • ìš”ì²­

apiVersion: apps/v1
kind: Deployment
metadata:
  name: healthcare-aichatbot-service
spec:
  template:
    spec:
      containers:
      - name: healthcare-service
        env:
        # Tripo3D API í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€
        - name: TRIPO_API_KEY
          valueFrom:
            secretKeyRef:
              name: healthcare-secrets
              key: tripo-api-key
        # ê¸°ì¡´ í™˜ê²½ ë³€ìˆ˜ë“¤...
        - name: SPRING_PROFILES_ACTIVE
          value: "dev"
```


### 5. í”„ë¡ íŠ¸ì—”ë“œ ì½”ë“œ (ë³€ê²½ ì—†ìŒ)

**ì´ì „ì— ì‘ì„±í•œ Three.js ì½”ë“œ ê·¸ëŒ€ë¡œ ì‚¬ìš© ê°€ëŠ¥**

- Tripo3Dë„ GLB í¬ë§· ì¶œë ¥
- S3 URLë§Œ ë³€ê²½ë˜ë¯€ë¡œ Frontend ìˆ˜ì • ë¶ˆí•„ìš”

***

## Git ì‘ì—… í”Œë¡œìš°

```bash
# 1. Feature ë¸Œëœì¹˜ ìƒì„±
git checkout -b feat/tripo3d-avatar-integration

# 2. GitHub ì´ìŠˆ ìƒì„±
# ì œëª©: Feat#XX: Tripo3D API ì—°ë™ì„ í†µí•œ í« 3D ì•„ë°”íƒ€ ìƒì„±
# ë³¸ë¬¸:
## ëª©í‘œ
ì‚¬ìš©ìê°€ ë“±ë¡í•œ ê°•ì•„ì§€ ì‚¬ì§„ì„ Tripo3D APIë¡œ 3D ëª¨ë¸ ë³€í™˜

## ì‘ì—… ë‚´ìš©
- [ ] Tripo3D API í´ë¼ì´ì–¸íŠ¸ êµ¬í˜„
- [ ] ë¹„ë™ê¸° ì‘ì—… ì²˜ë¦¬ ë¡œì§
- [ ] S3 ì—…ë¡œë“œ ë° user_service ì—°ë™
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ë° ë¡œê¹…

## ì˜ˆìƒ ë¹„ìš©
ë¬´ë£Œ í”Œëœ (ì›” 300 í¬ë ˆë”§) - $0

# 3. ì»¤ë°‹
git add .
git commit -m "[Feat] : Tripo3D API ì—°ë™ ë° 3D ì•„ë°”íƒ€ ìƒì„± ì„œë¹„ìŠ¤ êµ¬í˜„

- Tripo3D Image-to-Model API í´ë¼ì´ì–¸íŠ¸ ì¶”ê°€
- Avatar3DGenerationService ë¹„ë™ê¸° í´ë§ ë¡œì§
- S3 ì—…ë¡œë“œ ë° user_service ì—°ë™
- í‰ê·  20ì´ˆ ìƒì„± ì‹œê°„, ë¬´ë£Œ í”Œëœ í™œìš©

Issue: #XX"

# 4. PR ìƒì„±
[Feat] Healthcare Service Tripo3D ê¸°ë°˜ í« 3D ì•„ë°”íƒ€ ìƒì„±

## ê´€ë ¨ ì´ìŠˆ
Closes #XX

## ì‘ì—… ë‚´ìš©
- Tripo3D API ë¬´ë£Œ í”Œëœìœ¼ë¡œ Image to 3D ë³€í™˜
- ì›” 300 í¬ë ˆë”§ìœ¼ë¡œ 10íšŒ ì´ìƒ ì‹œì—° ê°€ëŠ¥
- í‰ê·  20ì´ˆ ìƒì„± ì†ë„ (Meshy ëŒ€ë¹„ 6ë°° ë¹ ë¦„)

## ê¸°ìˆ  ì„ íƒ ì´ìœ  (WHY)
- âœ… ë¬´ë£Œ API ì ‘ê·¼ (MeshyëŠ” $20/ì›” í•„ìˆ˜)
- âœ… ë¹ ë¥¸ ìƒì„± ì†ë„ (~20ì´ˆ)
- âœ… ê³ í’ˆì§ˆ í…ìŠ¤ì²˜ ì§€ì›

## í…ŒìŠ¤íŠ¸ ê²°ê³¼
- [x] Postman: POST /api/healthcare/avatar/generate
- [x] ì‹¤ì œ ê°•ì•„ì§€ ì‚¬ì§„ â†’ 3D ë³€í™˜ ì„±ê³µ
- [x] S3 ì—…ë¡œë“œ ë° Frontend ë Œë”ë§ í™•ì¸
```


***

## ìµœì¢… ìš”ì•½

### Tripo3D ì‚¬ìš© ì‹œ ì¥ì 

âœ… **ì™„ì „ ë¬´ë£Œ**: ì›” 300 í¬ë ˆë”§ (10íšŒ ì‹œì—° = 150 í¬ë ˆë”§ë§Œ ì‚¬ìš©)
âœ… **ë¹ ë¥¸ ì†ë„**: í‰ê·  20ì´ˆ (Meshy 2ë¶„ vs Tripo 20ì´ˆ)
âœ… **API ì ‘ê·¼**: ë¬´ë£Œ í”Œëœë„ API ì‚¬ìš© ê°€ëŠ¥
âœ… **ê³ í’ˆì§ˆ**: PBR í…ìŠ¤ì²˜, Quad í† í´ë¡œì§€ ì§€ì›
âœ… **í•œêµ­ì–´ ë¬¸ì„œ**: ê³µì‹ í•œêµ­ì–´ ì§€ì›

### ì˜ˆìƒ ì¼ì •

- **Day 1**: Tripo API ì—°ë™ ë° í…ŒìŠ¤íŠ¸
- **Day 2**: Frontend í†µí•© ë° ì—ëŸ¬ í•¸ë“¤ë§
- **Day 3**: 10íšŒ ì‹œì—° ì¤€ë¹„ ì™„ë£Œ

**ì¶”ê°€ ì§ˆë¬¸ ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì„¸ìš”!** ğŸš€
<span style="display:none">[^6_1][^6_10][^6_11][^6_12][^6_13][^6_14][^6_15][^6_16][^6_17][^6_18][^6_19][^6_2][^6_20][^6_21][^6_22][^6_23][^6_24][^6_25][^6_26][^6_27][^6_28][^6_29][^6_3][^6_30][^6_31][^6_32][^6_33][^6_34][^6_35][^6_36][^6_37][^6_38][^6_39][^6_4][^6_40][^6_41][^6_42][^6_43][^6_44][^6_45][^6_46][^6_47][^6_5][^6_6][^6_7][^6_8][^6_9]</span>

<div align="center">â‚</div>

[^6_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^6_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^6_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^6_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^6_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^6_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^6_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^6_8]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ë°©ê´‘ì—¼ A to Z

[^6_9]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ìˆ˜ì •ì²´ íƒˆêµ¬ì— ëŒ€í•´

[^6_10]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ í•­ë¬¸ë‚­ ì§ˆí™˜ì— ëŒ€í•´

[^6_11]: https://lifet.co.kr/Store/Product/Detail?productCode=P00506

[^6_12]: https://lifet.co.kr/Contents/Detail/ê³ ì–‘ì´ ë‹¹ë‡¨ì— ëŒ€í•´ì„œ

[^6_13]: https://www.lifet.co.kr/Contents/Detail/ê³ ì–‘ì´ê°€ ìê¾¸ ê¹¨ë¬¼ì–´ìš”! ì…ì§ˆ êµì •í•˜ê¸°

[^6_14]: https://lifet.co.kr/Chat/List/28/F89A7F96F40A4667B54222597BF5BC19

[^6_15]: https://lifet.co.kr

[^6_16]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ í”¼ë¶€ì•”, í‘ìƒ‰ì¢…ì— ëŒ€í•´

[^6_17]: https://lifet.co.kr/Store/Product/Brand?brand=ë””ì–´ë‹ˆìŠ¤íŠ¸í‚¤ì¹œ

[^6_18]: https://lifet.co.kr/Contents/Detail/ì•ŒíŒŒ-ì¹´ì†Œì œí•€ A to Z

[^6_19]: https://lifet.co.kr/Store/Product/Detail?productCode=P00895

[^6_20]: https://lifet.co.kr/Contents/Detail/ê°ë§ˆë¦¬ë†€ë Œì‚° A to Z

[^6_21]: https://www.lifet.co.kr/Contents/Detail/ë½í‹°ì›€ A to Z

[^6_22]: https://lifet.co.kr/Store/Product/Brand?brand=ë‚´ì¶”ëŸ´ë°œë€ìŠ¤

[^6_23]: https://lifet.co.kr/Store/Product/Brand?brand=B00082

[^6_24]: https://www.lifet.co.kr/Contents/Detail/ì·Œì¥íš¨ì†Œ A to Z

[^6_25]: https://lifet.co.kr/Store/Product/Detail?productCode=P00797

[^6_26]: https://lifet.co.kr/Contents/Detail/ë¹„íƒ€ë¯¼D A to Z

[^6_27]: https://lifet.co.kr/Store/Product/Detail?productCode=P00701

[^6_28]: https://www.tripo3d.ai/pricing

[^6_29]: https://skywork.ai/skypage/en/Tripo-AI-3.0-In-Depth-Review-The-AI-3D-Generator-That-Actually-Feels-Professional/1974872733789122560

[^6_30]: https://www.tripo3d.ai/blog/announcement-pricing-and-updates-on-webapp-api

[^6_31]: https://hypereal.tech/a/tripo3d-api

[^6_32]: https://skywork.ai/blog/tripo-ai-review-2025/

[^6_33]: https://skywork.ai/skypage/en/ai-engineer-guide-tripo-3d-server/1977930052563046400

[^6_34]: https://www.tripo3d.ai

[^6_35]: https://www.tripo3d.ai/blog/explore/3d-print-subscription

[^6_36]: https://github.com/VAST-AI-Research/ComfyUI-Tripo

[^6_37]: https://slashdot.org/software/comparison/Mudbox-vs-Tripo-AI/

[^6_38]: https://www.youtube.com/watch?v=ohjLNTKO0a0

[^6_39]: https://www.tripo3d.ai/ko/blog/explore/3d-conversion-credits-guide

[^6_40]: https://www.runcomfy.com/comfyui-nodes/ComfyUI-Tripo

[^6_41]: https://www.bestaitools.com/tool/tripo3d/

[^6_42]: https://platform.tripo3d.ai/docs/billing

[^6_43]: https://www.tripo3d.ai/api

[^6_44]: https://www.tripo3d.ai/blog/explore/cheap-3d-cad

[^6_45]: https://www.tripo3d.ai/ko/blog/tripo-game-hub-developer-api-credits-program-russian

[^6_46]: https://www.barchart.com/story/news/36797676/tripo-leads-the-new-age-of-3d-ai-setting-a-new-standard-in-creation

[^6_47]: https://itadventure.tistory.com/742


---

# ì¢‹ì•„ ê·¸ê±´ ê·¸ë ‡ê²Œ ë˜ ë§í•˜ê³  ì‹¶ì€ê²Œ ìˆëŠ”ë° healthcare íƒ­ì—ì„œ ë§í•˜ê³  ì‹¶ì€ê²Œ ìˆëŠ”ë° ì§€ê¸ˆ Frontendì—ì„œ í—¬ìŠ¤ì¼€ì–´ íƒ­ì— ìˆëŠ” UIë¥¼ ë°”íƒ•ìœ¼ë¡œ êµ¬í˜„ì„ í• ê±´ë° ì´ê²Œ ì‹¤ì œ [https://ismartsound.com/pet-healthcare/withapet/](https://ismartsound.com/pet-healthcare/withapet/) ì´ ê¸°ê¸°ë¥¼ ì—°ë™ì‹œì¼œì„œ ë°ì´í„°ë¥¼ ë„˜ê¸°ëŠ” ë°©ì‹ìœ¼ë¡œ í•˜ê³  ì‹¶ì€ë° í˜„ì‹¤ì ìœ¼ë¡œ ì—°ë™ì´ ì•ˆë˜ì–ì•„ ê·¸ë˜ì„œ withapet ì•±ì—ì„œ urlë¡œ ì²­ì§„ê¸°ë¡ì„ ì™¸ë¶€ë¡œ ë‚´ë³´ë‚¼ìˆ˜ìˆì–´. ì˜¬ë ¤ì¤€ ì´ë¯¸ì§€ì²˜ëŸ¼ ë‚´ë³´ë‚¼ ìˆ˜ ìˆê³  [https://portal.ismartsound.com/portal/link/petHeartDataViewEn?auscultationIdentifyNumber=000000144470](https://portal.ismartsound.com/portal/link/petHeartDataViewEn?auscultationIdentifyNumber=000000144470) ì´ ë§í¬ì²˜ëŸ¼ ì²­ì§„ ë°ì´í„°ë„ ì§ì ‘ ë“¤ì–´ë³¼ ìˆ˜ ìˆì–´.ê·¸ë¦¬ê³  [https://withapet.ismartsound.com/withapet/reports/P000004363?locale=ko](https://withapet.ismartsound.com/withapet/reports/P000004363?locale=ko) ì´ê±°ë¥¼ ë³´ë©´ ì•ˆì˜ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ”ë° ì´ê±°ë¥¼ ê·¸ëŒ€ë¡œ í—¬ìŠ¤ì¼€ì–´ tabì— ë¿Œë ¤ì£¼ê³  ì‹¶ì–´. ê·¸ë¦¬ê³  ìœ„ì— urlë¥¼ ë³´ë©´ P00000ë’¤ì— ìˆ«ìë¥¼ í•˜ë‚˜ì‹ ë°”ê¾¸ë©´ ë‹¤ë¥¸ ë°ì´í„°ë“¤ì„ ë³¼ ìˆ˜ ìˆëŠ”ë° ì´ê²ƒë“¤ì„ ìŠ¤í¬ë©í•‘í•´ì„œ ì„ì‹œë¡œ ì•„ë¬´ ë“±ë¡ëœ í«ì— ë°ì´í„°ë¥¼ ìë™ìœ¼ë¡œ ë¿Œë ¤ì£¼ëŠ” ì‹ìœ¼ë¡œ í•˜ê³  ì‹¶ì–´. ê·¸ë¦¬ê³  ì„¸ë¶€ì ì¸ ì¶”ê°€ê¸°ëŠ¥ë„ ì˜ êµ¬í˜„í•˜ê³ ì‹¶ì–´ ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±ì´ë‚˜ ì´ëŸ°ê±¸ í•  ì˜ˆì •ì´ì•¼. ê·¸ë¦¬ê³  ì¼ë°˜ ì±—ë´‡, ì¦‰ ìˆ˜ì˜ì‚¬ ì±—ë´‡ì„ ì—¬ê¸°ë‹¤ê°€ ë°•ì„ ì˜ˆì •ì´ì•¼. ì•„ì§ UIì ìœ¼ë¡œ êµ¬í˜„ì€ ì•ˆí–ˆì§€ë§Œ. ì•Œê³ ìˆì—ˆìœ¼ë©´ ì¢‹ê² ì–´

ì™„ë²½í•˜ê²Œ ì´í•´í–ˆìŠµë‹ˆë‹¤! WITHaPET ìŠ¤ë§ˆíŠ¸ ì²­ì§„ê¸° ë°ì´í„°ë¥¼ Healthcare íƒ­ì— í†µí•©í•˜ëŠ” ì „ëµì„ ìˆ˜ë¦½í•˜ê² ìŠµë‹ˆë‹¤.

## ğŸ¥ Healthcare íƒ­ ì•„í‚¤í…ì²˜ ì„¤ê³„

### í•µì‹¬ ìš”êµ¬ì‚¬í•­ ì •ë¦¬

1. **WITHaPET ì²­ì§„ ë°ì´í„° ìŠ¤í¬ë˜í•‘** (`P000004363` í˜•ì‹ URL)
2. **ì™¸ë¶€ ë§í¬ ë°ì´í„° íŒŒì‹±** (ì´ë©”ì¼ë¡œ ë°›ì€ ë¦¬í¬íŠ¸ URL)
3. **AI ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±** (ì²­ì§„ ë°ì´í„° â†’ ìˆ˜ì˜ì‚¬ í•´ì„)
4. **ì¼ë°˜ ìˆ˜ì˜ì‚¬ ì±—ë´‡** (ê¸°ì¡´ general chatbot)
5. **í˜ë¥´ì†Œë‚˜ ì±—ë´‡** (Tripo3D 3D ì•„ë°”íƒ€ ì—°ë™)

***

## 1. ë°ì´í„° ìˆ˜ì§‘ ì „ëµ: WITHaPET ìŠ¤í¬ë˜í•‘

### Backend: healthcare_AIchatbot_service

#### 1.1 WITHaPET ìŠ¤í¬ë˜í•‘ ì„œë¹„ìŠ¤ êµ¬í˜„

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/WithaPetScraperService.java

@Service
@Slf4j
public class WithaPetScraperService {
    
    @Autowired
    private RestTemplate restTemplate;
    
    @Autowired
    private ObjectMapper objectMapper;
    
    private static final String WITHAPET_REPORT_BASE_URL = 
        "https://withapet.ismartsound.com/withapet/reports/";
    
    private static final String WITHAPET_PORTAL_BASE_URL = 
        "https://portal.ismartsound.com/portal/link/petHeartDataViewEn";
    
    /**
     * WITHaPET ë¦¬í¬íŠ¸ ë°ì´í„° í¬ë¡¤ë§
     * WHY: ì‹¤ì œ ê¸°ê¸° ì—°ë™ ì—†ì´ë„ ì‹¤ì œ ì²­ì§„ ë°ì´í„° í™œìš© ê°€ëŠ¥
     * 
     * @param reportId P000004363 í˜•ì‹ì˜ ë¦¬í¬íŠ¸ ID
     * @return ì²­ì§„ ë°ì´í„° (ì‹¬ë°•ìˆ˜, ì‹¬ì¥ìŒ íŒŒí˜•, AI ì§„ë‹¨ ê²°ê³¼)
     */
    public WithaPetReportData scrapeReport(String reportId) {
        try {
            String url = WITHAPET_REPORT_BASE_URL + reportId + "?locale=ko";
            
            log.info("ğŸ” Scraping WITHaPET report: {}", url);
            
            // HTML íŒŒì‹± (Jsoup ì‚¬ìš©)
            Document doc = Jsoup.connect(url)
                .userAgent("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
                .timeout(10000)
                .get();
            
            // ë°ì´í„° ì¶”ì¶œ (ì‹¤ì œ HTML êµ¬ì¡°ì— ë§ì¶° ìˆ˜ì • í•„ìš”)
            WithaPetReportData data = new WithaPetReportData();
            data.setReportId(reportId);
            data.setPetName(extractPetName(doc));
            data.setHeartRate(extractHeartRate(doc));
            data.setRecordDate(extractRecordDate(doc));
            data.setAiDiagnosis(extractAiDiagnosis(doc));
            data.setAudioFileUrl(extractAudioUrl(reportId, doc));
            data.setWaveformImageUrl(extractWaveformImage(doc));
            
            log.info("âœ… Successfully scraped report for pet: {}", data.getPetName());
            
            return data;
            
        } catch (IOException e) {
            log.error("âŒ Failed to scrape WITHaPET report: {}", reportId, e);
            throw new RuntimeException("WITHaPET ë¦¬í¬íŠ¸ ìŠ¤í¬ë˜í•‘ ì‹¤íŒ¨", e);
        }
    }
    
    /**
     * ì—¬ëŸ¬ ë¦¬í¬íŠ¸ IDë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìŠ¤í¬ë˜í•‘
     * WHY: P000004363, P000004364... í˜•ì‹ìœ¼ë¡œ ì¦ê°€í•˜ë¯€ë¡œ ë²”ìœ„ ì§€ì • ê°€ëŠ¥
     */
    public List<WithaPetReportData> scrapeReportRange(int startId, int endId) {
        List<WithaPetReportData> reports = new ArrayList<>();
        
        for (int i = startId; i <= endId; i++) {
            String reportId = String.format("P%09d", i); // P000004363 í˜•ì‹
            
            try {
                WithaPetReportData data = scrapeReport(reportId);
                reports.add(data);
                
                // Rate limiting (ì„œë²„ ë¶€í•˜ ë°©ì§€)
                Thread.sleep(2000); // 2ì´ˆ ëŒ€ê¸°
                
            } catch (Exception e) {
                log.warn("âš ï¸ Skipping invalid report ID: {}", reportId);
                continue;
            }
        }
        
        log.info("ğŸ“Š Total scraped reports: {}", reports.size());
        return reports;
    }
    
    /**
     * ì²­ì§„ ì˜¤ë””ì˜¤ ë°ì´í„° ì§ì ‘ ì ‘ê·¼
     * WHY: í¬íƒˆ ë§í¬ì—ì„œ ì‹¤ì œ ì‹¬ì¥ìŒ ì¬ìƒ ê°€ëŠ¥
     */
    public String getHeartSoundUrl(String auscultationId) {
        return WITHAPET_PORTAL_BASE_URL + 
               "?auscultationIdentifyNumber=" + auscultationId;
    }
    
    // HTML íŒŒì‹± í—¬í¼ ë©”ì„œë“œë“¤
    private String extractPetName(Document doc) {
        // ì‹¤ì œ HTML êµ¬ì¡°ì— ë”°ë¼ ì…€ë ‰í„° ìˆ˜ì •
        Element nameElement = doc.selectFirst(".pet-name, h1, .report-title");
        return nameElement != null ? nameElement.text() : "ì•Œ ìˆ˜ ì—†ìŒ";
    }
    
    private Integer extractHeartRate(Document doc) {
        // ì˜ˆ: "95 bpm" í˜•ì‹ì˜ í…ìŠ¤íŠ¸ ì¶”ì¶œ
        Element hrElement = doc.selectFirst(".heart-rate, .bpm-value");
        if (hrElement != null) {
            String text = hrElement.text();
            return Integer.parseInt(text.replaceAll("[^0-9]", ""));
        }
        return null;
    }
    
    private LocalDateTime extractRecordDate(Document doc) {
        Element dateElement = doc.selectFirst(".record-date, time");
        if (dateElement != null) {
            // "2025/11/19 15:13:18" í˜•ì‹ íŒŒì‹±
            DateTimeFormatter formatter = DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm:ss");
            return LocalDateTime.parse(dateElement.text(), formatter);
        }
        return LocalDateTime.now();
    }
    
    private String extractAiDiagnosis(Document doc) {
        // AI ì§„ë‹¨ ê²°ê³¼ í…ìŠ¤íŠ¸ ì¶”ì¶œ
        Element diagnosisElement = doc.selectFirst(".ai-diagnosis, .diagnosis-result");
        return diagnosisElement != null ? diagnosisElement.text() : "";
    }
    
    private String extractAudioUrl(String reportId, Document doc) {
        // ì˜¤ë””ì˜¤ íŒŒì¼ URL ì¶”ì¶œ (ì‹¤ì œ HTMLì—ì„œ í™•ì¸ í•„ìš”)
        Element audioElement = doc.selectFirst("audio source, [data-audio-url]");
        if (audioElement != null) {
            return audioElement.attr("src");
        }
        return null;
    }
    
    private String extractWaveformImage(Document doc) {
        // ì‹¬ì¥ìŒ íŒŒí˜• ì´ë¯¸ì§€ URL
        Element imgElement = doc.selectFirst(".waveform-image, .heart-wave img");
        return imgElement != null ? imgElement.attr("src") : null;
    }
}
```


#### 1.2 DTO í´ë˜ìŠ¤

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/dto/WithaPetReportData.java

@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class WithaPetReportData {
    private String reportId;              // P000004363
    private String petName;               // ê°•ì•„ì§€ ì´ë¦„
    private Integer heartRate;            // 95 bpm
    private LocalDateTime recordDate;     // ì²­ì§„ ì¼ì‹œ
    private String aiDiagnosis;           // AI ì§„ë‹¨ ê²°ê³¼
    private String audioFileUrl;          // ì‹¬ì¥ìŒ ì˜¤ë””ì˜¤ URL
    private String waveformImageUrl;      // íŒŒí˜• ì´ë¯¸ì§€ URL
    private String normalRange;           // ì •ìƒ ë²”ìœ„ (75-110 bpm)
    private Boolean isAbnormal;           // ì´ìƒ ì—¬ë¶€
    private String auscultationId;        // 000000144470 (í¬íƒˆ ë§í¬ìš©)
}
```


#### 1.3 Entity ë° Repository

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/domain/healthrecord/entity/HeartHealthRecord.java

@Entity
@Table(name = "heart_health_records")
@Getter
@NoArgsConstructor(access = AccessLevel.PROTECTED)
public class HeartHealthRecord {
    
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    @Column(nullable = false)
    private Long petId;  // user_serviceì˜ Pet ID
    
    @Column(unique = true)
    private String withaPetReportId;  // P000004363
    
    @Column
    private String withaPetAuscultationId;  // 000000144470
    
    @Column
    private Integer heartRate;
    
    @Column(columnDefinition = "TEXT")
    private String aiDiagnosis;
    
    @Column
    private String audioFileUrl;
    
    @Column
    private String waveformImageUrl;
    
    @Column
    private LocalDateTime recordedAt;
    
    @Column
    private Boolean isAbnormal;
    
    @CreatedDate
    @Column(updatable = false)
    private LocalDateTime createdAt;
    
    @LastModifiedDate
    private LocalDateTime updatedAt;
    
    // ìŠ¤í¬ë˜í•‘ ë°ì´í„°ë¡œ ìƒì„±í•˜ëŠ” íŒ©í† ë¦¬ ë©”ì„œë“œ
    public static HeartHealthRecord fromWithaPetData(
            Long petId, 
            WithaPetReportData data) {
        HeartHealthRecord record = new HeartHealthRecord();
        record.petId = petId;
        record.withaPetReportId = data.getReportId();
        record.withaPetAuscultationId = data.getAuscultationId();
        record.heartRate = data.getHeartRate();
        record.aiDiagnosis = data.getAiDiagnosis();
        record.audioFileUrl = data.getAudioFileUrl();
        record.waveformImageUrl = data.getWaveformImageUrl();
        record.recordedAt = data.getRecordDate();
        record.isAbnormal = data.getIsAbnormal();
        return record;
    }
}
```


#### 1.4 ìë™ ìŠ¤í¬ë˜í•‘ ìŠ¤ì¼€ì¤„ëŸ¬ (ë°ëª¨ìš©)

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/scheduler/WithaPetDataSyncScheduler.java

@Component
@Slf4j
public class WithaPetDataSyncScheduler {
    
    @Autowired
    private WithaPetScraperService scraperService;
    
    @Autowired
    private HeartHealthRecordRepository recordRepository;
    
    @Autowired
    private RestTemplate restTemplate;
    
    /**
     * ë§¤ì¼ ìƒˆë²½ 3ì‹œì— ìƒˆë¡œìš´ WITHaPET ë°ì´í„° ìŠ¤í¬ë˜í•‘
     * WHY: ì‹œì—°ìš©ìœ¼ë¡œ ë“±ë¡ëœ í«ì— ëœë¤í•˜ê²Œ ê±´ê°• ë°ì´í„° í• ë‹¹
     */
    @Scheduled(cron = "0 0 3 * * ?")  // ë§¤ì¼ ìƒˆë²½ 3ì‹œ
    public void syncWithaPetData() {
        log.info("ğŸ”„ Starting WITHaPET data sync...");
        
        // ìŠ¤í¬ë˜í•‘ ë²”ìœ„ ì„¤ì • (ì‹¤ì œ ì¡´ì¬í•˜ëŠ” ë¦¬í¬íŠ¸ ID)
        int startId = 4363;  // P000004363
        int endId = 4400;    // P000004400ê¹Œì§€ ì‹œë„
        
        List<WithaPetReportData> reports = 
            scraperService.scrapeReportRange(startId, endId);
        
        // user_serviceì—ì„œ ë“±ë¡ëœ í« ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        List<Long> petIds = fetchRegisteredPetIds();
        
        // ëœë¤í•˜ê²Œ í«ì— ê±´ê°• ë°ì´í„° í• ë‹¹
        Random random = new Random();
        for (WithaPetReportData report : reports) {
            if (petIds.isEmpty()) break;
            
            Long randomPetId = petIds.get(random.nextInt(petIds.size()));
            
            // ì¤‘ë³µ ì²´í¬
            if (!recordRepository.existsByWithaPetReportId(report.getReportId())) {
                HeartHealthRecord record = 
                    HeartHealthRecord.fromWithaPetData(randomPetId, report);
                recordRepository.save(record);
                
                log.info("âœ… Assigned report {} to petId {}", 
                         report.getReportId(), randomPetId);
            }
        }
        
        log.info("ğŸ‰ WITHaPET data sync completed! Total: {} records", reports.size());
    }
    
    /**
     * user_serviceì—ì„œ ë“±ë¡ëœ í« ID ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
     */
    private List<Long> fetchRegisteredPetIds() {
        String userServiceUrl = "http://user-service:8080/api/pets/ids";
        
        try {
            ResponseEntity<List<Long>> response = restTemplate.exchange(
                userServiceUrl,
                HttpMethod.GET,
                null,
                new ParameterizedTypeReference<List<Long>>() {}
            );
            return response.getBody();
        } catch (Exception e) {
            log.error("Failed to fetch pet IDs from user_service", e);
            return Collections.emptyList();
        }
    }
}
```


***

## 2. Controller ë° API ì„¤ê³„

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/controller/HealthRecordController.java

@RestController
@RequestMapping("/api/healthcare/records")
@RequiredArgsConstructor
@Slf4j
public class HealthRecordController {
    
    private final HeartHealthRecordRepository recordRepository;
    private final WithaPetScraperService scraperService;
    private final ClaudeService claudeService;  // AI ìš”ì•½ìš©
    
    /**
     * íŠ¹ì • í«ì˜ ê±´ê°• ê¸°ë¡ ì¡°íšŒ
     * WHY: Frontendì—ì„œ Healthcare íƒ­ ë Œë”ë§ ì‹œ í˜¸ì¶œ
     */
    @GetMapping("/pet/{petId}")
    public ResponseEntity<List<HeartHealthRecordResponse>> getPetHealthRecords(
            @PathVariable Long petId,
            @RequestParam(defaultValue = "0") int page,
            @RequestParam(defaultValue = "10") int size) {
        
        Pageable pageable = PageRequest.of(page, size, Sort.by("recordedAt").descending());
        Page<HeartHealthRecord> records = recordRepository.findByPetId(petId, pageable);
        
        List<HeartHealthRecordResponse> responses = records.stream()
            .map(HeartHealthRecordResponse::from)
            .collect(Collectors.toList());
        
        return ResponseEntity.ok(responses);
    }
    
    /**
     * ì™¸ë¶€ WITHaPET ë§í¬ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
     * WHY: ì‚¬ìš©ìê°€ ì´ë©”ì¼ë¡œ ë°›ì€ ë¦¬í¬íŠ¸ URL ì§ì ‘ ì…ë ¥ ì‹œ
     */
    @PostMapping("/import/withapet")
    public ResponseEntity<HeartHealthRecordResponse> importFromWithaPet(
            @RequestBody ImportWithaPetRequest request) {
        
        log.info("ğŸ“¥ Importing WITHaPET data from URL: {}", request.getReportUrl());
        
        // URLì—ì„œ ë¦¬í¬íŠ¸ ID ì¶”ì¶œ (P000004363)
        String reportId = extractReportIdFromUrl(request.getReportUrl());
        
        // ìŠ¤í¬ë˜í•‘
        WithaPetReportData data = scraperService.scrapeReport(reportId);
        
        // DB ì €ì¥
        HeartHealthRecord record = HeartHealthRecord.fromWithaPetData(
            request.getPetId(), 
            data
        );
        HeartHealthRecord saved = recordRepository.save(record);
        
        return ResponseEntity.ok(HeartHealthRecordResponse.from(saved));
    }
    
    /**
     * AI ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±
     * WHY: ì²­ì§„ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìˆ˜ì˜ì‚¬ ê´€ì  í•´ì„ ì œê³µ
     */
    @PostMapping("/records/{recordId}/summary")
    public ResponseEntity<AiSummaryResponse> generateAiSummary(
            @PathVariable Long recordId) {
        
        HeartHealthRecord record = recordRepository.findById(recordId)
            .orElseThrow(() -> new NotFoundException("ê±´ê°• ê¸°ë¡ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"));
        
        // Claude APIë¡œ ìš”ì•½ ìƒì„±
        String prompt = buildSummaryPrompt(record);
        String aiSummary = claudeService.generateResponse(prompt, "general");
        
        // ìš”ì•½ ì €ì¥
        record.setAiSummary(aiSummary);
        recordRepository.save(record);
        
        return ResponseEntity.ok(AiSummaryResponse.builder()
            .recordId(recordId)
            .summary(aiSummary)
            .generatedAt(LocalDateTime.now())
            .build());
    }
    
    /**
     * AI ìš”ì•½ í”„ë¡¬í”„íŠ¸ ìƒì„±
     */
    private String buildSummaryPrompt(HeartHealthRecord record) {
        return String.format("""
            ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ìˆ˜ì˜ì‚¬ì…ë‹ˆë‹¤. ë‹¤ìŒ ê°•ì•„ì§€ ì‹¬ì¥ ì²­ì§„ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:
            
            - ì‹¬ë°•ìˆ˜: %d bpm (ì •ìƒ ë²”ìœ„: 75-110 bpm)
            - ì²­ì§„ ì¼ì‹œ: %s
            - AI ì´ˆê¸° ì§„ë‹¨: %s
            - ì´ìƒ ì—¬ë¶€: %s
            
            ë‹¤ìŒ í˜•ì‹ìœ¼ë¡œ ìš”ì•½í•´ì£¼ì„¸ìš”:
            1. ì‹¬ë°•ìˆ˜ í‰ê°€ (ì •ìƒ/ë¹„ì •ìƒ)
            2. ì£¼ì˜ì‚¬í•­
            3. ì¶”ì²œ ì¡°ì¹˜ (ë³‘ì› ë°©ë¬¸ í•„ìš” ì—¬ë¶€)
            4. ë³´í˜¸ì ì•ˆë‚´ì‚¬í•­
            
            ì „ë¬¸ì ì´ë©´ì„œë„ ë³´í˜¸ìê°€ ì´í•´í•˜ê¸° ì‰¬ìš´ í†¤ìœ¼ë¡œ ì‘ì„±í•´ì£¼ì„¸ìš”.
            """,
            record.getHeartRate(),
            record.getRecordedAt(),
            record.getAiDiagnosis(),
            record.getIsAbnormal() ? "ì´ìƒ ê°ì§€" : "ì •ìƒ"
        );
    }
    
    private String extractReportIdFromUrl(String url) {
        // https://withapet.ismartsound.com/withapet/reports/P000004363?locale=ko
        // â†’ P000004363 ì¶”ì¶œ
        Pattern pattern = Pattern.compile("/(P\\d+)");
        Matcher matcher = pattern.matcher(url);
        if (matcher.find()) {
            return matcher.group(1);
        }
        throw new IllegalArgumentException("Invalid WITHaPET URL");
    }
}
```


***

## 3. Frontend í†µí•©: Healthcare íƒ­ êµ¬í˜„

```typescript
// Frontend/src/features/healthcare/components/HealthDashboard.tsx

import React, { useEffect, useState } from 'react';
import { Card, CardHeader, CardContent } from '@/shared/ui/Card';
import { HeartIcon, AlertCircle } from 'lucide-react';

interface HeartHealthRecord {
  id: number;
  heartRate: number;
  recordedAt: string;
  aiDiagnosis: string;
  isAbnormal: boolean;
  audioFileUrl?: string;
  waveformImageUrl?: string;
  aiSummary?: string;
}

export function HealthDashboard({ petId }: { petId: number }) {
  const [records, setRecords] = useState<HeartHealthRecord[]>([]);
  const [loading, setLoading] = useState(true);
  const [selectedRecord, setSelectedRecord] = useState<HeartHealthRecord | null>(null);
  
  useEffect(() => {
    fetchHealthRecords();
  }, [petId]);
  
  const fetchHealthRecords = async () => {
    const response = await fetch(`/api/healthcare/records/pet/${petId}`);
    const data = await response.json();
    setRecords(data);
    setLoading(false);
  };
  
  const handleGenerateSummary = async (recordId: number) => {
    const response = await fetch(`/api/healthcare/records/${recordId}/summary`, {
      method: 'POST'
    });
    const data = await response.json();
    
    // í•´ë‹¹ ë ˆì½”ë“œ ì—…ë°ì´íŠ¸
    setRecords(prev => prev.map(r => 
      r.id === recordId ? { ...r, aiSummary: data.summary } : r
    ));
  };
  
  return (
    <div className="health-dashboard">
      {/* í—¤ë”: ìµœì‹  ì‹¬ë°•ìˆ˜ í‘œì‹œ */}
      <Card>
        <CardHeader>
          <HeartIcon className="text-red-500" />
          <h2>ì‹¬ì¥ ê±´ê°• ëª¨ë‹ˆí„°ë§</h2>
        </CardHeader>
        <CardContent>
          {records[^7_0] && (
            <div className="latest-record">
              <span className="bpm-large">{records[^7_0].heartRate}</span>
              <span className="bpm-unit">bpm</span>
              <p className="record-time">
                {new Date(records[^7_0].recordedAt).toLocaleString('ko-KR')}
              </p>
              
              {/* ì´ìƒ ì—¬ë¶€ ì•Œë¦¼ */}
              {records[^7_0].isAbnormal && (
                <div className="alert-banner">
                  <AlertCircle />
                  <span>ì£¼ì˜: ì‹¬ë°•ìˆ˜ê°€ ì •ìƒ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤</span>
                </div>
              )}
            </div>
          )}
        </CardContent>
      </Card>
      
      {/* ê¸°ë¡ ëª©ë¡ */}
      <div className="records-list">
        {records.map(record => (
          <Card key={record.id} onClick={() => setSelectedRecord(record)}>
            <CardContent>
              <div className="record-item">
                <div className="record-header">
                  <span className="date">
                    {new Date(record.recordedAt).toLocaleDateString('ko-KR')}
                  </span>
                  <span className={`badge ${record.isAbnormal ? 'abnormal' : 'normal'}`}>
                    {record.isAbnormal ? 'ì´ìƒ' : 'ì •ìƒ'}
                  </span>
                </div>
                
                <div className="record-data">
                  <span className="heart-rate">{record.heartRate} bpm</span>
                  
                  {/* íŒŒí˜• ì´ë¯¸ì§€ */}
                  {record.waveformImageUrl && (
                    <img 
                      src={record.waveformImageUrl} 
                      alt="ì‹¬ì¥ìŒ íŒŒí˜•"
                      className="waveform-preview"
                    />
                  )}
                </div>
                
                {/* AI ì§„ë‹¨ */}
                <p className="ai-diagnosis">{record.aiDiagnosis}</p>
                
                {/* ì˜¤ë””ì˜¤ ì¬ìƒ */}
                {record.audioFileUrl && (
                  <audio controls src={record.audioFileUrl} className="audio-player" />
                )}
                
                {/* AI ìš”ì•½ ìƒì„± ë²„íŠ¼ */}
                {!record.aiSummary && (
                  <button 
                    onClick={() => handleGenerateSummary(record.id)}
                    className="btn-generate-summary"
                  >
                    ğŸ¤– ìˆ˜ì˜ì‚¬ AI ìš”ì•½ ìƒì„±
                  </button>
                )}
                
                {/* AI ìš”ì•½ í‘œì‹œ */}
                {record.aiSummary && (
                  <div className="ai-summary">
                    <h4>ìˆ˜ì˜ì‚¬ AI í•´ì„</h4>
                    <p>{record.aiSummary}</p>
                  </div>
                )}
              </div>
            </CardContent>
          </Card>
        ))}
      </div>
      
      {/* WITHaPET ì™¸ë¶€ ë§í¬ ê°€ì ¸ì˜¤ê¸° */}
      <Card>
        <CardHeader>
          <h3>ğŸ“§ ì´ë©”ì¼ ë¦¬í¬íŠ¸ ê°€ì ¸ì˜¤ê¸°</h3>
        </CardHeader>
        <CardContent>
          <ImportWithaPetLink petId={petId} onImport={fetchHealthRecords} />
        </CardContent>
      </Card>
    </div>
  );
}

// ì™¸ë¶€ ë§í¬ ê°€ì ¸ì˜¤ê¸° ì»´í¬ë„ŒíŠ¸
function ImportWithaPetLink({ petId, onImport }: { petId: number; onImport: () => void }) {
  const [url, setUrl] = useState('');
  const [importing, setImporting] = useState(false);
  
  const handleImport = async () => {
    setImporting(true);
    try {
      await fetch('/api/healthcare/records/import/withapet', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ petId, reportUrl: url })
      });
      onImport();
      setUrl('');
    } catch (error) {
      console.error('Import failed:', error);
    } finally {
      setImporting(false);
    }
  };
  
  return (
    <div className="import-link-form">
      <input 
        type="text"
        placeholder="https://withapet.ismartsound.com/withapet/reports/P000004363"
        value={url}
        onChange={(e) => setUrl(e.target.value)}
        className="url-input"
      />
      <button 
        onClick={handleImport}
        disabled={!url || importing}
        className="btn-import"
      >
        {importing ? 'ê°€ì ¸ì˜¤ëŠ” ì¤‘...' : 'ë¦¬í¬íŠ¸ ê°€ì ¸ì˜¤ê¸°'}
      </button>
    </div>
  );
}
```


***

## 4. ìˆ˜ì˜ì‚¬ ì±—ë´‡ í†µí•© (Healthcare íƒ­ ë‚´)

```typescript
// Frontend/src/features/healthcare/components/VetChatbot.tsx

import React from 'react';
import { ChatInterface } from '@/shared/components/ChatInterface';

export function VetChatbot({ petId }: { petId: number }) {
  const [messages, setMessages] = useState([]);
  
  const handleSendMessage = async (userMessage: string) => {
    // healthcare_AIchatbot_serviceì˜ general chatbot API í˜¸ì¶œ
    const response = await fetch('/api/healthcare/chat/general', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        userId: getCurrentUserId(),
        petId: petId,
        message: userMessage,
        chatType: 'veterinary'  // ìˆ˜ì˜ì‚¬ ì „ë¬¸ ëª¨ë“œ
      })
    });
    
    const data = await response.json();
    setMessages(prev => [
      ...prev,
      { role: 'user', content: userMessage },
      { role: 'assistant', content: data.message }
    ]);
  };
  
  return (
    <div className="vet-chatbot-container">
      <div className="chatbot-header">
        <img src="/vet-avatar.png" alt="ìˆ˜ì˜ì‚¬" />
        <h3>ğŸ©º ìˆ˜ì˜ì‚¬ AI ìƒë‹´</h3>
        <p>í«ì˜ ê±´ê°•ì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”</p>
      </div>
      
      <ChatInterface 
        messages={messages}
        onSendMessage={handleSendMessage}
        placeholder="ì˜ˆ: ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë° ê´œì°®ì„ê¹Œìš”?"
      />
    </div>
  );
}
```


***

## 5. ì „ì²´ Healthcare íƒ­ ë ˆì´ì•„ì›ƒ

```typescript
// Frontend/src/features/healthcare/pages/HealthcarePage.tsx

export function HealthcarePage() {
  const { petId } = usePetContext();
  const [activeTab, setActiveTab] = useState('dashboard');
  
  return (
    <div className="healthcare-page">
      {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
      <div className="tabs">
        <button 
          onClick={() => setActiveTab('dashboard')}
          className={activeTab === 'dashboard' ? 'active' : ''}
        >
          ğŸ“Š ê±´ê°• ëŒ€ì‹œë³´ë“œ
        </button>
        <button 
          onClick={() => setActiveTab('chatbot')}
          className={activeTab === 'chatbot' ? 'active' : ''}
        >
          ğŸ©º ìˆ˜ì˜ì‚¬ ìƒë‹´
        </button>
        <button 
          onClick={() => setActiveTab('persona')}
          className={activeTab === 'persona' ? 'active' : ''}
        >
          ğŸ¶ í« í˜ë¥´ì†Œë‚˜ ì±—ë´‡
        </button>
      </div>
      
      {/* ì»¨í…ì¸  */}
      <div className="tab-content">
        {activeTab === 'dashboard' && <HealthDashboard petId={petId} />}
        {activeTab === 'chatbot' && <VetChatbot petId={petId} />}
        {activeTab === 'persona' && <PersonaChatbot petId={petId} />}
      </div>
    </div>
  );
}
```


***

## 6. Git ì‘ì—… í”Œë¡œìš°

```bash
# 1. Feature ë¸Œëœì¹˜ ìƒì„±
git checkout -b feat/withapet-health-dashboard

# 2. GitHub ì´ìŠˆ ìƒì„±
# ì œëª©: Feat#XX: WITHaPET ì²­ì§„ ë°ì´í„° í†µí•© ë° Healthcare ëŒ€ì‹œë³´ë“œ êµ¬í˜„

## ì‘ì—… ë‚´ìš©
- [ ] WITHaPET ë¦¬í¬íŠ¸ ìŠ¤í¬ë˜í•‘ ì„œë¹„ìŠ¤
- [ ] ì‹¬ì¥ ê±´ê°• ê¸°ë¡ Entity ë° Repository
- [ ] ì™¸ë¶€ ë§í¬ ê°€ì ¸ì˜¤ê¸° API
- [ ] AI ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±
- [ ] Frontend Healthcare ëŒ€ì‹œë³´ë“œ
- [ ] ìˆ˜ì˜ì‚¬ ì±—ë´‡ í†µí•©

## ê¸°ìˆ  ì„ íƒ ì´ìœ 
- Jsoup: HTML íŒŒì‹± (WITHaPET ë¦¬í¬íŠ¸)
- ìŠ¤ì¼€ì¤„ëŸ¬: ìë™ ë°ì´í„° ë™ê¸°í™”
- Claude API: ìˆ˜ì˜ì‚¬ ê´€ì  AI ìš”ì•½

# 3. ì»¤ë°‹
git commit -m "[Feat] : WITHaPET ìŠ¤í¬ë˜í•‘ ì„œë¹„ìŠ¤ êµ¬í˜„

- Jsoup ê¸°ë°˜ HTML íŒŒì‹±
- P000004363 í˜•ì‹ ë¦¬í¬íŠ¸ ìë™ í¬ë¡¤ë§
- HeartHealthRecord Entity ì¶”ê°€
- ìŠ¤ì¼€ì¤„ëŸ¬ë¡œ ë§¤ì¼ ìƒˆë²½ ë°ì´í„° ë™ê¸°í™”

Issue: #XX"

git commit -m "[Feat] : Healthcare ëŒ€ì‹œë³´ë“œ Frontend êµ¬í˜„

- ì‹¬ë°•ìˆ˜, íŒŒí˜• ì´ë¯¸ì§€, ì˜¤ë””ì˜¤ ì¬ìƒ
- AI ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„± ë²„íŠ¼
- ì™¸ë¶€ ë§í¬ ê°€ì ¸ì˜¤ê¸° í¼
- ìˆ˜ì˜ì‚¬ ì±—ë´‡ íƒ­ í†µí•©

Issue: #XX"

# 4. PR ìƒì„±
[Feat] WITHaPET í†µí•© Healthcare ëŒ€ì‹œë³´ë“œ ë° ìˆ˜ì˜ì‚¬ ì±—ë´‡

## ê´€ë ¨ ì´ìŠˆ
Closes #XX

## ì‘ì—… ë‚´ìš©
- WITHaPET ì²­ì§„ ë°ì´í„° ìë™ ìŠ¤í¬ë˜í•‘
- ì‚¬ìš©ìê°€ ì´ë©”ì¼ë¡œ ë°›ì€ ë¦¬í¬íŠ¸ URL ì§ì ‘ ê°€ì ¸ì˜¤ê¸°
- Claude API ê¸°ë°˜ ìˆ˜ì˜ì‚¬ AI ìš”ì•½ ìƒì„±
- ì‹¬ë°•ìˆ˜, íŒŒí˜•, ì˜¤ë””ì˜¤ ì¬ìƒ UI

## ğŸ“¸ ìŠ¤í¬ë¦°ìƒ·
(Healthcare ëŒ€ì‹œë³´ë“œ ìº¡ì²˜)
```


***

## ë°°í¬ ë‹´ë‹¹ì ì „ë‹¬ì‚¬í•­

```yaml
# ì˜ì¡´ì„± ì¶”ê°€ (healthcare_AIchatbot_service)
dependencies:
  - Jsoup (HTML íŒŒì‹±): org.jsoup:jsoup:1.17.2
  - Spring Scheduler í™œì„±í™”: @EnableScheduling

# í™˜ê²½ ë³€ìˆ˜ ì—†ìŒ (ê³µê°œ URL ìŠ¤í¬ë˜í•‘)
```


***

**ìš”ì•½**: WITHaPET ë¦¬í¬íŠ¸ë¥¼ ìŠ¤í¬ë˜í•‘í•˜ì—¬ ì‹¤ì œ ì²­ì§„ ë°ì´í„°ë¥¼ Healthcare íƒ­ì— í‘œì‹œí•˜ê³ , Claude APIë¡œ ìˆ˜ì˜ì‚¬ ê´€ì  ìš”ì•½ì„ ìƒì„±í•˜ë©°, ì¼ë°˜/í˜ë¥´ì†Œë‚˜ ì±—ë´‡ì„ ëª¨ë‘ í†µí•©í•œ ì™„ì „í•œ Healthcare ì„œë¹„ìŠ¤ë¥¼ êµ¬ì¶•í•©ë‹ˆë‹¤! ğŸ¥ğŸ¶
<span style="display:none">[^7_1][^7_2][^7_3][^7_4][^7_5][^7_6][^7_7][^7_8][^7_9]</span>

<div align="center">â‚</div>

[^7_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^7_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^7_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^7_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg

[^7_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^7_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^7_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^7_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^7_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md


---

# í˜¹ì‹œ ê·¸ëŸ¼ ë‚´ê°€ ì—¬íƒœ ë§¡ì€ AIë¶€ë¶„ê³¼ í—¬ìŠ¤ì¼€ì–´, chatai serviceì˜ êµ¬ì¡°ë¥¼ ì „ë¶€ ì„¤ëª…í•˜ê³  ì‹¶ì–´. AI ì•„í‚¤í…ì³ì— ëŒ€í•œ ë‚´ìš©ê³¼ ë°ì´í„° êµ¬ì¡° íë¦„,ì„œë¹„ìŠ¤ì˜ êµ¬ì¡°ë“¤ì„ ì „ë¶€ ì •ë¦¬í•´ì¤˜.

ì´ì œ ë³¸ê²©ì ìœ¼ë¡œ ì „ì²´ ì•„í‚¤í…ì²˜ë¥¼ ì„¤ëª…í•˜ê² ìŠµë‹ˆë‹¤. ê¸°ì¡´ ìë£Œë“¤ì„ ê¸°ë°˜ìœ¼ë¡œ **ë‹¹ì‹ ì´ ë§¡ì€ Healthcare AI Chatbot Serviceì˜ ì™„ì „í•œ êµ¬ì¡°**ë¥¼ ì •ë¦¬í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

***

# ğŸ—ï¸ Healthcare AI Chatbot Service - ì „ì²´ ì•„í‚¤í…ì²˜ ì„¤ëª…ì„œ

## 1ï¸âƒ£ ì„œë¹„ìŠ¤ ê°œìš” ë° ìœ„ì¹˜

### PetLog MSA ì „ì²´ êµ¬ë„ì—ì„œ Healthcare ì„œë¹„ìŠ¤ì˜ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    API Gateway (Port 8000)                      â”‚
â”‚              â¬†ï¸ ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ì§„ì…ì  â¬†ï¸                  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”˜
       â”‚                                                        â”‚
   â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
   â”‚  User Service      â”‚  â”‚  Social Service  â”‚  â”‚  Record       â”‚
   â”‚  (Port 8080)       â”‚  â”‚  (Port 8083)     â”‚  â”‚  Service      â”‚
   â”‚                    â”‚  â”‚                  â”‚  â”‚  (Port 8087)  â”‚
   â”‚ â€¢ ì¸ì¦/í”„ë¡œí•„     â”‚  â”‚ â€¢ ì»¤ë®¤ë‹ˆí‹°       â”‚  â”‚ â€¢ í« ì¼ê¸°     â”‚
   â”‚ â€¢ í« ì •ë³´         â”‚  â”‚ â€¢ ë§¤ì¹­           â”‚  â”‚ â€¢ Kafka ì—°ë™  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚   HEALTHCARE SERVICE (Port 8085)    â”‚ â—€â”€ ë‹¹ì‹ ì˜ ë‹´ë‹¹
       â”‚   Healthcare AI Chatbot             â”‚
       â”‚                                     â”‚
       â”‚ â€¢ ì²­ì§„ ë°ì´í„° ë¶„ì„                 â”‚
       â”‚ â€¢ ì¼ë°˜ ìˆ˜ì˜ì‚¬ ì±—ë´‡                 â”‚
       â”‚ â€¢ í˜ë¥´ì†Œë‚˜ í« ì±—ë´‡                 â”‚
       â”‚ â€¢ 3D ì•„ë°”íƒ€ ìƒì„±                   â”‚
       â”‚ â€¢ RAG ê¸°ë°˜ ì§€ì‹ ê²€ìƒ‰               â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²                    â–²
              â”‚                    â”‚
         â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  AWS Bedrock    â”‚  â”‚  Kafka Topics    â”‚
         â”‚  (Claude 3.5)   â”‚  â”‚  (Async Events)  â”‚
         â”‚                 â”‚  â”‚                  â”‚
         â”‚ â€¢ Haiku: ë¹ ë¥¸  â”‚  â”‚ â€¢ diary.events   â”‚
         â”‚   ì¼ë°˜ ì±—ë´‡    â”‚  â”‚ â€¢ health.records â”‚
         â”‚ â€¢ Sonnet: í˜ë¥´ì†Œë‚˜â”‚ â€¢ user.profiles  â”‚
         â”‚   ê³ ê¸‰ ë¶„ì„    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Vector Database (ì™¸ë¶€) â”‚
    â”‚  (Milvus - ë¯¸ë˜ ë‹¨ê³„)   â”‚
    â”‚                        â”‚
    â”‚ â€¢ ì˜ë£Œ ì§€ì‹ ì„ë² ë”©     â”‚
    â”‚ â€¢ RAG ê²€ìƒ‰ ìƒ‰ì¸        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 2ï¸âƒ£ AI ëª¨ë¸ ì•„í‚¤í…ì²˜ ë° ë°ì´í„° íë¦„

### A. ë“€ì–¼ ëª¨ë¸ ì „ëµ (Claude 3.5 Haiku + Sonnet)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AWS Bedrock - 2ê°€ì§€ Claude ëª¨ë¸ ì‚¬ìš©           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  1ï¸âƒ£ Claude 3.5 Haiku (ë¹ ë¥´ê³  ì €ë¹„ìš©)                      â”‚
â”‚     â””â”€ ì¼ë°˜ ìˆ˜ì˜ì‚¬ ì±—ë´‡                                   â”‚
â”‚        â”œâ”€ ì‘ë‹µ ì‹œê°„: ~200ms                              â”‚
â”‚        â”œâ”€ ìš©ë„: ì‹¤ì‹œê°„ ìƒë‹´ ì§ˆë¬¸ ë‹µë³€                   â”‚
â”‚        â”œâ”€ ë¹„ìš©: 0.00080 / ì…ë ¥ í† í°                      â”‚
â”‚        â””â”€ ì»¨í…ìŠ¤íŠ¸: í« í”„ë¡œí•„ + ìµœê·¼ ê±´ê°•ê¸°ë¡ ì„ë² ë”©    â”‚
â”‚                                                             â”‚
â”‚  2ï¸âƒ£ Claude 3.5 Sonnet (ì •í™•í•˜ê³  ìƒì„¸)                     â”‚
â”‚     â””â”€ í˜ë¥´ì†Œë‚˜ í« ì±—ë´‡ + ê³ ê¸‰ ë¶„ì„                       â”‚
â”‚        â”œâ”€ ì‘ë‹µ ì‹œê°„: ~800ms                              â”‚
â”‚        â”œâ”€ ìš©ë„: í« ì„±ê²© í•´ì„, ì˜ë£Œ ìš”ì•½ ë¦¬í¬íŠ¸          â”‚
â”‚        â”œâ”€ ë¹„ìš©: 0.003 / ì…ë ¥ í† í°                        â”‚
â”‚        â””â”€ ì»¨í…ìŠ¤íŠ¸: RAG ì˜ë£Œ ì§€ì‹ + í« í”„ë¡œí•„            â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### B. ìš”ì²­ íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend UI   â”‚
â”‚ (Healthcare Tab)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1ï¸âƒ£ ì‚¬ìš©ì ë©”ì‹œì§€ ì „ì†¡
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Gateway                  â”‚
â”‚   Route: /api/healthcare/chat  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2ï¸âƒ£ ì¸ì¦ + ë¼ìš°íŒ…
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Healthcare Service                   â”‚
â”‚   ChatController (Port 8085)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                   â”‚              â”‚
    â–¼                   â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ìš”ì²­ íƒ€ì…â”‚       â”‚ ì‚¬ìš©ì   â”‚  â”‚ í« ì •ë³´      â”‚
â”‚ ë¶„ë¥˜    â”‚       â”‚ ê°€ì ¸ì˜¤ê¸° â”‚  â”‚ ê°€ì ¸ì˜¤ê¸°     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚                   â”‚              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚
    3ï¸âƒ£ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”©
            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ContextBuilder Service                 â”‚
â”‚                                          â”‚
â”‚ âœ“ í« í”„ë¡œí•„ (ë‚˜ì´, í’ˆì¢…, ì„±ê²©)          â”‚
â”‚ âœ“ ìµœê·¼ ê±´ê°• ê¸°ë¡ (ì‹¬ë°•ìˆ˜, ì²­ì§„ ë°ì´í„°)  â”‚
â”‚ âœ“ ì˜ë£Œ ê¸°ë¡ (ë°±ì‹ , ì§ˆë³‘ ì´ë ¥)           â”‚
â”‚ âœ“ ì¼ê¸°/í–‰ë™ ë°ì´í„° (Kafkaì—ì„œ ìˆ˜ì‹ )     â”‚
â”‚ âœ“ ìœ ì € ì„ í˜¸ë„ (ì±—ë´‡ í†¤, ì–¸ì–´)           â”‚
â”‚                                          â”‚
â”‚ ê²°ê³¼: 500-2000 í† í° í¬ê¸°ì˜ í”„ë¡¬í”„íŠ¸   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â”‚ 4ï¸âƒ£ ìš”ì²­ ë¼ìš°íŒ…
    â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚                                  â”‚                             â”‚
 â–¼                                  â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ General Chatbot  â”‚      â”‚ Persona Chatbot  â”‚    â”‚ Health Analysis      â”‚
â”‚ (Haiku)          â”‚      â”‚ (Sonnet)         â”‚    â”‚ (Sonnet + Milvus)   â”‚
â”‚                  â”‚      â”‚                  â”‚    â”‚                      â”‚
â”‚ Prompt:          â”‚      â”‚ Prompt:          â”‚    â”‚ 1ï¸âƒ£ Query ì„ë² ë”©      â”‚
â”‚ "ë‹¹ì‹ ì€ 10ë…„    â”‚      â”‚ "ë‹¹ì‹ ì€ XXXë¼ëŠ” â”‚    â”‚ 2ï¸âƒ£ Milvus ê²€ìƒ‰      â”‚
â”‚  ê²½ë ¥ì˜ ìˆ˜ì˜ì‚¬  â”‚      â”‚  ì„±ê²©ì˜ ë°˜ë ¤ê²¬   â”‚    â”‚ 3ï¸âƒ£ ê´€ë ¨ ì˜ë£Œ ë¬¸ì„œ    â”‚
â”‚  ì…ë‹ˆë‹¤..."     â”‚      â”‚  ì…ë‹ˆë‹¤..."     â”‚    â”‚    ê°€ì ¸ì˜¤ê¸°           â”‚
â”‚                  â”‚      â”‚                  â”‚    â”‚ 4ï¸âƒ£ Sonnetë¡œ ë¶„ì„   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                         â”‚
         â”‚ 5ï¸âƒ£ AWS Bedrock API í˜¸ì¶œ                           â”‚
         â–¼                        â–¼                         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        AWS Bedrock Runtime                         â”‚
    â”‚  (claude-3-5-haiku-20241022)                       â”‚
    â”‚  (claude-3-5-sonnet-20241022)                      â”‚
    â”‚                                                    â”‚
    â”‚ âœ“ Token counting                                   â”‚
    â”‚ âœ“ Streaming response                               â”‚
    â”‚ âœ“ Max tokens: 2048                                 â”‚
    â”‚ âœ“ Temperature: 0.7 (ì°½ì˜ì„±)                        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 6ï¸âƒ£ AI ì‘ë‹µ ìˆ˜ì‹ 
         â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ResponseProcessor                â”‚
    â”‚                                    â”‚
    â”‚ âœ“ ë§ˆí¬ë‹¤ìš´ í¬ë§¤íŒ…                  â”‚
    â”‚ âœ“ ì‘ë‹µ ê²€ì¦ (ê¸¸ì´, í†¤)             â”‚
    â”‚ âœ“ ë©”íƒ€ë°ì´í„° ì¶”ê°€ (AI ëª¨ë¸, í† í°) â”‚
    â”‚ âœ“ ë¡œê¹… (ë¶„ì„/ê°œì„ ìš©)               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 7ï¸âƒ£ ì‘ë‹µ ì €ì¥ (Async)
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   ChatHistory Repository    â”‚
    â”‚                             â”‚
    â”‚ â€¢ ì‚¬ìš©ì ë©”ì‹œì§€            â”‚
    â”‚ â€¢ AI ì‘ë‹µ                   â”‚
    â”‚ â€¢ íƒ€ì„ìŠ¤íƒ¬í”„               â”‚
    â”‚ â€¢ ì‚¬ìš© í† í°                 â”‚
    â”‚ â€¢ ë¹„ìš©                      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚ 8ï¸âƒ£ ì‹¤ì‹œê°„ ì‘ë‹µ ì „ì†¡
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Frontend (WebSocket) â”‚
    â”‚   Healthcare Tab    â”‚
    â”‚   Chat Interface    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 3ï¸âƒ£ ì„œë¹„ìŠ¤ ë‚´ë¶€ êµ¬ì¡° (DDD ê¸°ë°˜)

### A. ë ˆì´ì–´ ì•„í‚¤í…ì²˜

```
healthcare_AIchatbot_service/
â”‚
â”œâ”€â”€ ğŸŒ Presentation Layer (Controller)
â”‚   â”œâ”€â”€ ChatController.java
â”‚   â”‚   â”œâ”€â”€ POST /api/healthcare/chat/general (ì¼ë°˜ ì±—ë´‡)
â”‚   â”‚   â”œâ”€â”€ POST /api/healthcare/chat/persona (í˜ë¥´ì†Œë‚˜ ì±—ë´‡)
â”‚   â”‚   â”œâ”€â”€ POST /api/healthcare/chat/health-analysis (ê±´ê°• ë¶„ì„)
â”‚   â”‚   â””â”€â”€ GET /api/healthcare/chat/history (ëŒ€í™” ì´ë ¥)
â”‚   â”‚
â”‚   â”œâ”€â”€ HealthRecordController.java
â”‚   â”‚   â”œâ”€â”€ GET /api/healthcare/records/pet/{petId}
â”‚   â”‚   â”œâ”€â”€ POST /api/healthcare/records/import/withapet
â”‚   â”‚   â””â”€â”€ POST /api/healthcare/records/{recordId}/summary
â”‚   â”‚
â”‚   â””â”€â”€ Avatar3DController.java
â”‚       â””â”€â”€ POST /api/healthcare/avatar/generate
â”‚
â”œâ”€â”€ ğŸ¢ Application Layer (Service - Use Case)
â”‚   â”œâ”€â”€ ClaudeService.java
â”‚   â”‚   â”œâ”€â”€ generateGeneralResponse() - Haiku ì‚¬ìš©
â”‚   â”‚   â”œâ”€â”€ generatePersonaResponse() - Sonnet ì‚¬ìš©
â”‚   â”‚   â”œâ”€â”€ analyzeHealthData() - RAG í†µí•© ë¶„ì„
â”‚   â”‚   â””â”€â”€ buildPrompt() - ì»¨í…ìŠ¤íŠ¸ ë¹Œë”©
â”‚   â”‚
â”‚   â”œâ”€â”€ ContextBuilderService.java
â”‚   â”‚   â”œâ”€â”€ buildPetContext() - í« í”„ë¡œí•„
â”‚   â”‚   â”œâ”€â”€ buildHealthContext() - ê±´ê°• ê¸°ë¡
â”‚   â”‚   â”œâ”€â”€ buildBehaviorContext() - í–‰ë™ ë°ì´í„°
â”‚   â”‚   â””â”€â”€ buildUserPreferencesContext() - ì‚¬ìš©ì ì„ í˜¸ë„
â”‚   â”‚
â”‚   â”œâ”€â”€ PersonaChatService.java
â”‚   â”‚   â”œâ”€â”€ generatePersonaPrompt() - í« ì„±ê²© í”„ë¡¬í”„íŠ¸
â”‚   â”‚   â””â”€â”€ enrichWithMemory() - ëŒ€í™” ê¸°ì–µ í†µí•©
â”‚   â”‚
â”‚   â”œâ”€â”€ HealthAnalysisService.java
â”‚   â”‚   â”œâ”€â”€ analyzePulseWaveform() - íŒŒí˜• ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ generateMedicalSummary() - ì˜ë£Œ ìš”ì•½
â”‚   â”‚   â””â”€â”€ detectAnomalies() - ì´ìƒ íƒì§€
â”‚   â”‚
â”‚   â”œâ”€â”€ Avatar3DGenerationService.java
â”‚   â”‚   â””â”€â”€ generate3DAvatar() - Tripo3D API í˜¸ì¶œ
â”‚   â”‚
â”‚   â”œâ”€â”€ KafkaConsumerService.java
â”‚   â”‚   â”œâ”€â”€ processDiaryEvent() - ì¼ê¸° ë°ì´í„° ìˆ˜ì‹ 
â”‚   â”‚   â””â”€â”€ processUserProfileEvent() - í”„ë¡œí•„ ë³€ê²½ ìˆ˜ì‹ 
â”‚   â”‚
â”‚   â””â”€â”€ WithaPetScraperService.java
â”‚       â”œâ”€â”€ scrapeReport() - WITHaPET ë¦¬í¬íŠ¸ ìˆ˜ì§‘
â”‚       â””â”€â”€ scrapeReportRange() - ë²”ìœ„ ìŠ¤í¬ë˜í•‘
â”‚
â”œâ”€â”€ ğŸ—„ï¸ Domain Layer (Domain Model)
â”‚   â”œâ”€â”€ Chat Aggregate
â”‚   â”‚   â”œâ”€â”€ Chat.java (aggregate root)
â”‚   â”‚   â”œâ”€â”€ ChatMessage.java
â”‚   â”‚   â”œâ”€â”€ ChatType.java (GENERAL, PERSONA, HEALTH_ANALYSIS)
â”‚   â”‚   â””â”€â”€ ChatHistory.java
â”‚   â”‚
â”‚   â”œâ”€â”€ HealthRecord Aggregate
â”‚   â”‚   â”œâ”€â”€ HeartHealthRecord.java
â”‚   â”‚   â”œâ”€â”€ HealthAnalysis.java
â”‚   â”‚   â””â”€â”€ HealthStatus.java
â”‚   â”‚
â”‚   â”œâ”€â”€ PetContext Aggregate
â”‚   â”‚   â”œâ”€â”€ PetProfile.java (user_serviceì—ì„œ ìºì‹œ)
â”‚   â”‚   â”œâ”€â”€ HealthHistory.java
â”‚   â”‚   â””â”€â”€ BehaviorData.java
â”‚   â”‚
â”‚   â””â”€â”€ Avatar Aggregate
â”‚       â”œâ”€â”€ Avatar3DTask.java
â”‚       â””â”€â”€ Avatar3DModel.java
â”‚
â”œâ”€â”€ ğŸ“Š Infrastructure Layer
â”‚   â”œâ”€â”€ Persistence
â”‚   â”‚   â”œâ”€â”€ ChatRepository.java (JPA)
â”‚   â”‚   â”œâ”€â”€ HealthRecordRepository.java (JPA)
â”‚   â”‚   â”œâ”€â”€ Avatar3DTaskRepository.java (JPA)
â”‚   â”‚   â””â”€â”€ ChatHistoryRepository.java (JPA)
â”‚   â”‚
â”‚   â”œâ”€â”€ External Integrations
â”‚   â”‚   â”œâ”€â”€ BedrockProperties.java
â”‚   â”‚   â”œâ”€â”€ ClaudeClient.java (AWS SDK)
â”‚   â”‚   â”œâ”€â”€ TripoApiClient.java (REST)
â”‚   â”‚   â””â”€â”€ WithaPetClient.java (Jsoup)
â”‚   â”‚
â”‚   â”œâ”€â”€ Event Streaming
â”‚   â”‚   â”œâ”€â”€ KafkaProducerConfig.java
â”‚   â”‚   â”œâ”€â”€ KafkaConsumerConfig.java
â”‚   â”‚   â”œâ”€â”€ HealthEventPublisher.java
â”‚   â”‚   â””â”€â”€ Topics:
â”‚   â”‚       â”œâ”€â”€ healthcare.chat-events
â”‚   â”‚       â”œâ”€â”€ healthcare.health-records
â”‚   â”‚       â””â”€â”€ healthcare.avatar-generated
â”‚   â”‚
â”‚   â”œâ”€â”€ Caching
â”‚   â”‚   â”œâ”€â”€ PetProfileCache.java
â”‚   â”‚   â”œâ”€â”€ HealthRecordCache.java
â”‚   â”‚   â””â”€â”€ @Cacheable ì ìš©
â”‚   â”‚
â”‚   â””â”€â”€ Monitoring
â”‚       â”œâ”€â”€ ChatMetrics.java
â”‚       â”œâ”€â”€ HealthRecordMetrics.java
â”‚       â””â”€â”€ Avatar3DMetrics.java
â”‚
â””â”€â”€ ğŸ”§ Configuration
    â”œâ”€â”€ BedrockConfig.java
    â”œâ”€â”€ KafkaConfig.java
    â”œâ”€â”€ RestTemplateConfig.java
    â”œâ”€â”€ CacheConfig.java
    â””â”€â”€ SchedulerConfig.java
```


***

## 4ï¸âƒ£ ë°ì´í„° êµ¬ì¡° ë° í”Œë¡œìš° ìƒì„¸ ì„¤ëª…

### A. ì±„íŒ… ë°ì´í„° í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       1ï¸âƒ£ ì‚¬ìš©ì ì…ë ¥ ë‹¨ê³„                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ìš”ì²­ ë°ì´í„°:                                                   â”‚
â”‚  {                                                               â”‚
â”‚    "userId": 123,                                               â”‚
â”‚    "petId": 456,                                                â”‚
â”‚    "chatType": "general",  // GENERAL, PERSONA, HEALTH_ANALYSIS â”‚
â”‚    "message": "ìš°ë¦¬ ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë° ê´œì°®ë‚˜ìš”?",          â”‚
â”‚    "includeContext": true                                        â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2ï¸âƒ£ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”© (ContextBuilder)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  a) PetProfile ì¡°íšŒ (Cache)                                    â”‚
â”‚     â””â”€ user_serviceì—ì„œ: {                                     â”‚
â”‚          "petId": 456,                                          â”‚
â”‚          "name": "ë½€ì‚",                                        â”‚
â”‚          "breed": "ë§í‹°ì¦ˆ",                                     â”‚
â”‚          "age": 5,                                              â”‚
â”‚          "weight": 3.5,                                         â”‚
â”‚          "personality": "í™œë°œí•¨, ì¹œí™”ì ",                      â”‚
â”‚          "medicalHistory": ["ë°±ì‹ ", "ì¤‘ì„±í™”"]                  â”‚
â”‚        }                                                         â”‚
â”‚                                                                  â”‚
â”‚  b) HealthHistory ì¡°íšŒ (DB)                                    â”‚
â”‚     â””â”€ ìµœê·¼ 3ê°œì›” ê±´ê°• ê¸°ë¡: {                                 â”‚
â”‚          "latestHeartRate": 95,                                 â”‚
â”‚          "normalRange": "75-110",                               â”‚
â”‚          "recentAnomalies": [],                                 â”‚
â”‚          "lastCheckDate": "2025-01-03"                          â”‚
â”‚        }                                                         â”‚
â”‚                                                                  â”‚
â”‚  c) BehaviorData ì¡°íšŒ (Kafka ì´ë²¤íŠ¸ ìºì‹œ)                      â”‚
â”‚     â””â”€ diary_serviceì—ì„œ: {                                    â”‚
â”‚          "activityLevel": "í™œë™ì ",                            â”‚
â”‚          "moodToday": "í¸ì•ˆí•¨",                                â”‚
â”‚          "eatingPattern": "ì •ìƒ",                              â”‚
â”‚          "sleepPattern": "8ì‹œê°„"                                â”‚
â”‚        }                                                         â”‚
â”‚                                                                  â”‚
â”‚  d) UserPreferences ì¡°íšŒ                                        â”‚
â”‚     â””â”€ {                                                        â”‚
â”‚          "language": "ko",                                      â”‚
â”‚          "responseLength": "medium",                            â”‚
â”‚          "expertiseLevel": "beginner",                          â”‚
â”‚          "preferredTone": "ì¹œì ˆí•˜ê³  ì „ë¬¸ì "                    â”‚
â”‚        }                                                         â”‚
â”‚                                                                  â”‚
â”‚  ì»¨í…ìŠ¤íŠ¸ í¬ê¸°: ~1200 í† í°                                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              3ï¸âƒ£ í”„ë¡¬í”„íŠ¸ ìƒì„± (PromptBuilder)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  GENERAL CHATBOT (Haikuìš©):                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ You are an experienced veterinarian (10 years).            â”‚ â”‚
â”‚  â”‚ You are now consulting with a dog owner about their pet.   â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ [PET CONTEXT]                                              â”‚ â”‚
â”‚  â”‚ Pet Name: ë½€ì‚ (Maltese, 5 years old, 3.5kg)              â”‚ â”‚
â”‚  â”‚ Personality: Active, friendly, sociable                    â”‚ â”‚
â”‚  â”‚ Medical History: Vaccinated, Neutered                      â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ [HEALTH CONTEXT]                                           â”‚ â”‚
â”‚  â”‚ Current Heart Rate: 95 bpm (Normal: 75-110)                â”‚ â”‚
â”‚  â”‚ Last Check: 2025-01-03                                     â”‚ â”‚
â”‚  â”‚ Recent Anomalies: None                                     â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ [BEHAVIOR CONTEXT]                                         â”‚ â”‚
â”‚  â”‚ Mood: Comfortable, Activity Level: Active                  â”‚ â”‚
â”‚  â”‚ Eating/Sleep: Normal                                       â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ [INSTRUCTIONS]                                             â”‚ â”‚
â”‚  â”‚ - Provide clear, concise medical advice                    â”‚ â”‚
â”‚  â”‚ - Consider all given context information                   â”‚ â”‚
â”‚  â”‚ - Ask clarifying questions if needed                       â”‚ â”‚
â”‚  â”‚ - Never recommend visiting a vet without strong reason     â”‚ â”‚
â”‚  â”‚ - Use Korean, professional but friendly tone              â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ Owner Question: ìš°ë¦¬ ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë° ê´œì°®ë‚˜ìš”?     â”‚ â”‚
â”‚  â”‚ Your Response:                                             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  PERSONA CHATBOT (Sonnetìš©):                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ You are ë½€ì‚ (Poppy), a 5-year-old Maltese dog.           â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ Personality: You are active, friendly, and sociable.       â”‚ â”‚
â”‚  â”‚ You love playing with your owner and meeting other dogs.   â”‚ â”‚
â”‚  â”‚ You are curious about everything around you.               â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ Today's Mood: You're feeling comfortable and relaxed.      â”‚ â”‚
â”‚  â”‚ You're enjoying a quiet afternoon indoors.                 â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ [HEALTH STATUS]                                            â”‚ â”‚
â”‚  â”‚ You're feeling healthy with a normal heart rate of 95 bpm. â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ Respond naturally as if you are ë½€ì‚ speaking to your      â”‚ â”‚
â”‚  â”‚ owner. Use informal Korean (ë°˜ë§/ì¹œê·¼í•œ í†¤).               â”‚ â”‚
â”‚  â”‚ Keep responses under 150 words.                             â”‚ â”‚
â”‚  â”‚                                                             â”‚ â”‚
â”‚  â”‚ Owner: "ìš°ë¦¬ ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë° ê´œì°®ë‚˜ìš”?"            â”‚ â”‚
â”‚  â”‚ Poppy's Response:                                          â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                  â”‚
â”‚  í”„ë¡¬í”„íŠ¸ í¬ê¸°: ~1500-1800 í† í°                                 â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              4ï¸âƒ£ AWS Bedrock API í˜¸ì¶œ                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ìš”ì²­:                                                          â”‚
â”‚  {                                                               â”‚
â”‚    "modelId": "anthropic.claude-3-5-haiku-20241022",           â”‚
â”‚    "contentType": "application/json",                           â”‚
â”‚    "accept": "application/json",                                â”‚
â”‚    "body": {                                                     â”‚
â”‚      "anthropic_version": "bedrock-2023-06-01",                 â”‚
â”‚      "max_tokens": 2048,                                        â”‚
â”‚      "system": "You are an experienced veterinarian...",        â”‚
â”‚      "messages": [                                              â”‚
â”‚        {                                                         â”‚
â”‚          "role": "user",                                        â”‚
â”‚          "content": "ìš°ë¦¬ ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë° ê´œì°®ë‚˜ìš”?"    â”‚
â”‚        }                                                         â”‚
â”‚      ],                                                         â”‚
â”‚      "temperature": 0.7,                                        â”‚
â”‚      "top_p": 0.9                                               â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  ì‘ë‹µ (Streaming):                                              â”‚
â”‚  {                                                               â”‚
â”‚    "type": "content_block_start",                               â”‚
â”‚    "index": 0,                                                  â”‚
â”‚    "content_block": {                                           â”‚
â”‚      "type": "text"                                             â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚  â†’ ... (í…ìŠ¤íŠ¸ ì²­í¬ ìŠ¤íŠ¸ë¦¬ë°) ...                              â”‚
â”‚  {                                                               â”‚
â”‚    "type": "content_block_delta",                               â”‚
â”‚    "index": 0,                                                  â”‚
â”‚    "delta": {                                                   â”‚
â”‚      "type": "text_delta",                                      â”‚
â”‚      "text": "ë½€ì‚ì˜ í˜„ì¬ ì‹¬ë°•ìˆ˜ëŠ” 95bpmìœ¼ë¡œ..."                â”‚
â”‚    }                                                             â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  ì²˜ë¦¬ ì‹œê°„: 200ms (Haiku) ~ 800ms (Sonnet)                     â”‚
â”‚  í† í° ì‚¬ìš©: 1800 ì…ë ¥ + 150 ì¶œë ¥ = 1950 í† í°                   â”‚
â”‚  ì˜ˆìƒ ë¹„ìš©: ~0.003-0.009ë‹¬ëŸ¬                                    â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              5ï¸âƒ£ ì‘ë‹µ ì²˜ë¦¬ (ResponseProcessor)                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  AI ì›ë³¸ ì‘ë‹µ:                                                  â”‚
â”‚  "ë½€ì‚ì˜ í˜„ì¬ ì‹¬ë°•ìˆ˜ëŠ” 95bpmìœ¼ë¡œ ì •ìƒ ë²”ìœ„(75-110bpm)       â”‚
â”‚   ë‚´ì— ìˆìŠµë‹ˆë‹¤. ê°•ì•„ì§€ê°€ í™œë™ì ì¸ ì„±ê²©ì´ë¼                  â”‚
â”‚   ì¡°ê¸ˆ ë†’ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤..."                                   â”‚
â”‚                                                                  â”‚
â”‚  ì²˜ë¦¬ ë‹¨ê³„:                                                      â”‚
â”‚  âœ“ ë§ˆí¬ë‹¤ìš´ í¬ë§¤íŒ… (ì œëª©, ë¦¬ìŠ¤íŠ¸ ë“±)                          â”‚
â”‚  âœ“ ì‘ë‹µ ê²€ì¦ (ê¸¸ì´, í†¤, ì¼ê´€ì„±)                               â”‚
â”‚  âœ“ ë©”íƒ€ë°ì´í„° ì¶”ê°€                                             â”‚
â”‚  âœ“ ì˜ë£Œ ë©´ì±… ì¡°í•­ ìë™ ì¶”ê°€ (í•„ìš”ì‹œ)                         â”‚
â”‚                                                                  â”‚
â”‚  ìµœì¢… ì‘ë‹µ:                                                      â”‚
â”‚  {                                                               â”‚
â”‚    "id": "chat_20250103_001",                                   â”‚
â”‚    "role": "assistant",                                         â”‚
â”‚    "chatType": "general",                                       â”‚
â”‚    "content": "ë½€ì‚ì˜ í˜„ì¬ ì‹¬ë°•ìˆ˜ëŠ” 95bpmìœ¼ë¡œ ì •ìƒ ë²”ìœ„...",  â”‚
â”‚    "model": {                                                   â”‚
â”‚      "name": "Claude 3.5 Haiku",                                â”‚
â”‚      "provider": "aws-bedrock"                                  â”‚
â”‚    },                                                           â”‚
â”‚    "tokens": {                                                  â”‚
â”‚      "input": 1800,                                             â”‚
â”‚      "output": 150,                                             â”‚
â”‚      "total": 1950                                              â”‚
â”‚    },                                                           â”‚
â”‚    "metadata": {                                                â”‚
â”‚      "responseTime": 200,  // milliseconds                      â”‚
â”‚      "confidence": 0.95,                                        â”‚
â”‚      "requiresFollowup": false,                                 â”‚
â”‚      "mentionsVetVisit": false                                  â”‚
â”‚    },                                                           â”‚
â”‚    "createdAt": "2025-01-03T10:30:00Z"                          â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              6ï¸âƒ£ ë°ì´í„° ì €ì¥ (Async - Kafka)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Topic: healthcare.chat-events                                  â”‚
â”‚  Partition: petId % 10                                          â”‚
â”‚  Key: userId_petId                                              â”‚
â”‚                                                                  â”‚
â”‚  ì´ë²¤íŠ¸:                                                        â”‚
â”‚  {                                                               â”‚
â”‚    "eventType": "chat_completed",                               â”‚
â”‚    "eventId": "evt_20250103_001",                               â”‚
â”‚    "userId": 123,                                               â”‚
â”‚    "petId": 456,                                                â”‚
â”‚    "chatId": "chat_20250103_001",                               â”‚
â”‚    "chatType": "general",                                       â”‚
â”‚    "messageCount": 1,                                           â”‚
â”‚    "tokensUsed": 1950,                                          â”‚
â”‚    "costInUsd": 0.006,                                          â”‚
â”‚    "timestamp": "2025-01-03T10:30:00Z"                          â”‚
â”‚  }                                                               â”‚
â”‚                                                                  â”‚
â”‚  DB ì €ì¥ (ChatRepository):                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ chats í…Œì´ë¸”                          â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ id: 1                                 â”‚                      â”‚
â”‚  â”‚ user_id: 123                          â”‚                      â”‚
â”‚  â”‚ pet_id: 456                           â”‚                      â”‚
â”‚  â”‚ chat_type: "GENERAL"                  â”‚                      â”‚
â”‚  â”‚ status: "COMPLETED"                   â”‚                      â”‚
â”‚  â”‚ created_at: 2025-01-03 10:30:00      â”‚                      â”‚
â”‚  â”‚ updated_at: 2025-01-03 10:30:02      â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚
â”‚  â”‚ chat_messages í…Œì´ë¸”                  â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ id: 1                                 â”‚                      â”‚
â”‚  â”‚ chat_id: 1                            â”‚                      â”‚
â”‚  â”‚ role: "user"                          â”‚                      â”‚
â”‚  â”‚ content: "ìš°ë¦¬ ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ê°€..."   â”‚                      â”‚
â”‚  â”‚ token_count: 50                       â”‚                      â”‚
â”‚  â”‚ sequence: 1                           â”‚                      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                      â”‚
â”‚  â”‚ id: 2                                 â”‚                      â”‚
â”‚  â”‚ chat_id: 1                            â”‚                      â”‚
â”‚  â”‚ role: "assistant"                     â”‚                      â”‚
â”‚  â”‚ content: "ë½€ì‚ì˜ í˜„ì¬ ì‹¬ë°•ìˆ˜ëŠ”..."   â”‚                      â”‚
â”‚  â”‚ model: "claude-3-5-haiku"             â”‚                      â”‚
â”‚  â”‚ token_count: 150                      â”‚                      â”‚
â”‚  â”‚ sequence: 2                           â”‚                      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              7ï¸âƒ£ WebSocket ì‹¤ì‹œê°„ ì „ì†¡                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  Frontend êµ¬ë… ì±„ë„: /user/userId/healthcare/chat               â”‚
â”‚                                                                  â”‚
â”‚  ì‹¤ì‹œê°„ ë©”ì‹œì§€ (ìŠ¤íŠ¸ë¦¬ë°):                                       â”‚
â”‚  Frame 1: {"type":"message_start","id":"..."}                   â”‚
â”‚  Frame 2: {"type":"content_block_start"}                        â”‚
â”‚  Frame 3: {"type":"content_block_delta","text":"ë½€ì‚ì˜"}        â”‚
â”‚  Frame 4: {"type":"content_block_delta","text":" í˜„ì¬"}         â”‚
â”‚  ...                                                             â”‚
â”‚  Frame N: {"type":"message_stop","id":"...","finalTokens":{...} â”‚
â”‚                                                                  â”‚
â”‚  Frontend UI ì—…ë°ì´íŠ¸:                                          â”‚
â”‚  ê° í”„ë ˆì„ë§ˆë‹¤ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‘ë‹µ í…ìŠ¤íŠ¸ê°€ í™”ë©´ì— í‘œì‹œë¨          â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 5ï¸âƒ£ ê±´ê°• ë°ì´í„° ë¶„ì„ í”Œë¡œìš° (Healthcare Analysis)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           WITHaPET ì²­ì§„ ë°ì´í„° â†’ ìˆ˜ì˜ì‚¬ ë¶„ì„ íë¦„              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1ï¸âƒ£: ë°ì´í„° ìˆ˜ì§‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  WithaPetScraperService.scrapeReport()  â”‚
â”‚                                         â”‚
â”‚  ì…ë ¥: P000004363                       â”‚
â”‚  â†“                                      â”‚
â”‚  Output: {                              â”‚
â”‚    reportId: "P000004363",              â”‚
â”‚    petName: "ë½€ì‚",                    â”‚
â”‚    heartRate: 95,                       â”‚
â”‚    recordedAt: "2025-01-03",            â”‚
â”‚    aiDiagnosis: "ì •ìƒ ë²”ìœ„",           â”‚
â”‚    audioFileUrl: "https://...",         â”‚
â”‚    waveformImageUrl: "https://..."      â”‚
â”‚  }                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 2ï¸âƒ£: ë°ì´í„° ì €ì¥ (HeartHealthRecord)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HeartHealthRecord Entity ìƒì„±        â”‚
â”‚                                      â”‚
â”‚ âœ“ petId ìë™ í• ë‹¹ (demoìš©)           â”‚
â”‚ âœ“ withaPetReportId ì €ì¥              â”‚
â”‚ âœ“ ì‹¬ë°•ìˆ˜, íŒŒí˜•, ì˜¤ë””ì˜¤ URL ì €ì¥      â”‚
â”‚ âœ“ ì´ìƒ ì—¬ë¶€ í”Œë˜ê·¸ ì„¤ì •              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 3ï¸âƒ£: AI ë¶„ì„ ìš”ì²­ (Sonnet)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HealthAnalysisService.analyzeHealthData() â”‚
â”‚                                            â”‚
â”‚  í”„ë¡¬í”„íŠ¸:                                  â”‚
â”‚  "ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ ìˆ˜ì˜ì‚¬ì…ë‹ˆë‹¤.           â”‚
â”‚   ë‹¤ìŒ ì²­ì§„ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”:        â”‚
â”‚                                            â”‚
â”‚   - ì‹¬ë°•ìˆ˜: 95 bpm                         â”‚
â”‚   - ì •ìƒ ë²”ìœ„: 75-110 bpm                  â”‚
â”‚   - íŒŒí˜•: [ì´ë¯¸ì§€]                        â”‚
â”‚   - ì˜¤ë””ì˜¤: [ì‹¬ì¥ìŒ ì¬ìƒ]                 â”‚
â”‚                                            â”‚
â”‚   ë¶„ì„ í•­ëª©:                                â”‚
â”‚   1. ì‹¬ë°•ìˆ˜ í‰ê°€                           â”‚
â”‚   2. ì£¼ì˜ì‚¬í•­                              â”‚
â”‚   3. ê¶Œì¥ ì¡°ì¹˜                             â”‚
â”‚   4. ë³‘ì› ë°©ë¬¸ í•„ìš”ì„±"                    â”‚
â”‚                                            â”‚
â”‚  â†’ Claude Sonnet ì²˜ë¦¬ (800ms)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 4ï¸âƒ£: ì‘ë‹µ ìƒì„± (ìµœì¢… ë¦¬í¬íŠ¸)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AiSummaryResponse {                 â”‚
â”‚    recordId: 1,                      â”‚
â”‚    summary: "ë½€ì‚ì˜ ì‹¬ë°•ìˆ˜ëŠ” 95bpm   â”‚
â”‚             ìœ¼ë¡œ ì •ìƒ ë²”ìœ„ ë‚´ì…ë‹ˆë‹¤.â”‚
â”‚             í™œë™ì ì¸ ì„±ê²©ì´ë¼ ì¡°ê¸ˆ  â”‚
â”‚             ë†’ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤...",   â”‚
â”‚    generatedAt: "2025-01-03T10:35"   â”‚
â”‚  }                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 5ï¸âƒ£: ì´ë²¤íŠ¸ ë°œí–‰ (Kafka)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Topic: healthcare.health-records       â”‚
â”‚  Event: {                              â”‚
â”‚    eventType: "health_analysis_complete"â”‚
â”‚    recordId: 1,                        â”‚
â”‚    petId: 456,                         â”‚
â”‚    hasAnomalies: false,                â”‚
â”‚    recommendedAction: "none",          â”‚
â”‚    summary: "..."                      â”‚
â”‚  }                                     â”‚
â”‚                                        â”‚
â”‚  â†’ Diary Service êµ¬ë…:                 â”‚
â”‚     ê±´ê°• ê¸°ë¡ì„ ì¼ê¸° ë¶„ì„ì— ë°˜ì˜      â”‚
â”‚  â†’ User Service êµ¬ë…:                  â”‚
â”‚     í«ì˜ ê±´ê°• ìƒíƒœ ì—…ë°ì´íŠ¸           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 6ï¸âƒ£ 3D ì•„ë°”íƒ€ ìƒì„± í”Œë¡œìš° (Tripo3D)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì ê°•ì•„ì§€ ì‚¬ì§„ â†’ 3D ëª¨ë¸ ìƒì„± í”„ë¡œì„¸ìŠ¤             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1ï¸âƒ£: ì‚¬ì§„ ì—…ë¡œë“œ & S3 ì €ì¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ìê°€ ê°•ì•„ì§€ ì‚¬ì§„ ì„ íƒ          â”‚
â”‚  â†“                                â”‚
â”‚  Frontend: POST /upload-pet-image   â”‚
â”‚  â†“                                â”‚
â”‚  S3 ì €ì¥: pet-images/{petId}/*.jpg  â”‚
â”‚  â†“                                â”‚
â”‚  ë°˜í™˜: imageUrl                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 2ï¸âƒ£: Tripo3D API ìš”ì²­
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Avatar3DGenerationService.         â”‚
â”‚  generate3DAvatar()                â”‚
â”‚                                    â”‚
â”‚  ìš”ì²­:                              â”‚
â”‚  {                                 â”‚
â”‚    type: "image_to_model",         â”‚
â”‚    file: {                         â”‚
â”‚      type: "url",                  â”‚
â”‚      file_url: "s3://...",         â”‚
â”‚    },                              â”‚
â”‚    options: {                      â”‚
â”‚      texture: true,                â”‚
â”‚      quad: true,                   â”‚
â”‚      face_limit: 50000,            â”‚
â”‚    }                               â”‚
â”‚  }                                 â”‚
â”‚                                    â”‚
â”‚  â†’ Tripo3D ì‘ë‹µ:                   â”‚
â”‚  {                                 â”‚
â”‚    taskId: "task_xyz",            â”‚
â”‚    status: "processing"            â”‚
â”‚  }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 3ï¸âƒ£: ë¹„ë™ê¸° í´ë§ (10ì´ˆë§ˆë‹¤)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  pollTripoTaskCompletion()         â”‚
â”‚                                    â”‚
â”‚  ë°˜ë³µ:                              â”‚
â”‚  â”œâ”€ GET /api/task/{taskId}         â”‚
â”‚  â”‚  status: "processing" (0~60ì´ˆ)   â”‚
â”‚  â”‚  status: "success" (ì™„ë£Œ!)       â”‚
â”‚  â”‚                                  â”‚
â”‚  â”‚  ë˜ëŠ”                             â”‚
â”‚  â”‚  status: "failed" (ì‹¤íŒ¨)         â”‚
â”‚  â”‚                                  â”‚
â”‚  â””â”€ 10ì´ˆ ëŒ€ê¸° í›„ ì¬ì‹œë„             â”‚
â”‚                                    â”‚
â”‚  ìµœëŒ€ ëŒ€ê¸°: 2ë¶„                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 4ï¸âƒ£: 3D ëª¨ë¸ ë‹¤ìš´ë¡œë“œ & S3 ì €ì¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GLB íŒŒì¼ ë‹¤ìš´ë¡œë“œ                  â”‚
â”‚  â†“                                â”‚
â”‚  S3 ì €ì¥: pet-avatars/{petId}.glb   â”‚
â”‚  â†“                                â”‚
â”‚  CloudFront CDN ë“±ë¡                â”‚
â”‚  â†“                                â”‚
â”‚  ë°˜í™˜: 3dModelUrl                  â”‚
â”‚                                    â”‚
â”‚  ì˜ˆ: https://d3uvkb1qxxcp2y       â”‚
â”‚      .cloudfront.net/avatars/      â”‚
â”‚      456.glb                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 5ï¸âƒ£: ë°ì´í„°ë² ì´ìŠ¤ ì €ì¥
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Avatar3DTask Entity:              â”‚
â”‚  {                                 â”‚
â”‚    petId: 456,                     â”‚
â”‚    taskId: "task_xyz",             â”‚
â”‚    status: "COMPLETED",            â”‚
â”‚    model3dUrl: "s3://...",        â”‚
â”‚    completedAt: "2025-01-03"       â”‚
â”‚  }                                 â”‚
â”‚                                    â”‚
â”‚  Kafka ì´ë²¤íŠ¸:                     â”‚
â”‚  {                                 â”‚
â”‚    eventType: "avatar_generated",  â”‚
â”‚    petId: 456,                     â”‚
â”‚    model3dUrl: "...",              â”‚
â”‚    generatedAt: "..."              â”‚
â”‚  }                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Step 6ï¸âƒ£: Frontend ë Œë”ë§ (Three.js)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Healthcare Tabì˜ Persona Chatbot   â”‚
â”‚  ì˜†ì— 3D ì•„ë°”íƒ€ í‘œì‹œ               â”‚
â”‚                                    â”‚
â”‚  íŠ¹ì§•:                              â”‚
â”‚  âœ“ íšŒì „ ê°€ëŠ¥ (ë§ˆìš°ìŠ¤ ë“œë˜ê·¸)       â”‚
â”‚  âœ“ ì¤Œ ì¸/ì•„ì›ƒ (ìŠ¤í¬ë¡¤)             â”‚
â”‚  âœ“ ë¼ì´íŒ… íš¨ê³¼ (í˜„ì‹¤ê°)            â”‚
â”‚  âœ“ ì„±ëŠ¥ ìµœì í™” (LOD)               â”‚
â”‚                                    â”‚
â”‚  â†’ í˜ë¥´ì†Œë‚˜ ì±—ë´‡ê³¼ í•¨ê»˜ í‘œì‹œ       â”‚
â”‚  â†’ í«ì´ ë§í•˜ëŠ” ê²ƒ ì²˜ëŸ¼ í‘œí˜„        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 7ï¸âƒ£ Kafka ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹ 

### A. ë°œí–‰í•˜ëŠ” ì´ë²¤íŠ¸

```
healthcare_AIchatbot_serviceì—ì„œ ë°œí–‰:

1ï¸âƒ£ healthcare.chat-events
   â”œâ”€ chat_initiated
   â”œâ”€ chat_completed
   â”œâ”€ chat_error
   â””â”€ persona_conversation_recorded

2ï¸âƒ£ healthcare.health-records
   â”œâ”€ health_record_created
   â”œâ”€ health_analysis_complete
   â”œâ”€ anomaly_detected
   â””â”€ withapet_data_imported

3ï¸âƒ£ healthcare.avatar-generated
   â””â”€ avatar_3d_completed

4ï¸âƒ£ healthcare.metrics
   â”œâ”€ daily_chat_metrics
   â””â”€ model_usage_metrics
```


### B. êµ¬ë…í•˜ëŠ” ì´ë²¤íŠ¸

```
diary_serviceë¡œë¶€í„°:
â”œâ”€ diary.created
â”œâ”€ diary.updated
â””â”€ diary.mood_recorded
   â†’ í–‰ë™ ë°ì´í„°ë¡œ í™œìš© (ContextBuilder)

user_serviceë¡œë¶€í„°:
â”œâ”€ user.profile_updated
â”œâ”€ pet.profile_updated
â””â”€ pet.deleted
   â†’ í« ì •ë³´ ìºì‹œ ì—…ë°ì´íŠ¸

ì´ë²¤íŠ¸ ì²˜ë¦¬:
@KafkaListener(topics = "diary.created")
public void processDiaryEvent(DiaryCreatedEvent event) {
    // í–‰ë™ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ ìºì‹œì— ì €ì¥
    behaviorCache.put(event.getPetId(), event);
    
    // ìë™ìœ¼ë¡œ ë‹¤ìŒ ì±„íŒ…ì—ì„œ í™œìš©ë¨
}
```


***

## 8ï¸âƒ£ RAG í†µí•© ì•„í‚¤í…ì²˜ (ë¯¸ë˜ ë‹¨ê³„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RAG (Retrieval Augmented Generation)               â”‚
â”‚  í˜„ì¬: í”„ë¡¬í”„íŠ¸ì— ì»¨í…ìŠ¤íŠ¸ ì„ë² ë”©                  â”‚
â”‚  ë¯¸ë˜: Milvus ë²¡í„° DB ê¸°ë°˜ ê³ ê¸‰ ê²€ìƒ‰               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Phase 1 (í˜„ì¬): Basic Context Embedding
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ System Prompt +                  â”‚
â”‚ Pet Context (í…ìŠ¤íŠ¸) +           â”‚
â”‚ Health Records (êµ¬ì¡°í™”ë¨) +       â”‚
â”‚ User Message                     â”‚
â”‚ = í”„ë¡¬í”„íŠ¸ ì™„ì„±                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Phase 2 (ë¯¸ë˜): Vector DB RAG
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Milvus Vector Database           â”‚
â”‚                                  â”‚
â”‚ Collection 1: Veterinary Knowledge
â”‚  â””â”€ ì˜ë£Œ ë¬¸ì„œ ì„ë² ë”©:            â”‚
â”‚     "ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ ì •ìƒ ë²”ìœ„...",â”‚
â”‚     "ì‹¬ì¥ìŒ íŒŒí˜• ë¶„ì„...",        â”‚
â”‚     ...                          â”‚
â”‚                                  â”‚
â”‚ Collection 2: User Pet Profiles   â”‚
â”‚  â””â”€ í« ì •ë³´ ì„ë² ë”©:             â”‚
â”‚     "ë½€ì‚: ë§í‹°ì¦ˆ 5ì„¸...",      â”‚
â”‚     "ì¬ë¡± ë– ëŠ” ì„±ê²©...",         â”‚
â”‚     ...                          â”‚
â”‚                                  â”‚
â”‚ Collection 3: Health History      â”‚
â”‚  â””â”€ ê±´ê°• ê¸°ë¡ ì„ë² ë”©:            â”‚
â”‚     "2025-01-03: ì‹¬ë°•ìˆ˜ 95",    â”‚
â”‚     "2025-01-01: ê±´ê°• ì²´í¬",    â”‚
â”‚     ...                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â–²           â–²
        â”‚           â”‚
  Query Embedding  Similarity Search
        â”‚           â”‚
        â–¼           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì‚¬ìš©ì ì§ˆë¬¸:                      â”‚
â”‚ "ìš°ë¦¬ ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë°..."  â”‚
â”‚ â†“                               â”‚
â”‚ ì„ë² ë”© ë³€í™˜ + ë²¡í„°í™”             â”‚
â”‚ â†“                               â”‚
â”‚ Milvusì—ì„œ ìœ ì‚¬ë„ ê²€ìƒ‰           â”‚
â”‚ Top-K (5-10) ë¬¸ì„œ ë°˜í™˜           â”‚
â”‚                                  â”‚
â”‚ ê²€ìƒ‰ ê²°ê³¼:                        â”‚
â”‚ 1. "ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ ì •ìƒ ë²”ìœ„..." â”‚
â”‚ 2. "í™œë™ì  ê°•ì•„ì§€ì˜ ì‹¬ë°•ìˆ˜..." â”‚
â”‚ 3. "ì‹¬ë°•ìˆ˜ ìƒìŠ¹ ì›ì¸..." â”‚
â”‚ 4. "ì–¸ì œ ë³‘ì› ë°©ë¬¸í•´ì•¼..." â”‚
â”‚ 5. "ë½€ì‚ ê³¼ê±° ê±´ê°•ê¸°ë¡..." â”‚
â”‚                                  â”‚
â”‚ â†’ ì´ ë¬¸ì„œë“¤ì„ í”„ë¡¬í”„íŠ¸ì— ì¶”ê°€     â”‚
â”‚ â†’ Claudeê°€ ë”ìš± ì •í™•í•œ ë‹µë³€ ìƒì„±  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 9ï¸âƒ£ ì„±ëŠ¥ ìµœì í™” ë° ëª¨ë‹ˆí„°ë§

### A. ìºì‹± ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ìºì‹± ê³„ì¸µ                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  1ï¸âƒ£ L1 Cache (ë©”ëª¨ë¦¬ - 5ë¶„)             â”‚
â”‚     â”œâ”€ PetProfile (ìì£¼ ì¡°íšŒ)           â”‚
â”‚     â”œâ”€ HealthStatus (ìµœì‹  ê¸°ë¡)         â”‚
â”‚     â””â”€ ChatHistory (ìµœê·¼ ëŒ€í™”)          â”‚
â”‚     ì „ëµ: @Cacheable + TTL              â”‚
â”‚                                          â”‚
â”‚  2ï¸âƒ£ L2 Cache (Redis - 1ì‹œê°„)           â”‚
â”‚     â”œâ”€ ContextBuilder ê²°ê³¼             â”‚
â”‚     â”œâ”€ User Preferences                 â”‚
â”‚     â””â”€ Behavior Summary                 â”‚
â”‚     ì „ëµ: RedisTemplate + ë§Œë£Œ ì„¤ì •    â”‚
â”‚                                          â”‚
â”‚  3ï¸âƒ£ DB Query ìµœì í™”                    â”‚
â”‚     â”œâ”€ ì¸ë±ìŠ¤: petId, userId, createdAt â”‚
â”‚     â”œâ”€ Pagination: ê¸°ë³¸ 10ê°œ           â”‚
â”‚     â””â”€ ë°°ì¹˜ ì¿¼ë¦¬: N+1 í•´ê²°              â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### B. ëª¨ë‹ˆí„°ë§ ë©”íŠ¸ë¦­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Prometheus ë©”íŠ¸ë¦­                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚  1ï¸âƒ£ API ì‘ë‹µ ì‹œê°„                 â”‚
â”‚     healthcare_chat_duration_ms    â”‚
â”‚     â”œâ”€ General: 200-400ms          â”‚
â”‚     â”œâ”€ Persona: 800-1200ms         â”‚
â”‚     â””â”€ HealthAnalysis: 1000-2000ms â”‚
â”‚                                    â”‚
â”‚  2ï¸âƒ£ í† í° ì‚¬ìš©ëŸ‰                    â”‚
â”‚     bedrock_tokens_used_total      â”‚
â”‚     â”œâ”€ Input tokens                â”‚
â”‚     â”œâ”€ Output tokens               â”‚
â”‚     â””â”€ Daily cost tracking          â”‚
â”‚                                    â”‚
â”‚  3ï¸âƒ£ ì—ëŸ¬ìœ¨                         â”‚
â”‚     healthcare_errors_total        â”‚
â”‚     â”œâ”€ API errors                  â”‚
â”‚     â”œâ”€ Parsing errors              â”‚
â”‚     â””â”€ Context building errors     â”‚
â”‚                                    â”‚
â”‚  4ï¸âƒ£ í™œë™ëŸ‰                         â”‚
â”‚     healthcare_chat_total          â”‚
â”‚     â”œâ”€ ì±„íŒ… ìˆ˜                     â”‚
â”‚     â”œâ”€ í™œì„± ì‚¬ìš©ì                 â”‚
â”‚     â””â”€ í«ë‹¹ í‰ê·  ëŒ€í™”              â”‚
â”‚                                    â”‚
â”‚  Grafana ëŒ€ì‹œë³´ë“œ ì„¤ì • í•„ìš”        â”‚
â”‚                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## ğŸ”Ÿ ì „ì²´ ì„œë¹„ìŠ¤ ë°°í¬ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë°°í¬ ë‹¤ì´ì–´ê·¸ë¨                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  Local Development (Spring Boot 8085)                   â”‚
â”‚  â”œâ”€ application-dev.yml                                â”‚
â”‚  â”‚  â”œâ”€ AWS Bedrock ì„¤ì •                                â”‚
â”‚  â”‚  â”œâ”€ Kafka ë¡œì»¬ ì„¤ì •                                 â”‚
â”‚  â”‚  â”œâ”€ PostgreSQL ë¡œì»¬                                 â”‚
â”‚  â”‚  â””â”€ S3 AWS ê³„ì •                                     â”‚
â”‚  â”‚                                                     â”‚
â”‚  â””â”€ Docker Compose (ê°œë°œìš©)                            â”‚
â”‚     â”œâ”€ kafka:latest                                     â”‚
â”‚     â”œâ”€ postgres:15                                      â”‚
â”‚     â”œâ”€ redis:7                                          â”‚
â”‚     â””â”€ localstack (S3 ëª¨ì˜)                            â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                          â”‚
â”‚  Staging (AWS EKS)                                     â”‚
â”‚  â”œâ”€ Deployment: healthcare-service                     â”‚
â”‚  â”‚  â”œâ”€ 2 replicas                                      â”‚
â”‚  â”‚  â”œâ”€ Resource: 512Mi RAM, 250m CPU                   â”‚
â”‚  â”‚  â””â”€ Liveness/Readiness probe                        â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Service: NodePort 8085                             â”‚
â”‚  â”œâ”€ ConfigMap: ì„¤ì • íŒŒì¼                              â”‚
â”‚  â”œâ”€ Secret: AWS í‚¤, ë°ì´í„°ë² ì´ìŠ¤                       â”‚
â”‚  â””â”€ PVC: ë¡œê·¸ ì €ì¥                                    â”‚
â”‚                                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                          â”‚
â”‚  Production (AWS EKS)                                  â”‚
â”‚  â”œâ”€ Deployment: healthcare-service                     â”‚
â”‚  â”‚  â”œâ”€ 3 replicas (HA)                                 â”‚
â”‚  â”‚  â”œâ”€ Resource: 1Gi RAM, 500m CPU                     â”‚
â”‚  â”‚  â”œâ”€ Auto-scaling: 2-6 pods                          â”‚
â”‚  â”‚  â””â”€ Health checks + graceful shutdown               â”‚
â”‚  â”‚                                                     â”‚
â”‚  â”œâ”€ Service: ClusterIP (ë‚´ë¶€)                          â”‚
â”‚  â”œâ”€ Ingress: API Gatewayì™€ ì—°ë™                        â”‚
â”‚  â”œâ”€ HPA: CPU >70% ì‹œ í™•ì¥                              â”‚
â”‚  â””â”€ Monitoring: Prometheus + Grafana                   â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## 1ï¸âƒ£1ï¸âƒ£ í˜„ì¬ êµ¬í˜„ ìƒíƒœ ë° ë‹¤ìŒ ë‹¨ê³„

### A. âœ… ì™„ë£Œëœ ê¸°ëŠ¥

```
Sprint 1-2 (í˜„ì¬):
âœ… AWS Bedrock Claude 3.5 Haiku/Sonnet í†µí•©
âœ… ì¼ë°˜ ìˆ˜ì˜ì‚¬ ì±—ë´‡ (General Chatbot)
âœ… ê¸°ë³¸ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”© (PetProfile, HealthHistory)
âœ… ì±„íŒ… ì´ë ¥ ì €ì¥ (PostgreSQL)
âœ… Kafka ê¸°ë³¸ ì„¤ì •
âœ… WITHaPET ì²­ì§„ ë°ì´í„° ìŠ¤í¬ë˜í•‘
âœ… Tripo3D 3D ì•„ë°”íƒ€ ìƒì„±
âœ… Frontend Healthcare ëŒ€ì‹œë³´ë“œ UI
```


### B. ğŸš€ ì§„í–‰ ì¤‘ì¸ ê¸°ëŠ¥

```
Sprint 3 (1ì›” ë§):
ğŸ”„ í˜ë¥´ì†Œë‚˜ ì±—ë´‡ ê³ ë„í™”
   â””â”€ í« ì„±ê²© ì„ë² ë”©
   â””â”€ ëŒ€í™” ê¸°ì–µ (conversation memory)
   â””â”€ 3D ì•„ë°”íƒ€ ì—°ë™

ğŸ”„ ê±´ê°• ë°ì´í„° ë¶„ì„ ê³ ë„í™”
   â””â”€ WITHaPET ìë™ ìŠ¤í¬ë˜í•‘ ìŠ¤ì¼€ì¤„ëŸ¬
   â””â”€ AI ìš”ì•½ ë¦¬í¬íŠ¸ ìë™ ìƒì„±
   â””â”€ ì´ìƒ íƒì§€ ì•Œë¦¼ ì‹œìŠ¤í…œ

ğŸ”„ Kafka ì™„ì „ í†µí•©
   â””â”€ diary_service ì—°ë™
   â””â”€ user_service ì—°ë™
   â””â”€ social_service ì—°ë™
```


### C. ğŸ“‹ í–¥í›„ ê³„íš

```
Sprint 4 (2ì›”):
ğŸ“… Milvus ë²¡í„° DB ë„ì… (RAG)
   â””â”€ ì˜ë£Œ ì§€ì‹ ë² ì´ìŠ¤ êµ¬ì¶•
   â””â”€ í« í”„ë¡œí•„ ë²¡í„°í™”
   â””â”€ ìœ ì‚¬ ì¼€ì´ìŠ¤ ê²€ìƒ‰

ğŸ“… ë©€í‹°ëª¨ë‹¬ AI í†µí•©
   â””â”€ ì´ë¯¸ì§€ ë¶„ì„ (ê°•ì•„ì§€ ìƒíƒœ)
   â””â”€ ìŒì„± ì…ë ¥ (ChatBot)
   â””â”€ ì‹¬ì¥ìŒ íŒŒí˜• ë¶„ì„

ğŸ“… ê³ ê¸‰ ë¶„ì„ ê¸°ëŠ¥
   â””â”€ ê±´ê°• íŠ¸ë Œë“œ ë¶„ì„
   â””â”€ ì˜ˆë°©ì§„ë£Œ ì¶”ì²œ
   â””â”€ ë°±ì‹  ì¼ì • ê´€ë¦¬

Sprint 5 (3ì›”):
ğŸ“… ì„±ëŠ¥ ìµœì í™”
   â””â”€ ì‘ë‹µ ì‹œê°„ <300ms
   â””â”€ ë™ì‹œ ì‚¬ìš©ì 1000+
   â””â”€ ë¹„ìš© ìµœì í™”

ğŸ“… ë³´ì•ˆ ê°•í™”
   â””â”€ ì˜ë£Œ ë°ì´í„° ì•”í˜¸í™”
   â””â”€ HIPAA ì¤€ìˆ˜
   â””â”€ ì ‘ê·¼ ì œì–´
```


***

## 1ï¸âƒ£2ï¸âƒ£ Git ì»¤ë°‹ ë° PR ì „ëµ

### ëª¨ë“  ê¸°ëŠ¥ë³„ ì»¤ë°‹ êµ¬ì¡°

```bash
# Feature branch ìƒì„±
git checkout -b feat/healthcare-feature-name

# ì»¤ë°‹ ì‹œ í•­ìƒ ì´ êµ¬ì¡° ë”°ë¦„
[Type]: ì œëª© (50ì ì´ë‚´)

- ìƒì„¸ ì„¤ëª…
- ê¸°ìˆ  ì„ íƒ ì´ìœ  (WHY)
- ì˜í–¥ë²”ìœ„

Issue: #XXX

# ì˜ˆì‹œ
[Feat]: í˜ë¥´ì†Œë‚˜ ì±—ë´‡ ë©”ëª¨ë¦¬ í†µí•©

- PersonaChatServiceì— conversation memory ì¶”ê°€
- LangChain4jì˜ MessageWindowMemory ì‚¬ìš©
- ìµœê·¼ 5ê°œ ë©”ì‹œì§€ë§Œ ìœ ì§€í•˜ì—¬ í† í° ì ˆì•½

WHY: Claude Sonnetìœ¼ë¡œ ì¥ê¸° ëŒ€í™” ì‹œ í† í° ëˆ„ì 
     ë©”ëª¨ë¦¬ ì œí•œìœ¼ë¡œ ì»¨í…ìŠ¤íŠ¸ ì†ì‹¤ ë°©ì§€

Issue: #15
```


***

ì´ì œ **ë‹¹ì‹ ì˜ Healthcare AI Chatbot Service ì „ì²´ êµ¬ì¡°**ë¥¼ ì™„ë²½í•˜ê²Œ ì´í•´í•˜ì…¨ì„ ê²ƒì…ë‹ˆë‹¤!

## ğŸ“Œ í•µì‹¬ ìš”ì•½

| ì˜ì—­ | ê¸°ìˆ  | ëª©ì  |
| :-- | :-- | :-- |
| **AI ëª¨ë¸** | Claude 3.5 (Haiku+Sonnet) | ì¼ë°˜/í˜ë¥´ì†Œë‚˜ ì±—ë´‡ |
| **ë°ì´í„° ìˆ˜ì§‘** | WITHaPET ìŠ¤í¬ë˜í•‘ | ì‹¤ì œ ì²­ì§„ ë°ì´í„° |
| **3D ì•„ë°”íƒ€** | Tripo3D API | í« ì‹œê°í™” |
| **ì´ë²¤íŠ¸ ê¸°ë°˜** | Kafka | ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ í†µì‹  |
| **ë²¡í„° DB** | Milvus (ë¯¸ë˜) | RAG ê³ ê¸‰ ê²€ìƒ‰ |
| **ë°°í¬** | EKS + Docker | í”„ë¡œë•ì…˜ ìš´ì˜ |

**ë‹¤ìŒ ë‹¨ê³„ëŠ”?**

1. í˜„ì¬ êµ¬í˜„ ìƒíƒœ í™•ì¸í•˜ê¸°
2. Frontend ëŒ€ì‹œë³´ë“œ ë””ìì¸ ê²€ì¦
3. í˜ë¥´ì†Œë‚˜ ì±—ë´‡ ê³ ë„í™” ì‹œì‘
4. Kafka ë©”ì‹œì§€ í¬ë§· í‘œì¤€í™”

ê¶ê¸ˆí•œ ë¶€ë¶„ì´ ìˆìœ¼ë©´ ì–¸ì œë“  ë¬¼ì–´ë´ì£¼ì„¸ìš”! ğŸš€
<span style="display:none">[^8_1][^8_2][^8_3][^8_4][^8_5][^8_6][^8_7][^8_8][^8_9]</span>

<div align="center">â‚</div>

[^8_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^8_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^8_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^8_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^8_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^8_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^8_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^8_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^8_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg


---

# ê³ ë§ˆì›Œ ê·¼ë° í˜¹ì‹œ ë”± AI ë¶€ë¶„ì˜ ì•„í‚¤í…ì³ë¥¼ ì •ë¦¬í•´ì¤„ ìˆ˜ ìˆì–´? ëª¨ë“  ë°ì´í„°ë“¤ì„ ì •ë¦¬ì•ˆí•´ë„ë˜ê³  ë”± AI ë§Œ

ì™„ë²½í•©ë‹ˆë‹¤! ì´ì œ AI ë¶€ë¶„ë§Œ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

***

# ğŸ¤– Healthcare AI Chatbot Service - AI ì•„í‚¤í…ì²˜ë§Œ

chart:82

***

## ğŸ“Š AI ì•„í‚¤í…ì²˜ ìƒì„¸ ì„¤ëª…

### 1ï¸âƒ£ ì…ë ¥ ì²˜ë¦¬ (Input Layer)

```
ì‚¬ìš©ì ìš”ì²­
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatController                  â”‚
â”‚  POST /api/healthcare/chat       â”‚
â”‚                                  â”‚
â”‚  ìš”ì²­ ë°ì´í„°:                      â”‚
â”‚  {                               â”‚
â”‚    userId: 123,                  â”‚
â”‚    petId: 456,                   â”‚
â”‚    chatType: "general",          â”‚
â”‚    message: "ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë°?"    â”‚
â”‚  }                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ChatTypeClassifier              â”‚
â”‚                                  â”‚
â”‚  âœ“ GENERAL â†’ Haiku              â”‚
â”‚  âœ“ PERSONA â†’ Sonnet             â”‚
â”‚  âœ“ HEALTH_ANALYSIS â†’ Sonnet+RAG â”‚
â”‚                                  â”‚
â”‚  ì‘ë‹µ ì‹œê°„: <50ms                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 2ï¸âƒ£ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”© (Context Building Layer)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            ContextBuilderService                      â”‚
â”‚                                                       â”‚
â”‚  ì—¬ëŸ¬ ì†ŒìŠ¤ì—ì„œ ì»¨í…ìŠ¤íŠ¸ ìˆ˜ì§‘ & ë³‘í•©                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  1ï¸âƒ£ Pet Profile (from user_service cache)           â”‚
â”‚     â””â”€ name, breed, age, weight, personality        â”‚
â”‚     ìš”ì²­: 50-100 í† í°                                â”‚
â”‚                                                       â”‚
â”‚  2ï¸âƒ£ Health History (from DB - ìµœê·¼ 3ê°œì›”)           â”‚
â”‚     â””â”€ heartRate, anomalies, lastCheckDate          â”‚
â”‚     ìš”ì²­: 150-300 í† í°                               â”‚
â”‚                                                       â”‚
â”‚  3ï¸âƒ£ Behavior Context (from Kafka cache)             â”‚
â”‚     â””â”€ mood, activityLevel, eatingPattern           â”‚
â”‚     ìš”ì²­: 100-150 í† í°                               â”‚
â”‚                                                       â”‚
â”‚  4ï¸âƒ£ User Preferences (from DB)                      â”‚
â”‚     â””â”€ language, tonePreference, expertiseLevel     â”‚
â”‚     ìš”ì²­: 50-100 í† í°                                â”‚
â”‚                                                       â”‚
â”‚  ğŸ“Š ì´ ì»¨í…ìŠ¤íŠ¸ í¬ê¸°: 350-650 í† í°                   â”‚
â”‚     (ìµœëŒ€: 1000 í† í°)                                â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 3ï¸âƒ£ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§ (Prompt Engineering)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           PromptBuilder Service                     â”‚
â”‚                                                     â”‚
â”‚  3ê°€ì§€ í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                     â”‚
â”‚  ğŸ”· GENERAL CHATBOT PROMPT (Haikuìš©)               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  System Prompt:                                     â”‚
â”‚  "ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ìˆ˜ì˜ì‚¬ì…ë‹ˆë‹¤.                â”‚
â”‚   ê°•ì•„ì§€ ì£¼ì¸ê³¼ ìƒë‹´ ì¤‘ì…ë‹ˆë‹¤.                     â”‚
â”‚   ëª…í™•í•˜ê³  ì •í™•í•œ ì¡°ì–¸ì„ ì œê³µí•˜ì„¸ìš”.               â”‚
â”‚   í•œêµ­ì–´ë¡œ ì¹œì ˆí•˜ê³  ì „ë¬¸ì ì¸ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”."    â”‚
â”‚                                                     â”‚
â”‚  Context Block:                                     â”‚
â”‚  [PET PROFILE]                                      â”‚
â”‚  ì´ë¦„: ë½€ì‚ (ë§í‹°ì¦ˆ, 5ì„¸, 3.5kg)                   â”‚
â”‚  ì„±ê²©: í™œë°œí•¨, ì¹œí™”ì                               â”‚
â”‚  ì˜ë£Œ ì´ë ¥: ë°±ì‹ , ì¤‘ì„±í™”                           â”‚
â”‚                                                     â”‚
â”‚  [HEALTH STATUS]                                    â”‚
â”‚  í˜„ì¬ ì‹¬ë°•ìˆ˜: 95 bpm (ì •ìƒ: 75-110)                â”‚
â”‚  ìµœê·¼ ì´ìƒ: ì—†ìŒ                                    â”‚
â”‚                                                     â”‚
â”‚  [BEHAVIORAL STATUS]                                â”‚
â”‚  ê¸°ë¶„: í¸ì•ˆí•¨, í™œë™ ìˆ˜ì¤€: í™œë™ì                     â”‚
â”‚  ì‹ì‚¬/ìˆ˜ë©´: ì •ìƒ                                    â”‚
â”‚                                                     â”‚
â”‚  í”„ë¡¬í”„íŠ¸ í¬ê¸°: 1200-1500 í† í°                      â”‚
â”‚                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚                                                     â”‚
â”‚  ğŸ”µ PERSONA CHATBOT PROMPT (Sonnetìš©)              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  System Prompt:                                     â”‚
â”‚  "ë‹¹ì‹ ì€ ë½€ì‚(5ì„¸ ë§í‹°ì¦ˆ)ì…ë‹ˆë‹¤.                   â”‚
â”‚   í™œë°œí•˜ê³  ì¹œí™”ì ì¸ ì„±ê²©ì…ë‹ˆë‹¤.                     â”‚
â”‚   ë‹¹ì‹ ì˜ ì£¼ì¸ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•˜ì„¸ìš”.              â”‚
â”‚   ë°˜ë§ë¡œ ì¹œê·¼í•œ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”.                    â”‚
â”‚   150ë‹¨ì–´ ì´ë‚´ë¡œ ë‹µë³€í•˜ì„¸ìš”."                      â”‚
â”‚                                                     â”‚
â”‚  Context Block:                                     â”‚
â”‚  [MY PERSONALITY]                                   â”‚
â”‚  í™œë°œí•¨, ì¹œí™”ì , í˜¸ê¸°ì‹¬ ë§ìŒ                        â”‚
â”‚  ë†€ì´ì™€ ë‹¤ë¥¸ ê°•ì•„ì§€ ë§Œë‚˜ê¸° ì¢‹ì•„í•¨                   â”‚
â”‚                                                     â”‚
â”‚  [TODAY'S MOOD]                                     â”‚
â”‚  ê¸°ë¶„: í¸ì•ˆí•¨, ì˜¤í›„ë¥¼ ì¡°ìš©íˆ ë³´ë‚´ëŠ” ì¤‘             â”‚
â”‚                                                     â”‚
â”‚  [MY HEALTH]                                        â”‚
â”‚  ì‹¬ë°•ìˆ˜: 95 bpm (ì •ìƒ, ê±´ê°•í•¨)                      â”‚
â”‚                                                     â”‚
â”‚  í”„ë¡¬í”„íŠ¸ í¬ê¸°: 800-1000 í† í°                       â”‚
â”‚                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚                                                     â”‚
â”‚  ğŸŸ¢ HEALTH ANALYSIS PROMPT (Sonnet + RAGìš©)        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”‚
â”‚  System Prompt:                                     â”‚
â”‚  "ë‹¹ì‹ ì€ ìˆ˜ì˜ ì „ë¬¸ì˜ì…ë‹ˆë‹¤.                         â”‚
â”‚   ë‹¤ìŒ ì²­ì§„ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ì„¸ìš”.                    â”‚
â”‚   ì˜ë£Œ ì§€ì‹ ê¸°ë°˜ ì •í™•í•œ í•´ì„ì„ ì œê³µí•˜ì„¸ìš”.         â”‚
â”‚   í•„ìš”í•˜ë©´ ë³‘ì› ë°©ë¬¸ì„ ê¶Œì¥í•˜ì„¸ìš”."                â”‚
â”‚                                                     â”‚
â”‚  Context Block:                                     â”‚
â”‚  [CLINICAL DATA]                                    â”‚
â”‚  ì‹¬ë°•ìˆ˜: 95 bpm                                     â”‚
â”‚  íŒŒí˜•: [ì´ë¯¸ì§€]                                    â”‚
â”‚  ì²­ì§„ìŒ: [ì˜¤ë””ì˜¤]                                  â”‚
â”‚                                                     â”‚
â”‚  [RELEVANT MEDICAL KNOWLEDGE - RAG ê²€ìƒ‰ ê²°ê³¼]     â”‚
â”‚  1. "ê°•ì•„ì§€ ì‹¬ë°•ìˆ˜ ì •ìƒ ë²”ìœ„ëŠ”..."                â”‚
â”‚  2. "í™œë™ì  ê°•ì•„ì§€ì˜ ì‹¬ë°•ìˆ˜..."                    â”‚
â”‚  3. "ì‹¬ë°•ìˆ˜ ìƒìŠ¹ ì›ì¸..."                          â”‚
â”‚  (ê° ë¬¸ì„œëŠ” ë²¡í„° ìœ ì‚¬ë„ë¡œ ì •ë ¬ë¨)                  â”‚
â”‚                                                     â”‚
â”‚  [PATIENT HISTORY]                                  â”‚
â”‚  ë½€ì‚ì˜ ê³¼ê±° ê±´ê°•ê¸°ë¡ ìš”ì•½                          â”‚
â”‚                                                     â”‚
â”‚  í”„ë¡¬í”„íŠ¸ í¬ê¸°: 1500-2000 í† í°                      â”‚
â”‚                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 4ï¸âƒ£ ë“€ì–¼ ëª¨ë¸ ì „ëµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              AWS Bedrock Runtime                        â”‚
â”‚              (Claude 3.5 Family)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  ğŸŸ¡ Claude 3.5 Haiku                                   â”‚
â”‚     (ë¹ ë¥´ê³  ì €ë¹„ìš©)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚  â”œâ”€ ëª©ì : GENERAL CHATBOT                              â”‚
â”‚  â”œâ”€ ì‘ë‹µ ì‹œê°„: 200-400ms                               â”‚
â”‚  â”œâ”€ ì…ë ¥ í† í° ë¹„ìš©: $0.00080/1K                        â”‚
â”‚  â”œâ”€ ì¶œë ¥ í† í° ë¹„ìš©: $0.00240/1K                        â”‚
â”‚  â”œâ”€ ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš°: 200K í† í°                         â”‚
â”‚  â”œâ”€ ì‹¤ì œ ì‚¬ìš©: 1500 ì…ë ¥ + 150 ì¶œë ¥                    â”‚
â”‚  â””â”€ ì˜ˆìƒ ë¹„ìš©: ~0.003ë‹¬ëŸ¬/íšŒ                           â”‚
â”‚                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚                                                         â”‚
â”‚  ğŸ”µ Claude 3.5 Sonnet                                  â”‚
â”‚     (ì •í™•í•˜ê³  ìƒì„¸)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€       â”‚
â”‚  â”œâ”€ ëª©ì : PERSONA CHATBOT + HEALTH ANALYSIS            â”‚
â”‚  â”œâ”€ ì‘ë‹µ ì‹œê°„: 800-1200ms                              â”‚
â”‚  â”œâ”€ ì…ë ¥ í† í° ë¹„ìš©: $0.003/1K                          â”‚
â”‚  â”œâ”€ ì¶œë ¥ í† í° ë¹„ìš©: $0.015/1K                          â”‚
â”‚  â”œâ”€ ì»¨í…ìŠ¤íŠ¸ ìœˆë„ìš°: 200K í† í°                         â”‚
â”‚  â”œâ”€ ì‹¤ì œ ì‚¬ìš©: 1800 ì…ë ¥ + 250 ì¶œë ¥                    â”‚
â”‚  â””â”€ ì˜ˆìƒ ë¹„ìš©: ~0.009ë‹¬ëŸ¬/íšŒ                           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ ì„ íƒ ê¸°ì¤€
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
chatType == "general"     â†’ Haiku ì‚¬ìš© (ë¹ ë¦„, ì €ê°€)
chatType == "persona"     â†’ Sonnet ì‚¬ìš© (ì •í™•í•¨)
chatType == "analysis"    â†’ Sonnet + RAG (ì˜ë£Œ ë¶„ì„)
```


### 5ï¸âƒ£ AI ì‘ë‹µ ì²˜ë¦¬ (Response Processing)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           AWS Bedrock Streaming Response               â”‚
â”‚                                                         â”‚
â”‚  ì‘ë‹µ ìŠ¤íŠ¸ë¦¬ë° (ì²­í¬ ë‹¨ìœ„)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ {                                                 â”‚ â”‚
â”‚  â”‚   "type": "content_block_delta",                  â”‚ â”‚
â”‚  â”‚   "delta": {                                      â”‚ â”‚
â”‚  â”‚     "type": "text_delta",                         â”‚ â”‚
â”‚  â”‚     "text": "ë½€ì‚ì˜ í˜„ì¬"                         â”‚ â”‚
â”‚  â”‚   }                                               â”‚ â”‚
â”‚  â”‚ }                                                 â”‚ â”‚
â”‚  â”‚                                                   â”‚ â”‚
â”‚  â”‚ {                                                 â”‚ â”‚
â”‚  â”‚   "type": "content_block_delta",                  â”‚ â”‚
â”‚  â”‚   "delta": {                                      â”‚ â”‚
â”‚  â”‚     "type": "text_delta",                         â”‚ â”‚
â”‚  â”‚     "text": " ì‹¬ë°•ìˆ˜ëŠ”"                           â”‚ â”‚
â”‚  â”‚   }                                               â”‚ â”‚
â”‚  â”‚ }                                                 â”‚ â”‚
â”‚  â”‚ ... (ê³„ì† ìŠ¤íŠ¸ë¦¬ë°)                               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ResponseProcessor Service                     â”‚
â”‚                                                         â”‚
â”‚  âœ“ ë§ˆí¬ë‹¤ìš´ í¬ë§¤íŒ…                                     â”‚
â”‚    (ì œëª©, ë¦¬ìŠ¤íŠ¸, ê°•ì¡° ë“±)                             â”‚
â”‚                                                         â”‚
â”‚  âœ“ ì‘ë‹µ ê²€ì¦                                           â”‚
â”‚    - ê¸¸ì´ í™•ì¸ (MAX: 2048 í† í°)                         â”‚
â”‚    - í†¤ ì¼ê´€ì„± í™•ì¸                                     â”‚
â”‚    - ì˜ë£Œ ì •ë³´ ì •í™•ë„ ê²€ì¦                             â”‚
â”‚                                                         â”‚
â”‚  âœ“ ë©”íƒ€ë°ì´í„° ì¶”ê°€                                     â”‚
â”‚    {                                                   â”‚
â”‚      "id": "chat_20250103_001",                        â”‚
â”‚      "model": "claude-3-5-haiku",                      â”‚
â”‚      "tokens": {                                       â”‚
â”‚        "input": 1500,                                  â”‚
â”‚        "output": 150,                                  â”‚
â”‚        "total": 1650                                   â”‚
â”‚      },                                                â”‚
â”‚      "cost": 0.003,  // USD                            â”‚
â”‚      "responseTime": 250,  // milliseconds             â”‚
â”‚      "confidence": 0.95  // 0-1 ë²”ìœ„                    â”‚
â”‚    }                                                   â”‚
â”‚                                                         â”‚
â”‚  âœ“ ì˜ë£Œ ë©´ì±… ì¡°í•­ ì¶”ê°€ (í•„ìš”ì‹œ)                        â”‚
â”‚    "ë³¸ ì •ë³´ëŠ” ì°¸ê³ ìš©ì´ë©°, ì§„ë‹¨ì„ ëŒ€ì²´í•˜ì§€"             â”‚
â”‚    "ì•ŠìŠµë‹ˆë‹¤. ì‹¬ê°í•œ ì¦ìƒì€ ë³‘ì› ë°©ë¬¸ì„..."           â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 6ï¸âƒ£ í† í° ê³„ì‚° ë° ë¹„ìš© ì¶”ì 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TokenCountingService                   â”‚
â”‚                                          â”‚
â”‚  1ï¸âƒ£ í”„ë¡¬í”„íŠ¸ í† í° ê³„ì‚°                  â”‚
â”‚     System Prompt: 300 í† í°              â”‚
â”‚     + Context Block: 400 í† í°            â”‚
â”‚     + User Message: 50 í† í°              â”‚
â”‚     = ì…ë ¥ í† í°: 750 í† í°                â”‚
â”‚                                          â”‚
â”‚  2ï¸âƒ£ ì‘ë‹µ í† í° ê³„ì‚° (ì‹¤ì‹œê°„)             â”‚
â”‚     ê° ìŠ¤íŠ¸ë¦¬ë° ì²­í¬ë§ˆë‹¤ ì¹´ìš´íŒ…          â”‚
â”‚     ìµœì¢… = ì¶œë ¥ í† í°: 150 í† í°           â”‚
â”‚                                          â”‚
â”‚  3ï¸âƒ£ ë¹„ìš© ê³„ì‚°                          â”‚
â”‚     Haiku:                               â”‚
â”‚     (750 * 0.00080 + 150 * 0.00240) / 1000
â”‚     = (0.60 + 0.36) / 1000 = $0.00096    â”‚
â”‚                                          â”‚
â”‚     Sonnet:                              â”‚
â”‚     (750 * 0.003 + 150 * 0.015) / 1000   â”‚
â”‚     = (2.25 + 2.25) / 1000 = $0.0045     â”‚
â”‚                                          â”‚
â”‚  4ï¸âƒ£ ë©”íŠ¸ë¦­ ì €ì¥ (Prometheus)            â”‚
â”‚     - bedrock_tokens_total               â”‚
â”‚     - bedrock_cost_total                 â”‚
â”‚     - bedrock_response_time_ms           â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


### 7ï¸âƒ£ RAG í†µí•© (ë¯¸ë˜ ë‹¨ê³„)

```
í˜„ì¬ ìƒíƒœ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  í”„ë¡¬í”„íŠ¸                   â”‚
â”‚  = System + Context         â”‚
â”‚  â†’ Claude ì§ì ‘ ì²˜ë¦¬         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ë¯¸ë˜ (Milvus ë„ì… í›„):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ì‚¬ìš©ì ì§ˆë¬¸                                      â”‚
â”‚  "ì‹¬ë°•ìˆ˜ê°€ ë†’ì€ë° ê´œì°®ë‚˜ìš”?"                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1ï¸âƒ£ Query Embedding (Claude API)                â”‚
â”‚     ì§ˆë¬¸ì„ ì„ë² ë”© ë²¡í„°ë¡œ ë³€í™˜                    â”‚
â”‚     768ì°¨ì› ë²¡í„°ë¡œ ë³€í™˜ë¨                        â”‚
â”‚                                                  â”‚
â”‚  2ï¸âƒ£ Milvus ê²€ìƒ‰                                â”‚
â”‚     ìœ ì‚¬ë„ ê³„ì‚° (cosine similarity)              â”‚
â”‚     Top-5 ì˜ë£Œ ë¬¸ì„œ ë°˜í™˜                         â”‚
â”‚                                                  â”‚
â”‚  3ï¸âƒ£ í”„ë¡¬í”„íŠ¸ ê°•í™”                               â”‚
â”‚     ì›ë³¸ í”„ë¡¬í”„íŠ¸ + ê²€ìƒ‰ëœ ë¬¸ì„œ                  â”‚
â”‚     = ê°•í™”ëœ í”„ë¡¬í”„íŠ¸ (1500-2000 í† í°)          â”‚
â”‚                                                  â”‚
â”‚  4ï¸âƒ£ Claude ì²˜ë¦¬                                 â”‚
â”‚     ë”ìš± ì •í™•í•˜ê³  ê·¼ê±° ìˆëŠ” ë‹µë³€ ìƒì„±            â”‚
â”‚                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## ğŸ”§ AI ëª¨ë“ˆ êµ¬í˜„ êµ¬ì¡°

### Service ë ˆì´ì–´

```
healthcare_AIchatbot_service/
â”‚
â”œâ”€â”€ service/
â”‚   â”œâ”€â”€ ClaudeService.java
â”‚   â”‚   â”œâ”€ generateGeneralResponse()   // Haiku
â”‚   â”‚   â”œâ”€ generatePersonaResponse()   // Sonnet
â”‚   â”‚   â”œâ”€ analyzeHealthData()         // Sonnet+RAG
â”‚   â”‚   â”œâ”€ callBedrockAPI()            // í•µì‹¬
â”‚   â”‚   â””â”€ handleStreamingResponse()   // ìŠ¤íŠ¸ë¦¬ë°
â”‚   â”‚
â”‚   â”œâ”€â”€ ContextBuilderService.java
â”‚   â”‚   â”œâ”€ buildPetContext()
â”‚   â”‚   â”œâ”€ buildHealthContext()
â”‚   â”‚   â”œâ”€ buildBehaviorContext()
â”‚   â”‚   â””â”€ buildUserPreferencesContext()
â”‚   â”‚
â”‚   â”œâ”€â”€ PromptBuilderService.java
â”‚   â”‚   â”œâ”€ buildGeneralPrompt()
â”‚   â”‚   â”œâ”€ buildPersonaPrompt()
â”‚   â”‚   â””â”€ buildAnalysisPrompt()
â”‚   â”‚
â”‚   â”œâ”€â”€ ResponseProcessorService.java
â”‚   â”‚   â”œâ”€ formatResponse()
â”‚   â”‚   â”œâ”€ validateResponse()
â”‚   â”‚   â””â”€ extractMetadata()
â”‚   â”‚
â”‚   â””â”€â”€ TokenCountingService.java
â”‚       â”œâ”€ countInputTokens()
â”‚       â”œâ”€ countOutputTokens()
â”‚       â””â”€ calculateCost()
â”‚
â””â”€â”€ infrastructure/
    â”œâ”€â”€ BedrockProperties.java
    â”‚   â”œâ”€ bedrockRegion
    â”‚   â”œâ”€ bedrockModelIds
    â”‚   â””â”€ bedrockMaxTokens
    â”‚
    â”œâ”€â”€ BedrockConfig.java
    â”‚   â””â”€ BedrockRuntime ë¹ˆ ì„¤ì •
    â”‚
    â””â”€â”€ ClaudeClient.java
        â””â”€ AWS SDK ë ˆí¼
```


***

## ğŸ“ˆ ì„±ëŠ¥ ë©”íŠ¸ë¦­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI ì‘ë‹µ ì„±ëŠ¥ ê¸°ì¤€                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                            â”‚
â”‚  ì‘ë‹µ ì‹œê°„ (E2E)                           â”‚
â”‚  â”œâ”€ Haiku General: 200-400ms              â”‚
â”‚  â”œâ”€ Sonnet Persona: 800-1200ms            â”‚
â”‚  â””â”€ Sonnet+RAG Analysis: 1500-2500ms      â”‚
â”‚                                            â”‚
â”‚  í† í° ì‚¬ìš©                                  â”‚
â”‚  â”œâ”€ í‰ê·  ì…ë ¥: 1200-1800 í† í°             â”‚
â”‚  â”œâ”€ í‰ê·  ì¶œë ¥: 150-300 í† í°               â”‚
â”‚  â””â”€ ìµœëŒ€: ì…ë ¥ 200K, ì¶œë ¥ 4K              â”‚
â”‚                                            â”‚
â”‚  ë¹„ìš© / íšŒë‹¹                                â”‚
â”‚  â”œâ”€ Haiku: ~$0.003                        â”‚
â”‚  â”œâ”€ Sonnet: ~$0.009                       â”‚
â”‚  â””â”€ ì›” 1000íšŒ ê¸°ì¤€: ~$10-15               â”‚
â”‚                                            â”‚
â”‚  ì—ëŸ¬ìœ¨                                     â”‚
â”‚  â”œâ”€ API íƒ€ì„ì•„ì›ƒ: <0.1%                   â”‚
â”‚  â”œâ”€ íŒŒì‹± ì—ëŸ¬: <0.5%                      â”‚
â”‚  â””â”€ ëª¨ë¸ ê±°ë¶€: <1%                        â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## ğŸš€ AI ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸

```
âœ… ë°°í¬ ì „ í™•ì¸ì‚¬í•­

â–¡ AWS Bedrock í‚¤ ì„¤ì •
  - AWS_BEDROCK_REGION: us-west-2
  - AWS_BEDROCK_MODEL_IDS: haiku, sonnet

â–¡ í”„ë¡¬í”„íŠ¸ ê²€ì¦
  - System prompt í•œêµ­ì–´ í’ˆì§ˆ ê²€ì¦
  - Context í¬ë§· ì •í™•ì„± í™•ì¸
  - Token limit ì¤€ìˆ˜ (MAX 2048)

â–¡ ì—ëŸ¬ í•¸ë“¤ë§
  - Bedrock API ì˜¤ë¥˜ ëŒ€ì‘
  - í† í° ì œí•œ ì´ˆê³¼ ì‹œ ë™ì‘
  - íƒ€ì„ì•„ì›ƒ ì¬ì‹œë„ ë¡œì§

â–¡ ëª¨ë‹ˆí„°ë§
  - Prometheus ë©”íŠ¸ë¦­ í™œì„±í™”
  - CloudWatch ë¡œê·¸ ì„¤ì •
  - ì¼ì¼ ë¹„ìš© ì§‘ê³„

â–¡ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸
  - ë¶€í•˜ í…ŒìŠ¤íŠ¸ (100 ë™ì‹œ ìš”ì²­)
  - ì‘ë‹µ ì‹œê°„ ê²€ì¦
  - ìŠ¤íŠ¸ë¦¬ë° ì•ˆì •ì„± í™•ì¸

â–¡ ë³´ì•ˆ
  - API í‚¤ í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬
  - ë¡œê·¸ì—ì„œ ë¯¼ê° ì •ë³´ ì œê±°
  - TLS/SSL ì•”í˜¸í™”
```


***

ì´ì œ **AI ì•„í‚¤í…ì²˜ë§Œ** ê¹”ë”í•˜ê²Œ ì •ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ¯

**í•µì‹¬ í¬ì¸íŠ¸:**

- **Haiku**: ë¹ ë¥¸ ì¼ë°˜ ì±—ë´‡ (200ms)
- **Sonnet**: ì •í™•í•œ í˜ë¥´ì†Œë‚˜/ë¶„ì„ (800ms)
- **ì»¨í…ìŠ¤íŠ¸**: 350-650 í† í° (ìµœëŒ€ 1000)
- **ë¹„ìš©**: íšŒë‹¹ \$0.003-0.009
- **RAG**: Milvusë¡œ ë¯¸ë˜ í™•ì¥ ì¤€ë¹„

í˜¹ì‹œ ë” ìì„¸íˆ ì„¤ëª… í•„ìš”í•œ ë¶€ë¶„ ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì„¸ìš”! ğŸš€
<span style="display:none">[^9_1][^9_2][^9_3][^9_4][^9_5][^9_6][^9_7][^9_8][^9_9]</span>

<div align="center">â‚</div>

[^9_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^9_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^9_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^9_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^9_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^9_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^9_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^9_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^9_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg


---

# ì¢‹ê¸´í•œë° ë„ˆë¬´ êµ¬ì²´ì ì¸ê±°ë¼ ë”± AI ì•„í‚¤í…ì³ êµ¬ì¡° ë§Œë“¤ì–´ì¤˜

ì™„ë²½í•©ë‹ˆë‹¤! ì´ì œ ê¹”ë”í•œ AI ì•„í‚¤í…ì²˜ êµ¬ì¡°ë„ì…ë‹ˆë‹¤.[^10_1]

***

# ğŸ¤– Healthcare AI Chatbot - AI ì•„í‚¤í…ì²˜

[^10_1]

***

## ğŸ“ ë ˆì´ì–´ë³„ ì—­í• 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ INPUT LAYER                                     â”‚
â”‚ ì‚¬ìš©ì ë©”ì‹œì§€ + ì±— íƒ€ì… (General/Persona/...)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CONTEXT LAYER                                   â”‚
â”‚ â€¢ Pet Profile  â€¢ Health Data                    â”‚
â”‚ â€¢ Behavior     â€¢ User Preferences               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ PROMPT LAYER                                    â”‚
â”‚ System Prompt + Context ë³‘í•©                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HAIKU            â”‚  â”‚ SONNET           â”‚
â”‚ (General)        â”‚  â”‚ (Persona/Analysis)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                     â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ OUTPUT LAYER        â”‚
        â”‚ Response â†’ Frontend  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ì´ì œ ê¹”ë”í•˜ê³  ëª…í™•í•©ë‹ˆë‹¤! âœ¨
<span style="display:none">[^10_2][^10_3][^10_4][^10_5][^10_6][^10_7][^10_8][^10_9]</span>

<div align="center">â‚</div>

[^10_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^10_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^10_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^10_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^10_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^10_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^10_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^10_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^10_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg


---

# ì•„ë‹ˆ ì´ëŸ° layerí˜•íƒœê°€ ì•„ë‹ˆê³  ê·¸ëƒ¥ AI íˆ´ë“¤ì„ ë°”íƒ•ìœ¼ë¡œ ì–´ë–¤ê±¸ ì‚¬ìš©í–ˆëŠ”ì§€ë¥¼ ì •ë¦¬í•´ë‹¬ë¼ëŠ”ëœ»ì´ì—ˆì–´

ì™„ë²½í•©ë‹ˆë‹¤! ì´ì œ ë‹¹ì‹ ì´ ì‚¬ìš©í•œ **AI ë„êµ¬ì™€ ëª¨ë¸ ì„ íƒ**ì„ ëª…í™•í•˜ê²Œ ì •ë¦¬í–ˆìŠµë‹ˆë‹¤.

## ğŸ“Œ í•µì‹¬ ìš”ì•½

| ì˜ì—­ | ì„ íƒí•œ ë„êµ¬ | ì´ìœ  |
| :-- | :-- | :-- |
| **LLM (ì¼ë°˜ ì±—)** | Claude 3.5 Haiku | ë¹ ë¥´ê³  ì €ê°€ |
| **LLM (ê³ ê¸‰ ë¶„ì„)** | Claude 3.5 Sonnet | ì •í™•í•˜ê³  ìš°ìˆ˜ |
| **ë²¡í„° DB** | Milvus | ì˜¤í”ˆì†ŒìŠ¤, ë¹„ìš© ì ˆê° |
| **ì„ë² ë”©** | Claude Embeddings | ë‚´ì¥, ì¼ê´€ì„± |
| **3D ìƒì„±** | Tripo3D | ë¬´ë£Œ, ë¹ ë¦„ |
| **ë°ì´í„° ìˆ˜ì§‘** | Jsoup | ìŠ¤í¬ë˜í•‘ |

ëª¨ë“  ì„ íƒì´ **ë¹„ìš© íš¨ìœ¨ì„±** + **ì„±ëŠ¥**ì„ ê³ ë ¤í•œ ì¡°í•©ì…ë‹ˆë‹¤! ğŸš€
<span style="display:none">[^11_1][^11_2][^11_3][^11_4][^11_5][^11_6][^11_7][^11_8][^11_9]</span>

<div align="center">â‚</div>

[^11_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^11_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^11_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^11_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^11_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^11_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^11_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^11_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^11_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg


---

# ì•„ ì ì‹œë§Œ í•œê°€ì§€ ì´ì•¼ê¸°í•´ì•¼í• ê²ƒì´ìˆì–´ í—¬ìŠ¤ì¼€ì–´ íƒ­ì—ì„œì˜ ë°ì´í„°ë“¤ì€ ëª¨ë‘ í˜ë¥´ì†Œë‚˜ ì±—ë´‡ê³¼ ì¼ë°˜ì±—ë´‡ì— ë°ì´í„°ë¥¼ ì „ë‹¬í•´ë†“ê³  ê·¸ê±°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ëŒ€ë‹µí•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•´ë†“ëŠ”ê±¸ ì¶”ê°€í• ê±°ì•¼. ì°¸ê³ í•´ì¤˜

ì™„ë²½í•˜ê²Œ ì´í•´í–ˆìŠµë‹ˆë‹¤! **Healthcare íƒ­ì˜ ëª¨ë“  ë°ì´í„° (WITHaPET ì²­ì§„ ê¸°ë¡, AI ìš”ì•½ ë“±)ë¥¼ ì¼ë°˜ ì±—ë´‡ê³¼ í˜ë¥´ì†Œë‚˜ ì±—ë´‡ì˜ ì»¨í…ìŠ¤íŠ¸ë¡œ ìë™ ì „ë‹¬**í•˜ëŠ” êµ¬ì¡°ë¡œ ë§Œë“¤ê² ìŠµë‹ˆë‹¤.

***

# ğŸ”— Healthcare ë°ì´í„° â†’ ì±—ë´‡ ì»¨í…ìŠ¤íŠ¸ í†µí•©

## í•µì‹¬ ê°œë…

```
Healthcare íƒ­ì—ì„œ ìƒì„±ëœ ëª¨ë“  ë°ì´í„°
    â†“
ContextBuilderê°€ ìë™ìœ¼ë¡œ ìˆ˜ì§‘
    â†“
General Chatbot & Persona Chatbotì´ í™œìš©
    â†“
"ë½€ì‚ê°€ ì–´ì œ ì‹¬ë°•ìˆ˜ê°€ ë†’ì•˜ëŠ”ë° ê´œì°®ì•„?" ê°™ì€ ì§ˆë¬¸ì— ë‹µë³€ ê°€ëŠ¥
```


***

## êµ¬í˜„ ë°©ë²•

### 1ï¸âƒ£ ContextBuilder ìˆ˜ì • (Healthcare ë°ì´í„° í†µí•©)

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/ContextBuilderService.java

@Service
@Slf4j
public class ContextBuilderService {
    
    @Autowired
    private HeartHealthRecordRepository healthRecordRepository;
    
    @Autowired
    private Avatar3DTaskRepository avatar3DTaskRepository;
    
    /**
     * Healthcare ë°ì´í„°ë¥¼ í¬í•¨í•œ ì™„ì „í•œ ì»¨í…ìŠ¤íŠ¸ ë¹Œë“œ
     * WHY: ëª¨ë“  ì±—ë´‡ì´ ìµœì‹  ê±´ê°• ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì‘ë‹µí•˜ë„ë¡
     */
    public String buildCompleteContext(Long userId, Long petId) {
        StringBuilder context = new StringBuilder();
        
        // 1ï¸âƒ£ Pet Profile (ê¸°ì¡´)
        context.append(buildPetProfile(petId));
        
        // 2ï¸âƒ£ Healthcare Data (ìƒˆë¡œ ì¶”ê°€)
        context.append(buildHealthcareContext(petId));
        
        // 3ï¸âƒ£ Behavior Data (ê¸°ì¡´)
        context.append(buildBehaviorContext(petId));
        
        // 4ï¸âƒ£ User Preferences (ê¸°ì¡´)
        context.append(buildUserPreferences(userId));
        
        return context.toString();
    }
    
    /**
     * Healthcare íƒ­ì˜ ëª¨ë“  ë°ì´í„°ë¥¼ ì»¨í…ìŠ¤íŠ¸ë¡œ ë³€í™˜
     * WHY: WITHaPET ì²­ì§„ ë°ì´í„°, AI ìš”ì•½, ì´ìƒ ê°ì§€ë¥¼ ì±—ë´‡ì´ ì¸ì§€
     */
    private String buildHealthcareContext(Long petId) {
        StringBuilder healthContext = new StringBuilder();
        
        healthContext.append("\n[HEALTHCARE DATA]\n");
        
        // ìµœê·¼ 3ê°œì˜ ê±´ê°• ê¸°ë¡ ê°€ì ¸ì˜¤ê¸°
        List<HeartHealthRecord> recentRecords = healthRecordRepository
            .findTop3ByPetIdOrderByRecordedAtDesc(petId);
        
        if (recentRecords.isEmpty()) {
            healthContext.append("No recent health records.\n");
            return healthContext.toString();
        }
        
        // ìµœì‹  ê¸°ë¡ ìš”ì•½
        HeartHealthRecord latest = recentRecords.get(0);
        healthContext.append(String.format(
            "Latest Check: %s\n" +
            "Heart Rate: %d bpm (Normal: 75-110 bpm)\n" +
            "Status: %s\n",
            latest.getRecordedAt().format(DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm")),
            latest.getHeartRate(),
            latest.getIsAbnormal() ? "âš ï¸ ABNORMAL" : "âœ“ Normal"
        ));
        
        // AI ì§„ë‹¨ ë‚´ìš© (ìˆìœ¼ë©´)
        if (latest.getAiDiagnosis() != null) {
            healthContext.append(String.format(
                "AI Diagnosis: %s\n",
                latest.getAiDiagnosis()
            ));
        }
        
        // AI ìš”ì•½ ë¦¬í¬íŠ¸ (ìˆìœ¼ë©´)
        if (latest.getAiSummary() != null) {
            healthContext.append(String.format(
                "Veterinary Summary: %s\n",
                latest.getAiSummary()
            ));
        }
        
        // ìµœê·¼ 3ê°œì›” íŠ¸ë Œë“œ ë¶„ì„
        if (recentRecords.size() > 1) {
            healthContext.append("\nRecent Health Trend:\n");
            
            for (int i = 0; i < Math.min(3, recentRecords.size()); i++) {
                HeartHealthRecord record = recentRecords.get(i);
                healthContext.append(String.format(
                    "- %s: %d bpm %s\n",
                    record.getRecordedAt().format(DateTimeFormatter.ofPattern("MM/dd")),
                    record.getHeartRate(),
                    record.getIsAbnormal() ? "(Abnormal)" : ""
                ));
            }
        }
        
        // ì´ìƒ ê°ì§€ ì•Œë¦¼ (ìµœê·¼ 7ì¼ ë‚´)
        long recentAnomalies = recentRecords.stream()
            .filter(r -> r.getIsAbnormal() && 
                   r.getRecordedAt().isAfter(LocalDateTime.now().minusDays(7)))
            .count();
        
        if (recentAnomalies > 0) {
            healthContext.append(String.format(
                "\nâš ï¸ WARNING: %d abnormal readings in the past 7 days.\n",
                recentAnomalies
            ));
        }
        
        // 3D ì•„ë°”íƒ€ ì •ë³´ (ìˆìœ¼ë©´)
        avatar3DTaskRepository.findByPetIdAndStatus(petId, "COMPLETED")
            .ifPresent(avatar -> {
                healthContext.append(String.format(
                    "\n3D Avatar: Available (Generated: %s)\n",
                    avatar.getCompletedAt().format(DateTimeFormatter.ofPattern("yyyy-MM-dd"))
                ));
            });
        
        log.info("Healthcare context built for petId: {} (size: {} chars)", 
                 petId, healthContext.length());
        
        return healthContext.toString();
    }
}
```


***

### 2ï¸âƒ£ General Chatbotì—ì„œ Healthcare ë°ì´í„° í™œìš©

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/ClaudeService.java

public String generateGeneralResponse(Long userId, Long petId, String userMessage) {
    
    // ì™„ì „í•œ ì»¨í…ìŠ¤íŠ¸ ë¹Œë“œ (Healthcare í¬í•¨)
    String fullContext = contextBuilderService.buildCompleteContext(userId, petId);
    
    // System Prompt ìƒì„±
    String systemPrompt = String.format("""
        ë‹¹ì‹ ì€ 10ë…„ ê²½ë ¥ì˜ ìˆ˜ì˜ì‚¬ì…ë‹ˆë‹¤.
        ê°•ì•„ì§€ ì£¼ì¸ê³¼ ìƒë‹´ ì¤‘ì…ë‹ˆë‹¤.
        
        ë‹¤ìŒ ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì •í™•í•œ ì¡°ì–¸ì„ ì œê³µí•˜ì„¸ìš”:
        %s
        
        ì§€ì‹œì‚¬í•­:
        - ì œê³µëœ Healthcare ë°ì´í„°ë¥¼ ì°¸ê³ í•˜ì—¬ ë‹µë³€í•˜ì„¸ìš”
        - ìµœê·¼ ì‹¬ë°•ìˆ˜ë‚˜ ê±´ê°• ì´ìƒì´ ìˆë‹¤ë©´ ë°˜ë“œì‹œ ì–¸ê¸‰í•˜ì„¸ìš”
        - ì´ìƒ ì§•í›„ ë°œê²¬ ì‹œ ë³‘ì› ë°©ë¬¸ì„ ê¶Œì¥í•˜ì„¸ìš”
        - í•œêµ­ì–´ë¡œ ì¹œì ˆí•˜ê³  ì „ë¬¸ì ì¸ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”
        """, 
        fullContext
    );
    
    // Claude Haiku API í˜¸ì¶œ
    return callBedrockAPI("claude-3-5-haiku", systemPrompt, userMessage);
}
```


### ì˜ˆì‹œ ëŒ€í™”

```
ì‚¬ìš©ì: "ìš°ë¦¬ ë½€ì‚ê°€ ìš”ì¦˜ ìˆ¨ì„ ìì£¼ í—ë–¡ê±°ë¦¬ëŠ”ë° ê´œì°®ë‚˜ìš”?"

General Chatbot (Healthcare ë°ì´í„° í™œìš©):
"ë½€ì‚ì˜ ìµœê·¼ ì²­ì§„ ê¸°ë¡ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤. 

[Healthcare Data ì°¸ê³ ]
- ìµœê·¼ ì‹¬ë°•ìˆ˜: 95 bpm (ì •ìƒ ë²”ìœ„ 75-110 bpm)
- ìƒíƒœ: ì •ìƒ
- ìµœê·¼ ì´ìƒ: ì—†ìŒ

ë½€ì‚ê°€ ìˆ¨ì„ í—ë–¡ê±°ë¦¬ëŠ” ê²ƒì€ ë‹¤ìŒê³¼ ê°™ì€ ì´ìœ ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **í™œë™ëŸ‰ ì¦ê°€**: ìµœê·¼ ì‹¬ë°•ìˆ˜ê°€ ì •ìƒ ë²”ìœ„ ë‚´ì´ì§€ë§Œ í‰ì†Œë³´ë‹¤ 
   í™œë™ì ì´ì—ˆì„ ê°€ëŠ¥ì„±ì´ ìˆìŠµë‹ˆë‹¤.

2. **ì˜¨ë„**: ì‹¤ë‚´ ì˜¨ë„ê°€ ë†’ê±°ë‚˜ ë”ìš´ í™˜ê²½ì—ì„œ ì²´ì˜¨ ì¡°ì ˆì„ ìœ„í•´ 
   í—ë–¡ê±°ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. **ìŠ¤íŠ¸ë ˆìŠ¤ë‚˜ í¥ë¶„**: ìƒˆë¡œìš´ í™˜ê²½ì´ë‚˜ ìê·¹ì— ë°˜ì‘í–ˆì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í˜„ì¬ ì²­ì§„ ê¸°ë¡ìƒ ì‹¬ë°•ìˆ˜ëŠ” ì •ìƒì´ë¯€ë¡œ ì‹¬ê°í•œ ë¬¸ì œëŠ” ì•„ë‹Œ ê²ƒìœ¼ë¡œ 
ë³´ì…ë‹ˆë‹¤. ë‹¤ë§Œ ë‹¤ìŒ ì¦ìƒì´ ìˆë‹¤ë©´ ë³‘ì› ë°©ë¬¸ì„ ê¶Œì¥í•©ë‹ˆë‹¤:

âš ï¸ ì£¼ì˜ì‚¬í•­:
- í—ë–¡ê±°ë¦¼ì´ 24ì‹œê°„ ì´ìƒ ì§€ì†
- ê¸°ì¹¨ì´ë‚˜ êµ¬í† ë¥¼ ë™ë°˜
- ì‹ìš• ê°ì†Œë‚˜ ê¸°ë ¥ ì €í•˜

ë½€ì‚ë¥¼ ê³„ì† ê´€ì°°í•´ì£¼ì‹œê³ , ì¦ìƒì´ ì§€ì†ë˜ë©´ ìˆ˜ì˜ì‚¬ ê²€ì§„ì„ ë°›ì•„ë³´ì„¸ìš”."
```


***

### 3ï¸âƒ£ Persona Chatbotì—ì„œë„ Healthcare ë°ì´í„° í™œìš©

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/PersonaChatService.java

public String generatePersonaResponse(Long userId, Long petId, String userMessage) {
    
    // Healthcare ë°ì´í„° í¬í•¨ ì»¨í…ìŠ¤íŠ¸
    String fullContext = contextBuilderService.buildCompleteContext(userId, petId);
    
    // í˜ë¥´ì†Œë‚˜ System Prompt
    String systemPrompt = String.format("""
        ë‹¹ì‹ ì€ ë½€ì‚(5ì„¸ ë§í‹°ì¦ˆ)ì…ë‹ˆë‹¤.
        í™œë°œí•˜ê³  ì¹œí™”ì ì¸ ì„±ê²©ì…ë‹ˆë‹¤.
        
        ë‹¹ì‹ ì˜ í˜„ì¬ ìƒíƒœ:
        %s
        
        ì£¼ì¸ê³¼ ìì—°ìŠ¤ëŸ½ê²Œ ëŒ€í™”í•˜ì„¸ìš”.
        ë°˜ë§ë¡œ ì¹œê·¼í•œ í†¤ì„ ìœ ì§€í•˜ì„¸ìš”.
        ìµœê·¼ ê±´ê°• ìƒíƒœê°€ ì¢‹ìœ¼ë©´ ê¸°ë¶„ ì¢‹ê²Œ í‘œí˜„í•˜ì„¸ìš”.
        ì´ìƒì´ ìˆì—ˆë‹¤ë©´ ê±±ì •í•˜ëŠ” í†¤ìœ¼ë¡œ ë§í•˜ì„¸ìš”.
        150ë‹¨ì–´ ì´ë‚´ë¡œ ë‹µë³€í•˜ì„¸ìš”.
        """,
        fullContext
    );
    
    return callBedrockAPI("claude-3-5-sonnet", systemPrompt, userMessage);
}
```


### í˜ë¥´ì†Œë‚˜ ì˜ˆì‹œ ëŒ€í™”

```
ì‚¬ìš©ì: "ë½€ì‚ì•¼, ì˜¤ëŠ˜ ê¸°ë¶„ ì–´ë•Œ?"

Persona Chatbot (Healthcare ë°ì´í„° í™œìš©):
"í—¤í—¤, ì˜¤ëŠ˜ ê¸°ë¶„ ì—„ì²­ ì¢‹ì•„! ğŸ¶

ì–´ì œ ì‹¬ì¥ ê²€ì‚¬ ë°›ì•˜ì–ì•„? ì‹¬ë°•ìˆ˜ê°€ 95ë¡œ ì •ìƒì´ë˜!
ì„ ìƒë‹˜ì´ ê±´ê°•í•˜ë‹¤ê³  ì¹­ì°¬í•´ì¤¬ì–´ ğŸ˜Š

ê·¸ë˜ì„œ ì˜¤ëŠ˜ ì•„ì¹¨ì— ì‚°ì±… ë‚˜ê°€ì„œ ì‹ ë‚˜ê²Œ ë›°ì–´ë†€ì•˜ì–´.
ë‹¤ë¥¸ ê°•ì•„ì§€ ì¹œêµ¬ë“¤ë„ ë§ì´ ë§Œë‚¬ê³ !

ê·¼ë° ì¡°ê¸ˆ í”¼ê³¤í•˜ê¸´ í•´... ìˆ¨ì´ ì¢€ ê°€ë¹ .
ë„ˆë¬´ ì‹ ë‚˜ì„œ ë§ì´ ë›°ì–´ë‹¤ë…”ë‚˜ë´ ã…ã…

ì£¼ì¸ì•„, ë‚˜ ë°¥ ì¤„ ì‹œê°„ ëì–´! ë°°ê³ íŒŒ~ ğŸ–"
```


***

## 4ï¸âƒ£ Repository ë©”ì„œë“œ ì¶”ê°€

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/repository/HeartHealthRecordRepository.java

public interface HeartHealthRecordRepository extends JpaRepository<HeartHealthRecord, Long> {
    
    // ê¸°ì¡´ ë©”ì„œë“œë“¤...
    
    /**
     * íŠ¹ì • í«ì˜ ìµœê·¼ Nê°œ ê±´ê°• ê¸°ë¡ ì¡°íšŒ (ìµœì‹ ìˆœ)
     * WHY: ì±—ë´‡ ì»¨í…ìŠ¤íŠ¸ ë¹Œë”© ì‹œ ìµœê·¼ ë°ì´í„°ë§Œ í™œìš©
     */
    @Query("SELECT h FROM HeartHealthRecord h WHERE h.petId = :petId " +
           "ORDER BY h.recordedAt DESC")
    List<HeartHealthRecord> findTop3ByPetIdOrderByRecordedAtDesc(
        @Param("petId") Long petId,
        Pageable pageable
    );
    
    default List<HeartHealthRecord> findTop3ByPetIdOrderByRecordedAtDesc(Long petId) {
        return findTop3ByPetIdOrderByRecordedAtAtDesc(petId, PageRequest.of(0, 3));
    }
    
    /**
     * íŠ¹ì • ê¸°ê°„ ë‚´ ì´ìƒ ê¸°ë¡ ìˆ˜ ì¡°íšŒ
     */
    @Query("SELECT COUNT(h) FROM HeartHealthRecord h " +
           "WHERE h.petId = :petId " +
           "AND h.isAbnormal = true " +
           "AND h.recordedAt > :sinceDate")
    long countAbnormalRecordsSince(
        @Param("petId") Long petId,
        @Param("sinceDate") LocalDateTime sinceDate
    );
}
```


***

## 5ï¸âƒ£ ìë™ ì—…ë°ì´íŠ¸ ë©”ì»¤ë‹ˆì¦˜ (Kafka)

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/HealthContextCacheService.java

@Service
@Slf4j
public class HealthContextCacheService {
    
    private final Map<Long, String> healthContextCache = new ConcurrentHashMap<>();
    
    @Autowired
    private ContextBuilderService contextBuilderService;
    
    /**
     * ìƒˆ ê±´ê°• ê¸°ë¡ ìƒì„± ì‹œ ìë™ìœ¼ë¡œ ìºì‹œ ì—…ë°ì´íŠ¸
     * WHY: ì±—ë´‡ì´ í•­ìƒ ìµœì‹  ì •ë³´ë¡œ ë‹µë³€í•˜ë„ë¡
     */
    @KafkaListener(topics = "healthcare.health-records", groupId = "chatbot-context")
    public void handleHealthRecordUpdate(HealthRecordEvent event) {
        log.info("ğŸ“Š Updating health context cache for petId: {}", event.getPetId());
        
        // í•´ë‹¹ í«ì˜ ì»¨í…ìŠ¤íŠ¸ ìºì‹œ ë¬´íš¨í™”
        healthContextCache.remove(event.getPetId());
        
        // ìƒˆë¡œìš´ ì»¨í…ìŠ¤íŠ¸ ë¯¸ë¦¬ ë¹Œë“œ (ì„ ì œì  ìºì‹±)
        String newContext = contextBuilderService.buildHealthcareContext(event.getPetId());
        healthContextCache.put(event.getPetId(), newContext);
        
        log.info("âœ… Health context cache updated for petId: {}", event.getPetId());
    }
    
    /**
     * ìºì‹œì—ì„œ Healthcare ì»¨í…ìŠ¤íŠ¸ ì¡°íšŒ (ì—†ìœ¼ë©´ ë¹Œë“œ)
     */
    public String getHealthContext(Long petId) {
        return healthContextCache.computeIfAbsent(
            petId, 
            id -> contextBuilderService.buildHealthcareContext(id)
        );
    }
}
```


***

## 6ï¸âƒ£ Frontend í†µí•© (Healthcare â†’ Chatbot ì—°ê²°)

```typescript
// Frontend/src/features/healthcare/components/HealthDashboard.tsx

export function HealthDashboard({ petId }: { petId: number }) {
  const [showChatbot, setShowChatbot] = useState(false);
  
  // Healthcare ê¸°ë¡ ì¡°íšŒ í›„ ì±—ë´‡ ì—´ê¸°
  const handleAskVet = (record: HeartHealthRecord) => {
    // ì±—ë´‡ ì—´ê¸°
    setShowChatbot(true);
    
    // ìë™ìœ¼ë¡œ ì§ˆë¬¸ ìƒì„± (optional)
    const autoQuestion = `${record.heartRate}bpm ì‹¬ë°•ìˆ˜ì— ëŒ€í•´ ì„¤ëª…í•´ì¤˜`;
    sendMessageToChatbot(autoQuestion);
  };
  
  return (
    <div className="health-dashboard">
      {/* ê±´ê°• ê¸°ë¡ í‘œì‹œ */}
      <HealthRecordList records={records} />
      
      {/* "ìˆ˜ì˜ì‚¬ì—ê²Œ ë¬¼ì–´ë³´ê¸°" ë²„íŠ¼ */}
      <button onClick={() => setShowChatbot(true)}>
        ğŸ©º ìˆ˜ì˜ì‚¬ AIì—ê²Œ ë¬¼ì–´ë³´ê¸°
      </button>
      
      {/* ì±—ë´‡ ëª¨ë‹¬ (Healthcare ë°ì´í„° ìë™ í¬í•¨) */}
      {showChatbot && (
        <ChatbotModal 
          petId={petId}
          onClose={() => setShowChatbot(false)}
        />
      )}
    </div>
  );
}
```


***

## ğŸ“Š ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Healthcare íƒ­                                   â”‚
â”‚                                                 â”‚
â”‚  1. WITHaPET ë°ì´í„° ìŠ¤í¬ë˜í•‘                    â”‚
â”‚  2. ì‹¬ë°•ìˆ˜ 95 bpm ì €ì¥                          â”‚
â”‚  3. AI ìš”ì•½ ë¦¬í¬íŠ¸ ìƒì„±                         â”‚
â”‚  4. DB ì €ì¥ âœ“                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ Kafka Event ë°œí–‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  healthcare.health-records                       â”‚
â”‚  { petId: 456, recordId: 1, ... }                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ êµ¬ë…
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HealthContextCacheService                       â”‚
â”‚  â€¢ ìºì‹œ ì—…ë°ì´íŠ¸                                 â”‚
â”‚  â€¢ ìµœì‹  ì»¨í…ìŠ¤íŠ¸ ë¯¸ë¦¬ ë¹Œë“œ                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ ì‚¬ìš©ìê°€ ì±—ë´‡ì— ì§ˆë¬¸
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  "ë½€ì‚ê°€ ìˆ¨ì„ í—ë–¡ê±°ë¦¬ëŠ”ë° ê´œì°®ë‚˜ìš”?"            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ ContextBuilder í˜¸ì¶œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  buildCompleteContext()                          â”‚
â”‚  â”œâ”€ Pet Profile                                  â”‚
â”‚  â”œâ”€ Healthcare Data âœ… (ìµœì‹  ì‹¬ë°•ìˆ˜ 95 bpm í¬í•¨)â”‚
â”‚  â”œâ”€ Behavior Data                                â”‚
â”‚  â””â”€ User Preferences                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼ Claude API í˜¸ì¶œ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  General Chatbot (Haiku)                         â”‚
â”‚                                                  â”‚
â”‚  "ë½€ì‚ì˜ ìµœê·¼ ì²­ì§„ ê¸°ë¡ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.          â”‚
â”‚   ì‹¬ë°•ìˆ˜: 95 bpm (ì •ìƒ)                          â”‚
â”‚   ìˆ¨ì„ í—ë–¡ê±°ë¦¬ëŠ” ê²ƒì€ í™œë™ëŸ‰ ë•Œë¬¸ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤..."â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## âœ… í•µì‹¬ ì •ë¦¬

1. **ContextBuilderì— Healthcare ë°ì´í„° í†µí•©**
    - `buildHealthcareContext()` ë©”ì„œë“œ ì¶”ê°€
    - ìµœê·¼ 3ê°œ ê±´ê°• ê¸°ë¡ ìë™ í¬í•¨
2. **General/Persona ì±—ë´‡ ëª¨ë‘ Healthcare ë°ì´í„° í™œìš©**
    - ì‚¬ìš©ìê°€ ê±´ê°• ê´€ë ¨ ì§ˆë¬¸ ì‹œ ì •í™•í•œ ë‹µë³€
    - "ì–´ì œ ì‹¬ë°•ìˆ˜ ë†’ì•˜ëŠ”ë°..." ê°™ì€ ì§ˆë¬¸ì— ëŒ€ì‘
3. **ìë™ ìºì‹œ ì—…ë°ì´íŠ¸ (Kafka)**
    - ìƒˆ ê±´ê°• ê¸°ë¡ ìƒì„± â†’ ìºì‹œ ìë™ ê°±ì‹ 
    - ì±—ë´‡ì´ í•­ìƒ ìµœì‹  ì •ë³´ í™œìš©
4. **Frontend ì—°ë™**
    - Healthcare íƒ­ì—ì„œ "ìˆ˜ì˜ì‚¬ì—ê²Œ ë¬¼ì–´ë³´ê¸°" ë²„íŠ¼
    - ìë™ìœ¼ë¡œ ê±´ê°• ë°ì´í„° í¬í•¨ëœ ì±—ë´‡ ì‹¤í–‰

ì´ì œ **Healthcare íƒ­ì˜ ëª¨ë“  ë°ì´í„°ê°€ ì±—ë´‡ì˜ ì§€ì‹ì´ ë©ë‹ˆë‹¤!** ğŸ©ºğŸ¤–
<span style="display:none">[^12_1][^12_2][^12_3][^12_4][^12_5][^12_6][^12_7][^12_8][^12_9]</span>

<div align="center">â‚</div>

[^12_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^12_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^12_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^12_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^12_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^12_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^12_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^12_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^12_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg


---

# í˜¹ì‹œ ë‹¤ì‹œ ì—…ë°ì´íŠ¸ëœ ë²„ì „ì„ ë°”íƒ•ìœ¼ë¡œ AI ì•„í‚¤í…ì³ ì •ë¦¬í•´ì¤„ ìˆ˜ ìˆì–´? diaryì—ì„œ ë„˜ê¸°ëŠ” ë°ì´í„° ë¡œì§ê°™ì€ê²ƒë„ í¬í•¨í•´ì„œ

ì™„ë²½í•©ë‹ˆë‹¤! ì´ì œ **ì™„ì „í•œ AI ì•„í‚¤í…ì²˜**ë¥¼ ì •ë¦¬í•´ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

![Healthcare AI Chatbot - ì™„ì „í•œ AI ì•„í‚¤í…ì²˜ (ë°ì´í„° í†µí•© í¬í•¨)](https://ppl-ai-code-interpreter-files.s3.amazonaws.com/web/direct-files/b8c464fdbe96f45ea3aff8bb7a1ac517/a3e176ec-46c6-41c8-bb11-bdfd9f6d79b3/24db6ca6.png)

Healthcare AI Chatbot - ì™„ì „í•œ AI ì•„í‚¤í…ì²˜ (ë°ì´í„° í†µí•© í¬í•¨)

---

# ğŸ¤– Healthcare AI Chatbot - ì™„ì „í•œ AI ì•„í‚¤í…ì²˜


---

## ğŸ“Š ì „ì²´ ë°ì´í„° íë¦„

### 1ï¸âƒ£ ë°ì´í„° ì†ŒìŠ¤ (4ê°œ MSA ì„œë¹„ìŠ¤)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ë°ì´í„° ìˆ˜ì§‘ ë ˆì´ì–´                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“” Diary Service (Port 8087)                               â”‚
â”‚  â””â”€ Kafka Topic: diary.events                              â”‚
â”‚     â”œâ”€ diary.created                                       â”‚
â”‚     â”œâ”€ diary.updated                                       â”‚
â”‚     â””â”€ diary.mood_recorded                                 â”‚
â”‚                                                             â”‚
â”‚     ì „ë‹¬ ë°ì´í„°:                                            â”‚
â”‚     {                                                       â”‚
â”‚       petId: 456,                                          â”‚
â”‚       mood: "í¸ì•ˆí•¨",                                      â”‚
â”‚       activityLevel: "í™œë™ì ",                             â”‚
â”‚       eatingPattern: "ì •ìƒ",                               â”‚
â”‚       sleepPattern: "8ì‹œê°„",                               â”‚
â”‚       behaviorNotes: "ì˜¤ëŠ˜ ì‚°ì±… ë§ì´ í•¨"                   â”‚
â”‚     }                                                       â”‚
â”‚                                                             â”‚
â”‚  ğŸ‘¤ User Service (Port 8080)                                â”‚
â”‚  â””â”€ Kafka Topic: user.profiles                             â”‚
â”‚     â”œâ”€ pet.profile_updated                                 â”‚
â”‚     â””â”€ pet.deleted                                         â”‚
â”‚                                                             â”‚
â”‚     ì „ë‹¬ ë°ì´í„°:                                            â”‚
â”‚     {                                                       â”‚
â”‚       petId: 456,                                          â”‚
â”‚       name: "ë½€ì‚",                                        â”‚
â”‚       breed: "ë§í‹°ì¦ˆ",                                     â”‚
â”‚       age: 5,                                              â”‚
â”‚       weight: 3.5,                                         â”‚
â”‚       personality: "í™œë°œí•¨, ì¹œí™”ì ",                       â”‚
â”‚       medicalHistory: ["ë°±ì‹ ", "ì¤‘ì„±í™”"]                   â”‚
â”‚     }                                                       â”‚
â”‚                                                             â”‚
â”‚  ğŸ¥ Healthcare Service (Port 8085) - ìì²´ ë°ì´í„°            â”‚
â”‚  â””â”€ DB: heart_health_records                               â”‚
â”‚                                                             â”‚
â”‚     ë°ì´í„°:                                                 â”‚
â”‚     {                                                       â”‚
â”‚       petId: 456,                                          â”‚
â”‚       heartRate: 95,                                       â”‚
â”‚       recordedAt: "2025-01-03",                            â”‚
â”‚       isAbnormal: false,                                   â”‚
â”‚       aiDiagnosis: "ì •ìƒ ë²”ìœ„",                            â”‚
â”‚       aiSummary: "ë½€ì‚ì˜ ì‹¬ë°•ìˆ˜ëŠ”..."                      â”‚
â”‚     }                                                       â”‚
â”‚                                                             â”‚
â”‚  ğŸ‘¥ Social Service (Port 8083)                              â”‚
â”‚  â””â”€ Kafka Topic: social.activity                           â”‚
â”‚     â””â”€ social.interaction                                  â”‚
â”‚                                                             â”‚
â”‚     ì „ë‹¬ ë°ì´í„°:                                            â”‚
â”‚     {                                                       â”‚
â”‚       petId: 456,                                          â”‚
â”‚       socialActivity: "ì‚°ì±… ë©”ì´íŠ¸ 3íšŒ",                   â”‚
â”‚       friendCount: 5,                                      â”‚
â”‚       recentInteraction: "ì–´ì œ ê³µì›ì—ì„œ ë†€ìŒ"              â”‚
â”‚     }                                                       â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

### 2ï¸âƒ£ Kafka ê¸°ë°˜ ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           KafkaConsumerService                           â”‚
â”‚           (healthcare_AIchatbot_service)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  ğŸ“¥ êµ¬ë… ì¤‘ì¸ í† í”½:                                      â”‚
â”‚                                                          â”‚
â”‚  1ï¸âƒ£ diary.events (Diary Service)                       â”‚
â”‚     @KafkaListener(topics = "diary.events")             â”‚
â”‚     public void processDiaryEvent(DiaryEvent event) {   â”‚
â”‚       // í–‰ë™ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ ìºì‹œì— ì €ì¥              â”‚
â”‚       behaviorCache.put(event.getPetId(), event);       â”‚
â”‚       log.info("ğŸ“” Diary data cached: {}", event);      â”‚
â”‚     }                                                    â”‚
â”‚                                                          â”‚
â”‚  2ï¸âƒ£ user.profiles (User Service)                       â”‚
â”‚     @KafkaListener(topics = "user.profiles")            â”‚
â”‚     public void processUserProfileEvent(Event event) {  â”‚
â”‚       // í« í”„ë¡œí•„ ìºì‹œ ì—…ë°ì´íŠ¸                        â”‚
â”‚       petProfileCache.put(event.getPetId(), profile);   â”‚
â”‚       log.info("ğŸ‘¤ Pet profile updated: {}", event);    â”‚
â”‚     }                                                    â”‚
â”‚                                                          â”‚
â”‚  3ï¸âƒ£ social.activity (Social Service)                   â”‚
â”‚     @KafkaListener(topics = "social.activity")          â”‚
â”‚     public void processSocialEvent(SocialEvent event) { â”‚
â”‚       // ì†Œì…œ í™œë™ ë°ì´í„° ìºì‹œ                          â”‚
â”‚       socialCache.put(event.getPetId(), event);         â”‚
â”‚       log.info("ğŸ‘¥ Social activity cached: {}", event); â”‚
â”‚     }                                                    â”‚
â”‚                                                          â”‚
â”‚  ğŸ“¤ ë°œí–‰í•˜ëŠ” í† í”½:                                       â”‚
â”‚                                                          â”‚
â”‚  1ï¸âƒ£ healthcare.chat-events                             â”‚
â”‚     - chat_completed: ì±„íŒ… ì™„ë£Œ ì‹œ                      â”‚
â”‚     - persona_conversation: í˜ë¥´ì†Œë‚˜ ëŒ€í™” ê¸°ë¡          â”‚
â”‚                                                          â”‚
â”‚  2ï¸âƒ£ healthcare.health-records                          â”‚
â”‚     - health_analysis_complete: ê±´ê°• ë¶„ì„ ì™„ë£Œ          â”‚
â”‚     - anomaly_detected: ì´ìƒ ê°ì§€ ì•Œë¦¼                  â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

### 3ï¸âƒ£ í†µí•© ì»¨í…ìŠ¤íŠ¸ ë¹Œë”

```java
// healthcare_AIchatbot_service/src/main/java/com/healthcareai/service/ContextBuilderService.java

@Service
public class ContextBuilderService {
    
    @Autowired private BehaviorCache behaviorCache;           // Diary ë°ì´í„°
    @Autowired private PetProfileCache petProfileCache;       // User ë°ì´í„°
    @Autowired private SocialCache socialCache;               // Social ë°ì´í„°
    @Autowired private HeartHealthRecordRepository healthRepo; // Healthcare ë°ì´í„°
    
    /**
     * 4ê°œ MSA ì„œë¹„ìŠ¤ì˜ ë°ì´í„°ë¥¼ í†µí•©í•œ ì™„ì „í•œ ì»¨í…ìŠ¤íŠ¸ ìƒì„±
     * WHY: AIê°€ í«ì˜ ì „ì²´ ìƒíƒœë¥¼ ì´í•´í•˜ê³  ë‹µë³€í•˜ë„ë¡
     */
    public String buildCompleteContext(Long userId, Long petId) {
        StringBuilder context = new StringBuilder();
        
        // 1ï¸âƒ£ Pet Profile (User Service â†’ Kafka)
        context.append("[PET PROFILE]\n");
        PetProfile profile = petProfileCache.get(petId);
        context.append(String.format(
            "Name: %s (%s, %d years old, %.1fkg)\n" +
            "Personality: %s\n" +
            "Medical History: %s\n\n",
            profile.getName(),
            profile.getBreed(),
            profile.getAge(),
            profile.getWeight(),
            profile.getPersonality(),
            String.join(", ", profile.getMedicalHistory())
        ));
        
        // 2ï¸âƒ£ Healthcare Data (ìì²´ DB)
        context.append("[HEALTHCARE STATUS]\n");
        List<HeartHealthRecord> recentHealth = 
            healthRepo.findTop3ByPetIdOrderByRecordedAtDesc(petId);
        
        if (!recentHealth.isEmpty()) {
            HeartHealthRecord latest = recentHealth.get(0);
            context.append(String.format(
                "Latest Check: %s\n" +
                "Heart Rate: %d bpm (Normal: 75-110)\n" +
                "Status: %s\n" +
                "AI Summary: %s\n\n",
                latest.getRecordedAt(),
                latest.getHeartRate(),
                latest.getIsAbnormal() ? "âš ï¸ ABNORMAL" : "âœ“ Normal",
                latest.getAiSummary()
            ));
        }
        
        // 3ï¸âƒ£ Behavior Data (Diary Service â†’ Kafka)
        context.append("[BEHAVIORAL DATA]\n");
        BehaviorData behavior = behaviorCache.get(petId);
        if (behavior != null) {
            context.append(String.format(
                "Mood: %s\n" +
                "Activity Level: %s\n" +
                "Eating: %s\n" +
                "Sleep: %s\n" +
                "Recent Notes: %s\n\n",
                behavior.getMood(),
                behavior.getActivityLevel(),
                behavior.getEatingPattern(),
                behavior.getSleepPattern(),
                behavior.getBehaviorNotes()
            ));
        }
        
        // 4ï¸âƒ£ Social Activity (Social Service â†’ Kafka)
        context.append("[SOCIAL ACTIVITY]\n");
        SocialActivity social = socialCache.get(petId);
        if (social != null) {
            context.append(String.format(
                "Friends: %d dogs\n" +
                "Recent Activity: %s\n" +
                "Socialization Level: %s\n\n",
                social.getFriendCount(),
                social.getRecentInteraction(),
                social.getSocialActivity()
            ));
        }
        
        log.info("âœ… Complete context built for petId: {} (size: {} chars)", 
                 petId, context.length());
        
        return context.toString();
    }
}
```


***

### 4ï¸âƒ£ AI ëª¨ë¸ ì„ íƒ ë° ì²˜ë¦¬

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Claude AI ì²˜ë¦¬ ë¡œì§                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ì‚¬ìš©ì ìš”ì²­ ë¶„ë¥˜:                                          â”‚
â”‚                                                             â”‚
â”‚  chatType == "general"                                      â”‚
â”‚  â””â”€> Claude 3.5 Haiku                                      â”‚
â”‚      â”œâ”€ ëª©ì : ì¼ë°˜ ìˆ˜ì˜ì‚¬ ìƒë‹´                             â”‚
â”‚      â”œâ”€ ì†ë„: 200-400ms                                    â”‚
â”‚      â”œâ”€ ì»¨í…ìŠ¤íŠ¸: 4ê°œ ì„œë¹„ìŠ¤ í†µí•© ë°ì´í„°                   â”‚
â”‚      â””â”€ ë¹„ìš©: ~$0.003/íšŒ                                   â”‚
â”‚                                                             â”‚
â”‚  chatType == "persona"                                      â”‚
â”‚  â””â”€> Claude 3.5 Sonnet                                     â”‚
â”‚      â”œâ”€ ëª©ì : í« í˜ë¥´ì†Œë‚˜ ëŒ€í™”                             â”‚
â”‚      â”œâ”€ ì†ë„: 800-1200ms                                   â”‚
â”‚      â”œâ”€ ì»¨í…ìŠ¤íŠ¸: 4ê°œ ì„œë¹„ìŠ¤ + ëŒ€í™” ê¸°ì–µ                   â”‚
â”‚      â”œâ”€ 3D ì•„ë°”íƒ€: Tripo3D ì—°ë™                            â”‚
â”‚      â””â”€ ë¹„ìš©: ~$0.009/íšŒ                                   â”‚
â”‚                                                             â”‚
â”‚  chatType == "health_analysis"                              â”‚
â”‚  â””â”€> Claude 3.5 Sonnet + RAG (ë¯¸ë˜)                        â”‚
â”‚      â”œâ”€ ëª©ì : ì˜ë£Œ ë¶„ì„                                    â”‚
â”‚      â”œâ”€ ì†ë„: 1000-2000ms                                  â”‚
â”‚      â”œâ”€ ì»¨í…ìŠ¤íŠ¸: Healthcare + Milvus ê²€ìƒ‰ ê²°ê³¼            â”‚
â”‚      â””â”€ ë¹„ìš©: ~$0.012/íšŒ                                   â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

### 5ï¸âƒ£ í”„ë¡¬í”„íŠ¸ ìƒì„± ì˜ˆì‹œ

```
=== General Chatbot Prompt (ëª¨ë“  ë°ì´í„° í†µí•©) ===

You are an experienced veterinarian (10 years).
You are consulting with a dog owner about their pet.

[PET PROFILE]
Name: ë½€ì‚ (Maltese, 5 years old, 3.5kg)
Personality: Active, friendly, sociable
Medical History: Vaccinated, Neutered

[HEALTHCARE STATUS]
Latest Check: 2025-01-03 10:30
Heart Rate: 95 bpm (Normal: 75-110)
Status: âœ“ Normal
AI Summary: ë½€ì‚ì˜ ì‹¬ë°•ìˆ˜ëŠ” ì •ìƒ ë²”ìœ„ì…ë‹ˆë‹¤...

[BEHAVIORAL DATA] â† Diary Service
Mood: í¸ì•ˆí•¨
Activity Level: í™œë™ì 
Eating: ì •ìƒ
Sleep: 8ì‹œê°„
Recent Notes: ì˜¤ëŠ˜ ì‚°ì±… ë§ì´ í•¨

[SOCIAL ACTIVITY] â† Social Service
Friends: 5 dogs
Recent Activity: ì–´ì œ ê³µì›ì—ì„œ ë†€ìŒ
Socialization Level: ì‚°ì±… ë©”ì´íŠ¸ 3íšŒ

[INSTRUCTIONS]
- Consider ALL provided context when answering
- Reference recent health checks if relevant
- Mention behavioral patterns when applicable
- Use Korean, professional but friendly tone
- If serious symptoms, recommend vet visit

Owner Question: ìš°ë¦¬ ë½€ì‚ê°€ ìš”ì¦˜ í”¼ê³¤í•´ ë³´ì´ëŠ”ë° ê´œì°®ë‚˜ìš”?

Your Response:
```


***

### 6ï¸âƒ£ ì™¸ë¶€ AI ë„êµ¬ í†µí•©

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tripo3D (3D ì•„ë°”íƒ€ ìƒì„±)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  ì…ë ¥: User Serviceì—ì„œ í« ì‚¬ì§„ URL             â”‚
â”‚  ì²˜ë¦¬: Image â†’ 3D Model (~20ì´ˆ)                â”‚
â”‚  ì¶œë ¥: GLB íŒŒì¼ â†’ S3 ì €ì¥                      â”‚
â”‚  ì—°ë™: Persona Chatbotì—ì„œ 3D ì•„ë°”íƒ€ í‘œì‹œ       â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Milvus (RAG ë²¡í„° ê²€ìƒ‰) - ë¯¸ë˜                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                â”‚
â”‚  Collection 1: Veterinary Knowledge            â”‚
â”‚  â”œâ”€ ì˜ë£Œ ë¬¸ì„œ ì„ë² ë”©                           â”‚
â”‚  â””â”€ ìœ ì‚¬ë„ ê²€ìƒ‰ (Top-5)                        â”‚
â”‚                                                â”‚
â”‚  Collection 2: Pet Health History              â”‚
â”‚  â”œâ”€ ê³¼ê±° ê±´ê°• ê¸°ë¡ ë²¡í„°í™”                      â”‚
â”‚  â””â”€ ìœ ì‚¬ ì¼€ì´ìŠ¤ ê²€ìƒ‰                           â”‚
â”‚                                                â”‚
â”‚  ì—°ë™: Health Analysisì—ì„œ ì˜ë£Œ ì§€ì‹ ê°•í™”       â”‚
â”‚                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


***

## ğŸ“ˆ í† í° ë° ë¹„ìš© ì¶”ì 

```java
@Service
public class TokenCountingService {
    
    /**
     * 4ê°œ ì„œë¹„ìŠ¤ í†µí•© ì»¨í…ìŠ¤íŠ¸ì˜ í† í° ê³„ì‚°
     */
    public TokenMetrics calculateTokens(String context, String response) {
        
        // ì»¨í…ìŠ¤íŠ¸ í† í° (4ê°œ ì„œë¹„ìŠ¤ í†µí•©)
        int contextTokens = countTokens(context);
        // Pet Profile: ~100 í† í°
        // Healthcare: ~200 í† í°
        // Behavior (Diary): ~150 í† í°
        // Social: ~100 í† í°
        // = í‰ê·  550 í† í°
        
        // System Prompt: ~300 í† í°
        // User Message: ~50 í† í°
        // = ì´ ì…ë ¥: ~900 í† í°
        
        int inputTokens = contextTokens + systemPromptTokens + userMessageTokens;
        int outputTokens = countTokens(response); // ~150-300 í† í°
        
        // ë¹„ìš© ê³„ì‚°
        double cost = calculateCost(inputTokens, outputTokens, modelType);
        
        return TokenMetrics.builder()
            .inputTokens(inputTokens)
            .outputTokens(outputTokens)
            .totalTokens(inputTokens + outputTokens)
            .costUsd(cost)
            .contextBreakdown(Map.of(
                "petProfile", 100,
                "healthcare", 200,
                "behavior", 150,
                "social", 100,
                "systemPrompt", 300,
                "userMessage", 50
            ))
            .build();
    }
}
```


***

## ğŸ”„ ì‹¤ì‹œê°„ ì—…ë°ì´íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

```
ì‹œë‚˜ë¦¬ì˜¤: ì‚¬ìš©ìê°€ Diaryì— "ì˜¤ëŠ˜ ë½€ì‚ê°€ ì‚°ì±… ë§ì´ í•¨" ê¸°ë¡

1ï¸âƒ£ Diary Service
   â””â”€ POST /api/diary
   â””â”€ DB ì €ì¥
   â””â”€ Kafka ë°œí–‰: diary.events

2ï¸âƒ£ Healthcare Service (KafkaConsumer)
   â””â”€ ì´ë²¤íŠ¸ ìˆ˜ì‹ 
   â””â”€ behaviorCache.put(petId, diaryData)
   â””â”€ ë¡œê·¸: "ğŸ“” Diary data cached"

3ï¸âƒ£ ì‚¬ìš©ìê°€ ì±—ë´‡ì— ì§ˆë¬¸ (5ë¶„ í›„)
   â””â”€ "ë½€ì‚ê°€ ì˜¤ëŠ˜ í”¼ê³¤í•´ ë³´ì—¬"

4ï¸âƒ£ ContextBuilder
   â””â”€ behaviorCacheì—ì„œ ìµœì‹  ë°ì´í„° ì¡°íšŒ
   â””â”€ "ì˜¤ëŠ˜ ì‚°ì±… ë§ì´ í•¨" í¬í•¨
   â””â”€ ì»¨í…ìŠ¤íŠ¸ ìƒì„±

5ï¸âƒ£ Claude AI (Haiku)
   â””â”€ í”„ë¡¬í”„íŠ¸: "Recent Notes: ì˜¤ëŠ˜ ì‚°ì±… ë§ì´ í•¨"
   â””â”€ ì‘ë‹µ: "ì˜¤ëŠ˜ ì‚°ì±…ì„ ë§ì´ í•´ì„œ í”¼ê³¤í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤..."

6ï¸âƒ£ ì‚¬ìš©ìì—ê²Œ ì •í™•í•œ ë‹µë³€ ì „ë‹¬ âœ…
```


***

## ğŸ“Š ì „ì²´ ì•„í‚¤í…ì²˜ ìš”ì•½

| ë ˆì´ì–´ | êµ¬ì„± ìš”ì†Œ | ì—­í•  |
| :-- | :-- | :-- |
| **ë°ì´í„° ì†ŒìŠ¤** | Diary, User, Social, Healthcare | í« ì „ì²´ ì •ë³´ ìˆ˜ì§‘ |
| **ì‹¤ì‹œê°„ ë™ê¸°í™”** | Kafka (4ê°œ í† í”½) | MSA ê°„ ì´ë²¤íŠ¸ ê¸°ë°˜ í†µì‹  |
| **ì»¨í…ìŠ¤íŠ¸ í†µí•©** | ContextBuilder + Cache | 4ê°œ ì„œë¹„ìŠ¤ ë°ì´í„° ë³‘í•© |
| **AI ì²˜ë¦¬** | Claude Haiku/Sonnet | ë“€ì–¼ ëª¨ë¸ ì „ëµ |
| **ì™¸ë¶€ AI** | Tripo3D, Milvus | 3D ìƒì„±, RAG ê²€ìƒ‰ |
| **ëª¨ë‹ˆí„°ë§** | TokenCounter + Metrics | ë¹„ìš©/ì„±ëŠ¥ ì¶”ì  |


***

ì´ì œ **Diaryë¥¼ í¬í•¨í•œ ëª¨ë“  MSA ë°ì´í„°ê°€ AI ì±—ë´‡ì˜ ì§€ì‹ìœ¼ë¡œ í†µí•©**ë©ë‹ˆë‹¤! ğŸ¯ğŸš€

ê¶ê¸ˆí•œ ì  ìˆìœ¼ë©´ ë§ì”€í•´ì£¼ì„¸ìš”!
<span style="display:none">[^13_1][^13_2][^13_3][^13_4][^13_5][^13_6][^13_7][^13_8][^13_9]</span>

<div align="center">â‚</div>

[^13_1]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/729151ce-4781-40ff-b520-37e4275321e9/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^13_2]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/c4310062-aa34-4558-a354-6ec885813bf8/helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^13_3]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^13_4]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^13_5]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/cf3221c1-35ca-4fe7-9bd9-d536c00312b4/naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gijonyi-daehwagirogeul-1.pdf

[^13_6]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/0386e670-6f3f-4c21-a9bd-215cae99b9ea/ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^13_7]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/b2635d46-b09b-428f-8f6c-07f34478d84b/hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-jeonbu-bunseog-1.md

[^13_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^13_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg


---

# ë‚˜ ê¶ê¸ˆí•œê±° ë˜ìˆì–´ ì§€ê¸ˆ milvusë§Œ ì‚¬ìš©í•˜ëŠ”ì¤‘ì´ì–ì•„ ê·¼ë° amazon titan embeddingsëŠ” ì•ˆì¨ë„ë˜ëŠ”ê±°ì•¼? embeddingsì™€ ì²­í‚¹ì„ í• ë ¤ë©´ ë„ˆë¬´ ì˜¤ë˜ê±¸ë¦¬ëŠ”ê±°ì§€?

ì¢‹ì€ ì§ˆë¬¸ì´ì•¼! ì•„ì£¼ í•µì‹¬ì ì¸ ë‚´ìš©ì´ë„¤. ì§€ê¸ˆ í˜„ì¬ ì„¤ì •ì„ ë¶„ì„í•˜ê³  **WHY**ì— ëŒ€í•´ ì •í™•íˆ ì„¤ëª…í•´ì¤„ê²Œ.[^14_1][^14_2]

***

## ğŸ” í˜„ì¬ ìƒí™© ë¶„ì„

### í˜„ì¬ Healthcare Serviceì—ì„œ ì‚¬ìš© ì¤‘ì¸ êµ¬ì¡°

```
ğŸ“Š í˜„ì¬ ì•„í‚¤í…ì²˜

1ï¸âƒ£ Diary Serviceì—ì„œ ì¼ê¸° ìƒì„±
   â””â”€> Kafkaë¡œ diary-events ë°œí–‰

2ï¸âƒ£ Healthcare Service Kafka Consumer
   â””â”€> ì¼ê¸° í…ìŠ¤íŠ¸ ìˆ˜ì‹ 

3ï¸âƒ£ AWS Titan Embeddings V2 í˜¸ì¶œ
   â””â”€> í…ìŠ¤íŠ¸ â†’ ë²¡í„° ë³€í™˜ (1536 dimension)
   â””â”€> ì‘ë‹µ ì‹œê°„: ì•½ 200-500ms

4ï¸âƒ£ Milvus Vector DB ì €ì¥
   â””â”€> petId, userId, diaryId, text, vector ì €ì¥
   â””â”€> ì‚½ì… ì‹œê°„: ì•½ 20-40ms

5ï¸âƒ£ Persona Chat ì‹œ Vector Search
   â””â”€> ì§ˆë¬¸ â†’ Titan Embeddings â†’ Milvus ê²€ìƒ‰
   â””â”€> Top 3 ìœ ì‚¬ ì¼ê¸° ë°˜í™˜
```


***

## â“ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€

### Q1: Amazon Titan EmbeddingsëŠ” ì•ˆì¨ë„ ë˜ëŠ”ê±°ì•¼?

**A: ì•„ë‹ˆì•¼, ë°˜ë“œì‹œ ì¨ì•¼í•´!**[^14_3][^14_4]

#### WHY Titan Embeddingsê°€ í•„ìˆ˜ì¸ê°€?

```
ğŸ¯ Titan Embeddingsì˜ ì—­í• 

1ï¸âƒ£ í…ìŠ¤íŠ¸ â†’ ìˆ«ì ë²¡í„° ë³€í™˜
   "ì˜¤ëŠ˜ ë½€ì‚ê°€ ì‚°ì±…ì„ ë§ì´ í–ˆì–´ìš”"
   â†“ Titan Embeddings
   [0.23, -0.45, 0.87, ..., 0.12] (1536ê°œ ìˆ«ì)

2ï¸âƒ£ ì˜ë¯¸ì  ìœ ì‚¬ë„ ê³„ì‚° ê°€ëŠ¥
   - "ì‚°ì±… ë§ì´ í–ˆì–´ìš”" â‰ˆ "ìš´ë™ì„ ì—´ì‹¬íˆ í–ˆì–´ìš”"
   - Cosine Similarityë¡œ 0.92 ìœ ì‚¬ë„

3ï¸âƒ£ Milvusì—ì„œ Vector Search ìˆ˜í–‰
   - ì‚¬ìš©ì ì§ˆë¬¸: "ë½€ì‚ ìµœê·¼ í™œë™ëŸ‰ì€?"
   - Top 3 ìœ ì‚¬ ì¼ê¸° ê²€ìƒ‰
```


#### Titan ì—†ì´ Milvusë§Œ ì‚¬ìš©í•˜ë©´?

```
âŒ ë¶ˆê°€ëŠ¥í•œ ì´ìœ 

MilvusëŠ” Vector Databaseì¼ ë¿!
- ë²¡í„°ë¥¼ ì €ì¥í•˜ê³  ê²€ìƒ‰í•˜ëŠ” DB
- í…ìŠ¤íŠ¸ë¥¼ ë²¡í„°ë¡œ ë³€í™˜í•˜ëŠ” ê¸°ëŠ¥ ì—†ìŒ

ê²°ë¡ :
Titan Embeddings = ë³€í™˜ ì—”ì§„
Milvus = ì €ì¥ ë° ê²€ìƒ‰ DB
```


***

### Q2: Embeddingsì™€ ì²­í‚¹ì„ í• ë ¤ë©´ ë„ˆë¬´ ì˜¤ë˜ê±¸ë¦¬ëŠ”ê±°ì§€?

**A: ë„¤, ë§ì•„. í•˜ì§€ë§Œ ìš°ë¦¬ëŠ” "ë¹„ë™ê¸° ì²˜ë¦¬"ë¡œ í•´ê²°í–ˆì–´!**[^14_5][^14_6]

#### ì‹¤ì œ ì‹œê°„ ì¸¡ì •

```
â±ï¸ RAG Pipeline ì†Œìš” ì‹œê°„

ã€ë™ê¸° ë°©ì‹ - ë§Œì•½ ì±„íŒ… ì‹œ ì²˜ë¦¬í•œë‹¤ë©´ã€‘
1. ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
2. Titan Embeddings í˜¸ì¶œ (200-500ms) â°
3. Milvus ê²€ìƒ‰ (20-40ms) â°
4. Claude Sonnet í˜¸ì¶œ (2000-4000ms) â°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ ì‘ë‹µ ì‹œê°„: 2.2 ~ 4.5ì´ˆ âŒ ë„ˆë¬´ ëŠë¦¼!

ã€ë¹„ë™ê¸° ë°©ì‹ - ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ã€‘
âœ… ì‚¬ì „ì— Embedding ì™„ë£Œ (Kafka Consumer)

Diary ì‘ì„± ì‹œì  (ì‚¬ìš©ìê°€ ì±„íŒ…í•˜ê¸° ì „):
1. ì¼ê¸° ì €ì¥
2. Kafka ë°œí–‰ â†’ Healthcare Service
3. Titan Embeddings (200-500ms) ë°±ê·¸ë¼ìš´ë“œ ì²˜ë¦¬
4. Milvus ì €ì¥ (20-40ms)
   â””â”€> ì´ë¯¸ ì™„ë£Œ! ì €ì¥ë¨!

Persona Chat ì‹œì  (ì‚¬ìš©ìê°€ ì‹¤ì œ ì§ˆë¬¸):
1. ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
2. ì§ˆë¬¸ë§Œ Titan Embeddings (200-500ms) â°
3. Milvus ê²€ìƒ‰ (20-40ms) â° - ì´ë¯¸ ì €ì¥ëœ ë²¡í„° ê²€ìƒ‰
4. Claude Sonnet í˜¸ì¶œ (2000-4000ms) â°
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ì´ ì‘ë‹µ ì‹œê°„: 2.2 ~ 4.5ì´ˆ

í•˜ì§€ë§Œ ì‹¤ì œ ì²´ê°:
- 50ê°œ ì¼ê¸°ê°€ ì´ë¯¸ ë²¡í„°í™”ë˜ì–´ ì €ì¥ë¨
- ê²€ìƒ‰ë§Œ í•˜ë©´ ë¨ (ë§¤ìš° ë¹ ë¦„!)
```


***

## ğŸš€ ì„±ëŠ¥ ìµœì í™” ì „ëµ

### ìš°ë¦¬ê°€ ì ìš©í•œ ë°©ë²•

```java
/**
 * ë¹„ë™ê¸° Embedding ì²˜ë¦¬ íŒ¨í„´
 * WHY: ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”
 */

// âœ… Good: ì‚¬ì „ ì²˜ë¦¬ (Kafka Consumer)
@KafkaListener(topics = "diary-events")
public void processDiaryEvent(DiaryEvent event) {
    // ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì²˜ë¦¬ - ì‚¬ìš©ìëŠ” ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ
    CompletableFuture.runAsync(() -> {
        float[] vector = titanEmbeddings.embed(event.getContent());
        milvusDB.insert(event.getPetId(), vector, event.getContent());
    });
}

// âœ… Good: ì±„íŒ… ì‹œ ê²€ìƒ‰ë§Œ ìˆ˜í–‰
public String personaChat(String question, Long petId) {
    // 1. ì§ˆë¬¸ë§Œ Embedding (200-500ms) - í”¼í•  ìˆ˜ ì—†ìŒ
    float[] questionVector = titanEmbeddings.embed(question);
    
    // 2. Milvus ê²€ìƒ‰ (20-40ms) - ë§¤ìš° ë¹ ë¦„!
    List<String> relatedDiaries = milvusDB.search(questionVector, petId, 3);
    
    // 3. Claude í˜¸ì¶œ
    return claudeSonnet.chat(buildContext(relatedDiaries, question));
}
```


***

## ğŸ“Š Titan Embeddings V2 ì„±ëŠ¥ ìµœì í™”

### Dimension ì„ íƒ ì „ëµ[^14_4]

```
ğŸ¯ Titan Text Embeddings V2 ì˜µì…˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Dimension  â”‚ ì •í™•ë„   â”‚ ì €ì¥ê³µê°„â”‚ ì†ë„           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1536 (V1)  â”‚ 100%     â”‚ 100%    â”‚ ê¸°ì¤€           â”‚
â”‚ 1024       â”‚ 100%     â”‚ 67%     â”‚ +10% ë¹ ë¦„      â”‚
â”‚ 512        â”‚ 99%      â”‚ 33%     â”‚ +20% ë¹ ë¦„      â”‚
â”‚ 256        â”‚ 97%      â”‚ 17%     â”‚ +30% ë¹ ë¦„      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ’¡ ê¶Œì¥ ì‚¬í•­:
- í˜„ì¬: 1536 dimension (default)
- ìµœì í™”: 512 dimension
  â†’ 99% ì •í™•ë„ ìœ ì§€
  â†’ ìŠ¤í† ë¦¬ì§€ 67% ì ˆê°
  â†’ ì‘ë‹µì†ë„ 20% í–¥ìƒ
```


### ì½”ë“œ ìµœì í™” ì œì•ˆ

```java
// healthcare_AIchatbot_service_backend/src/main/java/config/TitanConfig.java

@Configuration
public class TitanEmbeddingsConfig {
    
    /**
     * Titan V2 ìµœì í™” ì„¤ì •
     * WHY: 512 dimensionìœ¼ë¡œ 99% ì •í™•ë„ ìœ ì§€í•˜ë©´ì„œ ì†ë„ 20% í–¥ìƒ
     */
    @Bean
    public TitanEmbeddingsSettings titanSettings() {
        return TitanEmbeddingsSettings.builder()
                .dimensions(512)  // 1536 â†’ 512ë¡œ ë³€ê²½
                .normalize(true)  // RAGì— ìµœì í™”
                .build();
    }
}

// EmbeddingService.java ìˆ˜ì •
@Service
public class EmbeddingService {
    
    public float[] generateEmbedding(String text) {
        String payload = String.format("""
            {
                "inputText": "%s",
                "dimensions": 512,
                "normalize": true
            }
            """, text.replace("\"", "\\\""));
            
        // ... Bedrock í˜¸ì¶œ
        return vector; // 512 dimension
    }
}
```


***

## ğŸ’° ë¹„ìš© ë¹„êµ

```
ğŸ“Š Titan Embeddings V2 ë¹„ìš© [web:102]

1ï¸âƒ£ Embedding ìƒì„± ë¹„ìš©
   - V1: $0.0002 / 1K tokens
   - V2: $0.000029 / 1K tokens
   â””â”€> V2ê°€ 86% ì €ë ´!

2ï¸âƒ£ ìš°ë¦¬ í”„ë¡œì íŠ¸ ì˜ˆìƒ ë¹„ìš©
   - ì¼ê¸° 50ê°œ Ã— í‰ê·  200 tokens = 10K tokens
   - V2 ë¹„ìš©: $0.00029 (0.4ì›)
   - ì›” 1000ëª… ì‚¬ìš© ì‹œ: $0.29 (ì•½ 400ì›)
   â””â”€> ê±°ì˜ ë¬´ë£Œ ìˆ˜ì¤€!

3ï¸âƒ£ Milvus ì €ì¥ ë¹„ìš© (EC2 t3.small ê¸°ì¤€)
   - 512 dimension: 2KB/ë²¡í„°
   - 50ê°œ ì¼ê¸°: 100KB
   - 1000ëª…: 100MB
   â””â”€> ì €ì¥ê³µê°„ ë¬¸ì œ ì—†ìŒ!
```


***

## ğŸ”„ ì „ì²´ íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
ğŸ“± ì‚¬ìš©ì ì•¡ì…˜                     ğŸ”§ ë°±ì—”ë“œ ì²˜ë¦¬
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[ì¼ê¸° ì‘ì„± ì‹œì ] - ë¹„ë™ê¸° ì²˜ë¦¬
User â†’ Diary Service
       â””â”€> "ì˜¤ëŠ˜ ë½€ì‚ ì‚°ì±… 30ë¶„"
       â””â”€> PostgreSQL ì €ì¥
       â””â”€> Kafka ë°œí–‰ â”â”â”â”â”â”“
                           â†“
                     Healthcare Service
                     Kafka Consumer
                           â†“
                     Titan Embeddings (500ms)
                     í…ìŠ¤íŠ¸ â†’ ë²¡í„° ë³€í™˜
                           â†“
                     Milvus ì €ì¥ (40ms)
                     âœ… ì™„ë£Œ! (ì‚¬ìš©ìëŠ” ëª¨ë¦„)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

[ì±„íŒ… ì‹œì ] - ë™ê¸° ì²˜ë¦¬ (ì‚¬ìš©ì ëŒ€ê¸°)
User â†’ Healthcare Service
       "ë½€ì‚ ìµœê·¼ í™œë™ì€?"
              â†“
       Titan Embeddings (500ms) â°
       ì§ˆë¬¸ â†’ ë²¡í„° ë³€í™˜
              â†“
       Milvus ê²€ìƒ‰ (40ms) â°
       Top 3 ìœ ì‚¬ ì¼ê¸° ê²€ìƒ‰
       (ì´ë¯¸ ì €ì¥ëœ 50ê°œ ë²¡í„° ê²€ìƒ‰)
              â†“
       Context êµ¬ì„±
       - Pet Profile (User Service)
       - Recap (Diary Service)
       - Related Diaries (Milvus ê²°ê³¼)
              â†“
       Claude Sonnet (3000ms) â°
              â†“
       "ë½€ì‚ëŠ” ìµœê·¼ ì‚°ì±…ì„..." âœ…

ì´ ì‘ë‹µ ì‹œê°„: ì•½ 3.5ì´ˆ
```


***

## ğŸ¯ ê²°ë¡  ë° ê¶Œì¥ ì‚¬í•­

### í˜„ì¬ ì•„í‚¤í…ì²˜ í‰ê°€

```
âœ… ì˜í•œ ì :
1. Kafka ë¹„ë™ê¸° ì²˜ë¦¬ë¡œ ì‚¬ìš©ì ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”
2. Milvus Vector DBë¡œ ë¹ ë¥¸ ê²€ìƒ‰
3. Titan Embeddingsë¡œ ì˜ë¯¸ì  ê²€ìƒ‰ êµ¬í˜„

âš ï¸ ê°œì„  ê°€ëŠ¥í•œ ì :
1. Dimension ìµœì í™”: 1536 â†’ 512
   â””â”€> 99% ì •í™•ë„ ìœ ì§€, ì†ë„ 20% í–¥ìƒ
   
2. Batch Embedding: ì¼ê¸° ì—¬ëŸ¬ ê°œ í•œë²ˆì— ì²˜ë¦¬
   â””â”€> API í˜¸ì¶œ íšŸìˆ˜ ê°ì†Œ
   
3. ìºì‹± ì „ëµ: ìì£¼ ê²€ìƒ‰ë˜ëŠ” ë²¡í„° Redis ìºì‹œ
   â””â”€> Milvus ë¶€í•˜ ê°ì†Œ
```


### ìµœì¢… ë‹µë³€

```
Q: Titan Embeddings ì•ˆì¨ë„ ë˜ë‚˜ìš”?
A: âŒ í•„ìˆ˜ì…ë‹ˆë‹¤!
   - MilvusëŠ” ì €ì¥ë§Œ, Titanì€ ë³€í™˜ ë‹´ë‹¹
   - RAGì˜ í•µì‹¬ ì»´í¬ë„ŒíŠ¸

Q: ì²­í‚¹ì´ ì˜¤ë˜ ê±¸ë¦¬ë‚˜ìš”?
A: â±ï¸ 500ms ì •ë„ ê±¸ë¦¬ì§€ë§Œ:
   - Kafkaë¡œ ë¹„ë™ê¸° ì²˜ë¦¬ (ë°±ê·¸ë¼ìš´ë“œ)
   - ì‚¬ìš©ìëŠ” ëŒ€ê¸° ì•ˆí•¨
   - ì±„íŒ… ì‹œì—” ì´ë¯¸ ì €ì¥ëœ ë²¡í„° ê²€ìƒ‰ë§Œ
   
ğŸ’¡ í˜„ì§ ìˆ˜ì¤€ ìµœì í™”:
   - 512 dimension ì‚¬ìš© (99% ì •í™•ë„)
   - Batch ì²˜ë¦¬ë¡œ íš¨ìœ¨ ê·¹ëŒ€í™”
   - ë¹„ë™ê¸° íŒ¨í„´ìœ¼ë¡œ UX ê°œì„ 
```


***

## ğŸ“ ë‹¤ìŒ ë‹¨ê³„ ì œì•ˆ

```
1ï¸âƒ£ Dimension ìµœì í™” êµ¬í˜„
   â””â”€> TitanConfig.java ìˆ˜ì •
   â””â”€> Milvus Collection ì¬ìƒì„±

2ï¸âƒ£ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ ì¶”ê°€
   â””â”€> Embedding ì‹œê°„ ì¸¡ì •
   â””â”€> Milvus ê²€ìƒ‰ ì‹œê°„ ë¡œê¹…

3ï¸âƒ£ ë¶€í•˜ í…ŒìŠ¤íŠ¸
   â””â”€> JMeterë¡œ 1000 RPS í…ŒìŠ¤íŠ¸
   â””â”€> Latency 95 percentile í™•ì¸
```

í˜¹ì‹œ Dimension ìµœì í™” êµ¬í˜„ì´ë‚˜ ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ í•„ìš”í•˜ë©´ ë§í•´ì¤˜! ğŸš€
<span style="display:none">[^14_10][^14_11][^14_12][^14_13][^14_14][^14_15][^14_16][^14_17][^14_18][^14_19][^14_20][^14_21][^14_22][^14_23][^14_24][^14_25][^14_26][^14_27][^14_28][^14_29][^14_30][^14_31][^14_32][^14_33][^14_34][^14_35][^14_36][^14_37][^14_38][^14_39][^14_40][^14_41][^14_42][^14_43][^14_44][^14_45][^14_46][^14_47][^14_48][^14_49][^14_7][^14_8][^14_9]</span>

<div align="center">â‚</div>

[^14_1]: helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^14_2]: naega-jigeum-jeon-sseuredeuga-neomu-gileojyeoseo-jigeum-dasi-saeroun-geolro-galataneungeonde-gij.pdf

[^14_3]: https://aws.amazon.com/ko/blogs/korea/amazon-titan-text-v2-now-available-in-amazon-bedrock-optimized-for-improving-rag/

[^14_4]: https://aws.amazon.com/jp/blogs/aws/amazon-titan-text-v2-now-available-in-amazon-bedrock-optimized-for-improving-rag/

[^14_5]: https://milvus.io/blog/we-benchmarked-20-embedding-apis-with-milvus-7-insights-that-will-surprise-you.md

[^14_6]: https://milvus.io/ko/blog/we-benchmarked-20-embedding-apis-with-milvus-7-insights-that-will-surprise-you.md

[^14_7]: helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf

[^14_8]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/1dbcad29-381a-408c-bac7-ef8641695a8e/peurojegteu-peurejenteisyeon.pptx

[^14_9]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/collection_ff7f9055-cfcd-4088-b6e8-898b668c6164/f9379953-ee89-4387-b18a-2d51ea8ad418/suhaenggyehoegseo-2.docx

[^14_10]: ani-igeo-ige-jeonsseuredeu-naeyonginigga-camgohaejweo.md

[^14_11]: hogsigeureom-helseukeeo-caesbos-seobiseu-MSA-akitegceo-gaebal-rodeumaeb.pdf-igeoneun-naeyongeul-j.md

[^14_12]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75ab3657-2616-4065-9252-6018a0a5d147/image.jpg

[^14_13]: https://ppl-ai-file-upload.s3.amazonaws.com/web/direct-files/attachments/images/51992492/75830147-b022-4c48-87ad-a1e9758afe1e/image.jpg

[^14_14]: https://lifet.co.kr/Chat/List/25/F2DEC683CF7B4063A9F06A4FA8C0A82F

[^14_15]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ìˆ˜ì •ì²´ íƒˆêµ¬ì— ëŒ€í•´

[^14_16]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ë°©ê´‘ì—¼ A to Z

[^14_17]: https://lifet.co.kr/Contents/Detail/ì•ŒíŒŒ-ì¹´ì†Œì œí•€ A to Z

[^14_18]: https://www.lifet.co.kr/Contents/Detail/ë½í‹°ì›€ A to Z

[^14_19]: https://lifet.co.kr/Contents/Detail/GABA A to Z

[^14_20]: https://lifet.co.kr/Contents/Detail/íŠ¸ë¦½í† íŒ A to Z

[^14_21]: https://lifet.co.kr/Contents/Detail/ë¹„íƒ€ë¯¼D A to Z

[^14_22]: https://lifet.co.kr/Store/Product/Detail?productCode=P00311

[^14_23]: https://lifet.co.kr/Store/Home

[^14_24]: https://www.lifet.co.kr/Contents/Detail/í…Œì•„ë‹Œ A to Z

[^14_25]: https://lifet.co.kr/Contents/Detail/ê³ ì–‘ì´ ë‹¹ë‡¨ì— ëŒ€í•´ì„œ

[^14_26]: https://lifet.co.kr/Contents/Detail/í‚¤í† ì‚° A to Z

[^14_27]: https://www.lifet.co.kr/Contents/Detail/ì·Œì¥íš¨ì†Œ A to Z

[^14_28]: https://www.lifet.co.kr/Contents/Detail/ê³ ì–‘ì´ê°€ ìê¾¸ ê¹¨ë¬¼ì–´ìš”! ì…ì§ˆ êµì •í•˜ê¸°

[^14_29]: https://lifet.co.kr/Contents/Detail/ì½”ë°œë¼ë¯¼ A to Z

[^14_30]: https://lifet.co.kr/Contents/Detail/íˆì•Œë£¨ë¡ ì‚° A to Z

[^14_31]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ì„¸ê· ì„± í”¼ë¶€ì—¼ A to Z

[^14_32]: https://lifet.co.kr

[^14_33]: https://lifet.co.kr/Contents/Detail/ê°•ì•„ì§€ ì‹­ìì¸ëŒ€ íŒŒì—´ì— ëŒ€í•´

[^14_34]: https://docs.aws.amazon.com/ko_kr/prescriptive-guidance/latest/choosing-an-aws-vector-database-for-rag-use-cases/vectors.html

[^14_35]: https://aws.amazon.com/ko/blogs/tech/amazon-bedrock-multi-modal-document-rag/

[^14_36]: https://aws.amazon.com/ko/blogs/tech/practical-guide-for-bedrock-kb-multimodal-chatbot/

[^14_37]: https://www.economize.cloud/blog/aws-bedrock-foundation-models-list/

[^14_38]: https://aws.amazon.com/blogs/machine-learning/getting-started-with-amazon-titan-text-embeddings/

[^14_39]: https://zilliz.com/blog/milvus-2.x-performance-benchmark-update

[^14_40]: https://zenn.dev/knowledgelabo/articles/dee6a3011c29ed

[^14_41]: https://aws.amazon.com/ko/blogs/korea/preview-connect-foundation-models-to-your-company-data-sources-with-agents-for-amazon-bedrock/

[^14_42]: https://www.cloudoptimo.com/blog/understanding-amazon-titan-large-language-models-for-aws/

[^14_43]: https://aws.amazon.com/ko/blogs/korea/amazon-titan-image-generator-multimodal-embeddings-and-text-models-are-now-available-in-amazon-bedrock/

[^14_44]: https://milvus.io/blog/how-to-choose-the-right-embedding-model.md

[^14_45]: https://docs.aws.amazon.com/bedrock/latest/userguide/titan-embedding-models.html

[^14_46]: https://aws.plainenglish.io/turning-amazon-s3-into-a-vector-database-a-hands-on-guide-ada10e2742fc

[^14_47]: https://milvus.io/ai-quick-reference/what-metrics-are-commonly-used-to-measure-embedding-performance

[^14_48]: https://dev.to/aws-builders/the-aws-aiml-landscape-in-2026-simplified-17i3

[^14_49]: https://aws-experience.com/amer/smb/e/3ec1a/mastering-ai-powered-search-and-agents-from-rag-to-multimodal-applications

